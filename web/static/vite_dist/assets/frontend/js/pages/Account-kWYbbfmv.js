import{_ as te,s as Ht,t as Ot,u as vt,k as Yt,j as Jt}from"../../../../icons-BVVFRq1s.js";import{m as jt}from"../../../../mergeExisting-BH6wPZw0.js";import{r as z,e as Gt,m as Qt,c as Wt}from"../../../../index-C5jhSXy3.js";import{_ as Y}from"../../../../index-CK5gn8hD.js";import{u as oe,f as Ct,d as G,i as Xt}from"../../../../usePlayerStore-DgYe3TjK.js";import{_ as Et}from"../../../../FormGroupMultiCheck-BidFewq3.js";import{o as Zt}from"../../../../FormMultiCheck-CTsnYoEJ.js";import{u as en}from"../../../../useFormField-g35ZicrT.js";import{d as q,c as de,h as Q,o as L,A as tn,u as h,b as D,e as _,g as I,r as J,j as U,w as F,f as ne,D as nn,E as on,t as R,F as ae,y as rn,G as Ve,p as sn,i as re,n as $t,k as At,z as kt,m as Pt,v as Bt,H as Rt,q as an}from"../../../../vue-DTJ-1uEH.js";import{_ as xe}from"../../../../ModalForm-DKWosWxb.js";import{u as le,a as ln}from"../../../../useVuelidateOnForm-DTqLR35P.js";import{a as j}from"../../../../router-CTDx8gfL.js";import{u as fe,_ as Tt}from"../../../../useHasModal-cvuvy1JJ.js";import{u as Mt}from"../../../../useRefreshableAsyncState--AtUGMMC.js";import{_ as St}from"../../../../CardPage-D-r1d3Gj.js";import{_ as un}from"../../../../EnabledBadge-hBLx-YaC.js";import{_ as cn}from"../../../../Loading-CxLO-rjm.js";import{_ as It}from"../../../../CopyToClipboardButton-Bb_SSJu7.js";import{_ as dn}from"../../../../FormFieldset-BHUrS5Pq.js";import{v as fn}from"../../../../validatePassword-CB5jFl-i.js";import{u as Ke}from"../../../../useConfirmAndDelete-97z2l6sJ.js";import{_ as Nt}from"../../../../DataTable-DlNNRBXZ.js";import{u as Lt}from"../../../../useHasDatatable-DPFcIMM0.js";import{I as Dt}from"../../../../InvisibleSubmitButton-CAE8DMRX.js";import{_ as hn}from"../../../../FormMarkup-Ds0dZ809.js";import{u as gn}from"../../../../useWebAuthn-CjSxi_fw.js";import{u as mn}from"../../../../PanelLayout-JVlQYoyI.js";import"../../../../lodash-Bdl6ys83.js";import"../../../../lodash-BwctMegf.js";import"../../../../FormGroup-BNI6R37d.js";import"../../../../bootstrap.esm-BZy605kZ.js";import"../../../../useSlotsExcept-BSzLfLLp.js";import"../../../../index-CL6ZUZxu.js";import"../../../../InfoCard-Db4untlq.js";import"../../../../zxcvbn-C681xa0x.js";import"../../../../useDialog-DJwVTu1-.js";import"../../../../FormCheckbox-AsanX38Q.js";import"../../../../useOptionalStorage-DITHAk2f.js";import"../../../../_plugin-vue_export-helper-DlAUqK2U.js";import"../../../../PanelLayout-cOOvnB3Z.js";const pn=q({__name:"TimeRadios",props:{modelValue:{type:[Boolean,null]},field:{},required:{type:Boolean},id:{}},emits:["update:modelValue"],setup(s,{emit:o}){const r=s,n=o,{model:e}=en(r,n),t=de({get(){const a=e.value;return a===!0?"true":a===!1?"false":""},set(a){a===!0||a==="true"?e.value=!0:a===!1||a==="false"?e.value=!1:e.value=null}}),{$gettext:i}=oe(),l=de(()=>[{text:i("Prefer System Default"),value:""},{text:i("12 Hour"),value:"false"},{text:i("24 Hour"),value:"true"}]);return(a,u)=>(L(),Q(Et,tn({id:a.id},a.$attrs,{modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=c=>t.value=c),options:l.value,stacked:"",radio:"",label:h(i)("Time Display")}),null,16,["id","modelValue","options","label"]))}}),yn={class:"row g-3"},_n={class:"col-md-6"},wn={class:"col-md-6"},bn=q({__name:"EditForm",props:{supportedLocales:{},form:{}},setup(s){const o=s,{$gettext:r}=oe(),n=de(()=>{const e=Zt(o.supportedLocales).value;return e.unshift({text:r("Use Browser Default"),value:"default"}),e});return(e,t)=>(L(),D("div",yn,[_("div",_n,[I(Y,{id:"form_name",class:"mb-3",tabindex:"1",field:e.form.name,label:h(r)("Name")},null,8,["field","label"]),I(Y,{id:"form_email",class:"mb-3",tabindex:"2",field:e.form.email,label:h(r)("E-mail Address")},null,8,["field","label"]),I(pn,{id:"edit_form_show_24_hour_time",class:"mb-3",tabindex:"3",field:e.form.show_24_hour_time},null,8,["field"])]),_("div",wn,[I(Et,{id:"edit_form_locale",tabindex:"4",field:e.form.locale,options:n.value,stacked:"",radio:"",label:h(r)("Language")},null,8,["field","options","label"])])]))}}),vn=q({__name:"EditModal",props:{supportedLocales:{}},emits:["reload"],setup(s,{expose:o,emit:r}){const n=r,e=j("/frontend/account/me"),t=J(!0),i=J(null),{form:l,resetForm:a,v$:u,ifValid:c}=le({name:{},email:{required:z,email:Gt},locale:{required:z},show_24_hour_time:{}},{name:"",email:"",locale:"default",show_24_hour_time:null}),m=()=>{a(),t.value=!1,i.value=null},p=U("$modal"),{show:f,hide:C}=fe(p),{notifySuccess:E}=Ct(),{axios:N}=G(),w=()=>{m(),f(),N.get(e.value).then(b=>{l.value=jt(l.value,b.data),t.value=!1}).catch(()=>{C()})},$=()=>{c(()=>{i.value=null,N({method:"PUT",url:e.value,data:l.value}).then(()=>{E(),n("reload"),C()}).catch(b=>{b.value=b.response.data.message})})};return o({open:w}),(b,g)=>(L(),Q(xe,{ref_key:"$modal",ref:p,loading:t.value,title:b.$gettext("Edit Profile"),error:i.value,"disable-save-button":h(u).$invalid,onSubmit:$,onHidden:m},{default:F(()=>[I(bn,{form:h(u),"supported-locales":b.supportedLocales},null,8,["form","supported-locales"])]),_:1},8,["loading","title","error","disable-save-button"]))}}),Cn=["href","title","aria-label"],En=["src"],$n=q({__name:"Avatar",props:{url:{},service:{},serviceUrl:{},width:{default:64}},setup(s){const o=s,{$gettext:r}=oe(),n=de(()=>r("Avatars are retrieved based on your e-mail address from the %{service} service. Click to manage your %{service} settings.",{service:o.service??""}));return(e,t)=>e.serviceUrl?(L(),D("a",{key:0,href:e.serviceUrl,class:"avatar",target:"_blank",title:n.value,"aria-label":h(r)("Manage Avatar")},[_("img",{src:e.url,style:nn({width:e.width+"px",height:"auto"}),alt:""},null,12,En)],8,Cn)):ne("",!0)}}),An={class:"card-header text-bg-primary d-flex flex-wrap align-items-center"},kn={class:"flex-fill"},Pn={key:0,class:"card-title mt-0"},Bn={key:1,class:"card-title"},Rn={class:"card-subtitle"},Tn={key:2,class:"mt-2"},Mn={key:1,class:"flex-md-shrink-0 mt-3 mt-md-0 buttons"},Sn=q({__name:"UserInfoPanel",setup(s,{expose:o}){const r=on(),{axios:n}=G(),e=j("/frontend/account/me"),{state:t,execute:i}=Mt(()=>n.get(e.value).then(l=>l.data),{name:null,email:null,avatar:{url_128:null,service_name:null,service_url:null},roles:[]});return o({reload:i}),(l,a)=>(L(),D("div",An,[h(t).avatar.url_128?(L(),Q($n,{key:0,class:"flex-shrink-0 me-3",url:h(t).avatar.url_128,service:h(t).avatar.service_name,"service-url":h(t).avatar.service_url},null,8,["url","service","service-url"])):ne("",!0),_("div",kn,[h(t).name?(L(),D("h2",Pn,R(h(t).name),1)):(L(),D("h2",Bn,R(l.$gettext("Aplus User")),1)),_("h3",Rn,R(h(t).email),1),h(t).roles.length>0?(L(),D("div",Tn,[(L(!0),D(ae,null,rn(h(t).roles,u=>(L(),D("span",{key:u.id,class:"badge text-bg-secondary me-2"},R(u.name),1))),128))])):ne("",!0)]),r.default?(L(),D("div",Mn,[Ve(l.$slots,"default")])):ne("",!0)]))}});var ee={},ye,Je;function In(){return Je||(Je=1,ye=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),ye}var _e={},O={},je;function W(){if(je)return O;je=1;let s;const o=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return O.getSymbolSize=function(n){if(!n)throw new Error('"version" cannot be null or undefined');if(n<1||n>40)throw new Error('"version" should be in range from 1 to 40');return n*4+17},O.getSymbolTotalCodewords=function(n){return o[n]},O.getBCHDigit=function(r){let n=0;for(;r!==0;)n++,r>>>=1;return n},O.setToSJISFunction=function(n){if(typeof n!="function")throw new Error('"toSJISFunc" is not a valid function.');s=n},O.isKanjiModeEnabled=function(){return typeof s<"u"},O.toSJIS=function(n){return s(n)},O}var we={},Ge;function ze(){return Ge||(Ge=1,function(s){s.L={bit:1},s.M={bit:0},s.Q={bit:3},s.H={bit:2};function o(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"l":case"low":return s.L;case"m":case"medium":return s.M;case"q":case"quartile":return s.Q;case"h":case"high":return s.H;default:throw new Error("Unknown EC Level: "+r)}}s.isValid=function(n){return n&&typeof n.bit<"u"&&n.bit>=0&&n.bit<4},s.from=function(n,e){if(s.isValid(n))return n;try{return o(n)}catch{return e}}}(we)),we}var be,Qe;function Nn(){if(Qe)return be;Qe=1;function s(){this.buffer=[],this.length=0}return s.prototype={get:function(o){const r=Math.floor(o/8);return(this.buffer[r]>>>7-o%8&1)===1},put:function(o,r){for(let n=0;n<r;n++)this.putBit((o>>>r-n-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(o){const r=Math.floor(this.length/8);this.buffer.length<=r&&this.buffer.push(0),o&&(this.buffer[r]|=128>>>this.length%8),this.length++}},be=s,be}var ve,We;function Ln(){if(We)return ve;We=1;function s(o){if(!o||o<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=o,this.data=new Uint8Array(o*o),this.reservedBit=new Uint8Array(o*o)}return s.prototype.set=function(o,r,n,e){const t=o*this.size+r;this.data[t]=n,e&&(this.reservedBit[t]=!0)},s.prototype.get=function(o,r){return this.data[o*this.size+r]},s.prototype.xor=function(o,r,n){this.data[o*this.size+r]^=n},s.prototype.isReserved=function(o,r){return this.reservedBit[o*this.size+r]},ve=s,ve}var Ce={},Xe;function Dn(){return Xe||(Xe=1,function(s){const o=W().getSymbolSize;s.getRowColCoords=function(n){if(n===1)return[];const e=Math.floor(n/7)+2,t=o(n),i=t===145?26:Math.ceil((t-13)/(2*e-2))*2,l=[t-7];for(let a=1;a<e-1;a++)l[a]=l[a-1]-i;return l.push(6),l.reverse()},s.getPositions=function(n){const e=[],t=s.getRowColCoords(n),i=t.length;for(let l=0;l<i;l++)for(let a=0;a<i;a++)l===0&&a===0||l===0&&a===i-1||l===i-1&&a===0||e.push([t[l],t[a]]);return e}}(Ce)),Ce}var Ee={},Ze;function Fn(){if(Ze)return Ee;Ze=1;const s=W().getSymbolSize,o=7;return Ee.getPositions=function(n){const e=s(n);return[[0,0],[e-o,0],[0,e-o]]},Ee}var $e={},et;function Un(){return et||(et=1,function(s){s.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const o={N1:3,N2:3,N3:40,N4:10};s.isValid=function(e){return e!=null&&e!==""&&!isNaN(e)&&e>=0&&e<=7},s.from=function(e){return s.isValid(e)?parseInt(e,10):void 0},s.getPenaltyN1=function(e){const t=e.size;let i=0,l=0,a=0,u=null,c=null;for(let m=0;m<t;m++){l=a=0,u=c=null;for(let p=0;p<t;p++){let f=e.get(m,p);f===u?l++:(l>=5&&(i+=o.N1+(l-5)),u=f,l=1),f=e.get(p,m),f===c?a++:(a>=5&&(i+=o.N1+(a-5)),c=f,a=1)}l>=5&&(i+=o.N1+(l-5)),a>=5&&(i+=o.N1+(a-5))}return i},s.getPenaltyN2=function(e){const t=e.size;let i=0;for(let l=0;l<t-1;l++)for(let a=0;a<t-1;a++){const u=e.get(l,a)+e.get(l,a+1)+e.get(l+1,a)+e.get(l+1,a+1);(u===4||u===0)&&i++}return i*o.N2},s.getPenaltyN3=function(e){const t=e.size;let i=0,l=0,a=0;for(let u=0;u<t;u++){l=a=0;for(let c=0;c<t;c++)l=l<<1&2047|e.get(u,c),c>=10&&(l===1488||l===93)&&i++,a=a<<1&2047|e.get(c,u),c>=10&&(a===1488||a===93)&&i++}return i*o.N3},s.getPenaltyN4=function(e){let t=0;const i=e.data.length;for(let a=0;a<i;a++)t+=e.data[a];return Math.abs(Math.ceil(t*100/i/5)-10)*o.N4};function r(n,e,t){switch(n){case s.Patterns.PATTERN000:return(e+t)%2===0;case s.Patterns.PATTERN001:return e%2===0;case s.Patterns.PATTERN010:return t%3===0;case s.Patterns.PATTERN011:return(e+t)%3===0;case s.Patterns.PATTERN100:return(Math.floor(e/2)+Math.floor(t/3))%2===0;case s.Patterns.PATTERN101:return e*t%2+e*t%3===0;case s.Patterns.PATTERN110:return(e*t%2+e*t%3)%2===0;case s.Patterns.PATTERN111:return(e*t%3+(e+t)%2)%2===0;default:throw new Error("bad maskPattern:"+n)}}s.applyMask=function(e,t){const i=t.size;for(let l=0;l<i;l++)for(let a=0;a<i;a++)t.isReserved(a,l)||t.xor(a,l,r(e,a,l))},s.getBestMask=function(e,t){const i=Object.keys(s.Patterns).length;let l=0,a=1/0;for(let u=0;u<i;u++){t(u),s.applyMask(u,e);const c=s.getPenaltyN1(e)+s.getPenaltyN2(e)+s.getPenaltyN3(e)+s.getPenaltyN4(e);s.applyMask(u,e),c<a&&(a=c,l=u)}return l}}($e)),$e}var ce={},tt;function Ft(){if(tt)return ce;tt=1;const s=ze(),o=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],r=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return ce.getBlocksCount=function(e,t){switch(t){case s.L:return o[(e-1)*4+0];case s.M:return o[(e-1)*4+1];case s.Q:return o[(e-1)*4+2];case s.H:return o[(e-1)*4+3];default:return}},ce.getTotalCodewordsCount=function(e,t){switch(t){case s.L:return r[(e-1)*4+0];case s.M:return r[(e-1)*4+1];case s.Q:return r[(e-1)*4+2];case s.H:return r[(e-1)*4+3];default:return}},ce}var Ae={},ie={},nt;function qn(){if(nt)return ie;nt=1;const s=new Uint8Array(512),o=new Uint8Array(256);return function(){let n=1;for(let e=0;e<255;e++)s[e]=n,o[n]=e,n<<=1,n&256&&(n^=285);for(let e=255;e<512;e++)s[e]=s[e-255]}(),ie.log=function(n){if(n<1)throw new Error("log("+n+")");return o[n]},ie.exp=function(n){return s[n]},ie.mul=function(n,e){return n===0||e===0?0:s[o[n]+o[e]]},ie}var ot;function Kn(){return ot||(ot=1,function(s){const o=qn();s.mul=function(n,e){const t=new Uint8Array(n.length+e.length-1);for(let i=0;i<n.length;i++)for(let l=0;l<e.length;l++)t[i+l]^=o.mul(n[i],e[l]);return t},s.mod=function(n,e){let t=new Uint8Array(n);for(;t.length-e.length>=0;){const i=t[0];for(let a=0;a<e.length;a++)t[a]^=o.mul(e[a],i);let l=0;for(;l<t.length&&t[l]===0;)l++;t=t.slice(l)}return t},s.generateECPolynomial=function(n){let e=new Uint8Array([1]);for(let t=0;t<n;t++)e=s.mul(e,new Uint8Array([1,o.exp(t)]));return e}}(Ae)),Ae}var ke,rt;function Vn(){if(rt)return ke;rt=1;const s=Kn();function o(r){this.genPoly=void 0,this.degree=r,this.degree&&this.initialize(this.degree)}return o.prototype.initialize=function(n){this.degree=n,this.genPoly=s.generateECPolynomial(this.degree)},o.prototype.encode=function(n){if(!this.genPoly)throw new Error("Encoder not initialized");const e=new Uint8Array(n.length+this.degree);e.set(n);const t=s.mod(e,this.genPoly),i=this.degree-t.length;if(i>0){const l=new Uint8Array(this.degree);return l.set(t,i),l}return t},ke=o,ke}var Pe={},Be={},Re={},st;function Ut(){return st||(st=1,Re.isValid=function(o){return!isNaN(o)&&o>=1&&o<=40}),Re}var K={},it;function qt(){if(it)return K;it=1;const s="[0-9]+",o="[A-Z $%*+\\-./:]+";let r="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";r=r.replace(/u/g,"\\u");const n="(?:(?![A-Z0-9 $%*+\\-./:]|"+r+`)(?:.|[\r
]))+`;K.KANJI=new RegExp(r,"g"),K.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),K.BYTE=new RegExp(n,"g"),K.NUMERIC=new RegExp(s,"g"),K.ALPHANUMERIC=new RegExp(o,"g");const e=new RegExp("^"+r+"$"),t=new RegExp("^"+s+"$"),i=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return K.testKanji=function(a){return e.test(a)},K.testNumeric=function(a){return t.test(a)},K.testAlphanumeric=function(a){return i.test(a)},K}var at;function X(){return at||(at=1,function(s){const o=Ut(),r=qt();s.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},s.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},s.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},s.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},s.MIXED={bit:-1},s.getCharCountIndicator=function(t,i){if(!t.ccBits)throw new Error("Invalid mode: "+t);if(!o.isValid(i))throw new Error("Invalid version: "+i);return i>=1&&i<10?t.ccBits[0]:i<27?t.ccBits[1]:t.ccBits[2]},s.getBestModeForData=function(t){return r.testNumeric(t)?s.NUMERIC:r.testAlphanumeric(t)?s.ALPHANUMERIC:r.testKanji(t)?s.KANJI:s.BYTE},s.toString=function(t){if(t&&t.id)return t.id;throw new Error("Invalid mode")},s.isValid=function(t){return t&&t.bit&&t.ccBits};function n(e){if(typeof e!="string")throw new Error("Param is not a string");switch(e.toLowerCase()){case"numeric":return s.NUMERIC;case"alphanumeric":return s.ALPHANUMERIC;case"kanji":return s.KANJI;case"byte":return s.BYTE;default:throw new Error("Unknown mode: "+e)}}s.from=function(t,i){if(s.isValid(t))return t;try{return n(t)}catch{return i}}}(Be)),Be}var lt;function xn(){return lt||(lt=1,function(s){const o=W(),r=Ft(),n=ze(),e=X(),t=Ut(),i=7973,l=o.getBCHDigit(i);function a(p,f,C){for(let E=1;E<=40;E++)if(f<=s.getCapacity(E,C,p))return E}function u(p,f){return e.getCharCountIndicator(p,f)+4}function c(p,f){let C=0;return p.forEach(function(E){const N=u(E.mode,f);C+=N+E.getBitsLength()}),C}function m(p,f){for(let C=1;C<=40;C++)if(c(p,C)<=s.getCapacity(C,f,e.MIXED))return C}s.from=function(f,C){return t.isValid(f)?parseInt(f,10):C},s.getCapacity=function(f,C,E){if(!t.isValid(f))throw new Error("Invalid QR Code version");typeof E>"u"&&(E=e.BYTE);const N=o.getSymbolTotalCodewords(f),w=r.getTotalCodewordsCount(f,C),$=(N-w)*8;if(E===e.MIXED)return $;const b=$-u(E,f);switch(E){case e.NUMERIC:return Math.floor(b/10*3);case e.ALPHANUMERIC:return Math.floor(b/11*2);case e.KANJI:return Math.floor(b/13);case e.BYTE:default:return Math.floor(b/8)}},s.getBestVersionForData=function(f,C){let E;const N=n.from(C,n.M);if(Array.isArray(f)){if(f.length>1)return m(f,N);if(f.length===0)return 1;E=f[0]}else E=f;return a(E.mode,E.getLength(),N)},s.getEncodedBits=function(f){if(!t.isValid(f)||f<7)throw new Error("Invalid QR Code version");let C=f<<12;for(;o.getBCHDigit(C)-l>=0;)C^=i<<o.getBCHDigit(C)-l;return f<<12|C}}(Pe)),Pe}var Te={},ut;function zn(){if(ut)return Te;ut=1;const s=W(),o=1335,r=21522,n=s.getBCHDigit(o);return Te.getEncodedBits=function(t,i){const l=t.bit<<3|i;let a=l<<10;for(;s.getBCHDigit(a)-n>=0;)a^=o<<s.getBCHDigit(a)-n;return(l<<10|a)^r},Te}var Me={},Se,ct;function Hn(){if(ct)return Se;ct=1;const s=X();function o(r){this.mode=s.NUMERIC,this.data=r.toString()}return o.getBitsLength=function(n){return 10*Math.floor(n/3)+(n%3?n%3*3+1:0)},o.prototype.getLength=function(){return this.data.length},o.prototype.getBitsLength=function(){return o.getBitsLength(this.data.length)},o.prototype.write=function(n){let e,t,i;for(e=0;e+3<=this.data.length;e+=3)t=this.data.substr(e,3),i=parseInt(t,10),n.put(i,10);const l=this.data.length-e;l>0&&(t=this.data.substr(e),i=parseInt(t,10),n.put(i,l*3+1))},Se=o,Se}var Ie,dt;function On(){if(dt)return Ie;dt=1;const s=X(),o=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function r(n){this.mode=s.ALPHANUMERIC,this.data=n}return r.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let i=o.indexOf(this.data[t])*45;i+=o.indexOf(this.data[t+1]),e.put(i,11)}this.data.length%2&&e.put(o.indexOf(this.data[t]),6)},Ie=r,Ie}var Ne,ft;function Yn(){if(ft)return Ne;ft=1;const s=X();function o(r){this.mode=s.BYTE,typeof r=="string"?this.data=new TextEncoder().encode(r):this.data=new Uint8Array(r)}return o.getBitsLength=function(n){return n*8},o.prototype.getLength=function(){return this.data.length},o.prototype.getBitsLength=function(){return o.getBitsLength(this.data.length)},o.prototype.write=function(r){for(let n=0,e=this.data.length;n<e;n++)r.put(this.data[n],8)},Ne=o,Ne}var Le,ht;function Jn(){if(ht)return Le;ht=1;const s=X(),o=W();function r(n){this.mode=s.KANJI,this.data=n}return r.getBitsLength=function(e){return e*13},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(n){let e;for(e=0;e<this.data.length;e++){let t=o.toSJIS(this.data[e]);if(t>=33088&&t<=40956)t-=33088;else if(t>=57408&&t<=60351)t-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);t=(t>>>8&255)*192+(t&255),n.put(t,13)}},Le=r,Le}var De={exports:{}},gt;function jn(){return gt||(gt=1,function(s){var o={single_source_shortest_paths:function(r,n,e){var t={},i={};i[n]=0;var l=o.PriorityQueue.make();l.push(n,0);for(var a,u,c,m,p,f,C,E,N;!l.empty();){a=l.pop(),u=a.value,m=a.cost,p=r[u]||{};for(c in p)p.hasOwnProperty(c)&&(f=p[c],C=m+f,E=i[c],N=typeof i[c]>"u",(N||E>C)&&(i[c]=C,l.push(c,C),t[c]=u))}if(typeof e<"u"&&typeof i[e]>"u"){var w=["Could not find a path from ",n," to ",e,"."].join("");throw new Error(w)}return t},extract_shortest_path_from_predecessor_list:function(r,n){for(var e=[],t=n;t;)e.push(t),r[t],t=r[t];return e.reverse(),e},find_path:function(r,n,e){var t=o.single_source_shortest_paths(r,n,e);return o.extract_shortest_path_from_predecessor_list(t,e)},PriorityQueue:{make:function(r){var n=o.PriorityQueue,e={},t;r=r||{};for(t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e.queue=[],e.sorter=r.sorter||n.default_sorter,e},default_sorter:function(r,n){return r.cost-n.cost},push:function(r,n){var e={value:r,cost:n};this.queue.push(e),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};s.exports=o}(De)),De.exports}var mt;function Gn(){return mt||(mt=1,function(s){const o=X(),r=Hn(),n=On(),e=Yn(),t=Jn(),i=qt(),l=W(),a=jn();function u(w){return unescape(encodeURIComponent(w)).length}function c(w,$,b){const g=[];let T;for(;(T=w.exec(b))!==null;)g.push({data:T[0],index:T.index,mode:$,length:T[0].length});return g}function m(w){const $=c(i.NUMERIC,o.NUMERIC,w),b=c(i.ALPHANUMERIC,o.ALPHANUMERIC,w);let g,T;return l.isKanjiModeEnabled()?(g=c(i.BYTE,o.BYTE,w),T=c(i.KANJI,o.KANJI,w)):(g=c(i.BYTE_KANJI,o.BYTE,w),T=[]),$.concat(b,g,T).sort(function(y,A){return y.index-A.index}).map(function(y){return{data:y.data,mode:y.mode,length:y.length}})}function p(w,$){switch($){case o.NUMERIC:return r.getBitsLength(w);case o.ALPHANUMERIC:return n.getBitsLength(w);case o.KANJI:return t.getBitsLength(w);case o.BYTE:return e.getBitsLength(w)}}function f(w){return w.reduce(function($,b){const g=$.length-1>=0?$[$.length-1]:null;return g&&g.mode===b.mode?($[$.length-1].data+=b.data,$):($.push(b),$)},[])}function C(w){const $=[];for(let b=0;b<w.length;b++){const g=w[b];switch(g.mode){case o.NUMERIC:$.push([g,{data:g.data,mode:o.ALPHANUMERIC,length:g.length},{data:g.data,mode:o.BYTE,length:g.length}]);break;case o.ALPHANUMERIC:$.push([g,{data:g.data,mode:o.BYTE,length:g.length}]);break;case o.KANJI:$.push([g,{data:g.data,mode:o.BYTE,length:u(g.data)}]);break;case o.BYTE:$.push([{data:g.data,mode:o.BYTE,length:u(g.data)}])}}return $}function E(w,$){const b={},g={start:{}};let T=["start"];for(let d=0;d<w.length;d++){const y=w[d],A=[];for(let v=0;v<y.length;v++){const M=y[v],k=""+d+v;A.push(k),b[k]={node:M,lastCount:0},g[k]={};for(let B=0;B<T.length;B++){const P=T[B];b[P]&&b[P].node.mode===M.mode?(g[P][k]=p(b[P].lastCount+M.length,M.mode)-p(b[P].lastCount,M.mode),b[P].lastCount+=M.length):(b[P]&&(b[P].lastCount=M.length),g[P][k]=p(M.length,M.mode)+4+o.getCharCountIndicator(M.mode,$))}}T=A}for(let d=0;d<T.length;d++)g[T[d]].end=0;return{map:g,table:b}}function N(w,$){let b;const g=o.getBestModeForData(w);if(b=o.from($,g),b!==o.BYTE&&b.bit<g.bit)throw new Error('"'+w+'" cannot be encoded with mode '+o.toString(b)+`.
 Suggested mode is: `+o.toString(g));switch(b===o.KANJI&&!l.isKanjiModeEnabled()&&(b=o.BYTE),b){case o.NUMERIC:return new r(w);case o.ALPHANUMERIC:return new n(w);case o.KANJI:return new t(w);case o.BYTE:return new e(w)}}s.fromArray=function($){return $.reduce(function(b,g){return typeof g=="string"?b.push(N(g,null)):g.data&&b.push(N(g.data,g.mode)),b},[])},s.fromString=function($,b){const g=m($,l.isKanjiModeEnabled()),T=C(g),d=E(T,b),y=a.find_path(d.map,"start","end"),A=[];for(let v=1;v<y.length-1;v++)A.push(d.table[y[v]].node);return s.fromArray(f(A))},s.rawSplit=function($){return s.fromArray(m($,l.isKanjiModeEnabled()))}}(Me)),Me}var pt;function Qn(){if(pt)return _e;pt=1;const s=W(),o=ze(),r=Nn(),n=Ln(),e=Dn(),t=Fn(),i=Un(),l=Ft(),a=Vn(),u=xn(),c=zn(),m=X(),p=Gn();function f(d,y){const A=d.size,v=t.getPositions(y);for(let M=0;M<v.length;M++){const k=v[M][0],B=v[M][1];for(let P=-1;P<=7;P++)if(!(k+P<=-1||A<=k+P))for(let S=-1;S<=7;S++)B+S<=-1||A<=B+S||(P>=0&&P<=6&&(S===0||S===6)||S>=0&&S<=6&&(P===0||P===6)||P>=2&&P<=4&&S>=2&&S<=4?d.set(k+P,B+S,!0,!0):d.set(k+P,B+S,!1,!0))}}function C(d){const y=d.size;for(let A=8;A<y-8;A++){const v=A%2===0;d.set(A,6,v,!0),d.set(6,A,v,!0)}}function E(d,y){const A=e.getPositions(y);for(let v=0;v<A.length;v++){const M=A[v][0],k=A[v][1];for(let B=-2;B<=2;B++)for(let P=-2;P<=2;P++)B===-2||B===2||P===-2||P===2||B===0&&P===0?d.set(M+B,k+P,!0,!0):d.set(M+B,k+P,!1,!0)}}function N(d,y){const A=d.size,v=u.getEncodedBits(y);let M,k,B;for(let P=0;P<18;P++)M=Math.floor(P/3),k=P%3+A-8-3,B=(v>>P&1)===1,d.set(M,k,B,!0),d.set(k,M,B,!0)}function w(d,y,A){const v=d.size,M=c.getEncodedBits(y,A);let k,B;for(k=0;k<15;k++)B=(M>>k&1)===1,k<6?d.set(k,8,B,!0):k<8?d.set(k+1,8,B,!0):d.set(v-15+k,8,B,!0),k<8?d.set(8,v-k-1,B,!0):k<9?d.set(8,15-k-1+1,B,!0):d.set(8,15-k-1,B,!0);d.set(v-8,8,1,!0)}function $(d,y){const A=d.size;let v=-1,M=A-1,k=7,B=0;for(let P=A-1;P>0;P-=2)for(P===6&&P--;;){for(let S=0;S<2;S++)if(!d.isReserved(M,P-S)){let H=!1;B<y.length&&(H=(y[B]>>>k&1)===1),d.set(M,P-S,H),k--,k===-1&&(B++,k=7)}if(M+=v,M<0||A<=M){M-=v,v=-v;break}}}function b(d,y,A){const v=new r;A.forEach(function(S){v.put(S.mode.bit,4),v.put(S.getLength(),m.getCharCountIndicator(S.mode,d)),S.write(v)});const M=s.getSymbolTotalCodewords(d),k=l.getTotalCodewordsCount(d,y),B=(M-k)*8;for(v.getLengthInBits()+4<=B&&v.put(0,4);v.getLengthInBits()%8!==0;)v.putBit(0);const P=(B-v.getLengthInBits())/8;for(let S=0;S<P;S++)v.put(S%2?17:236,8);return g(v,d,y)}function g(d,y,A){const v=s.getSymbolTotalCodewords(y),M=l.getTotalCodewordsCount(y,A),k=v-M,B=l.getBlocksCount(y,A),P=v%B,S=B-P,H=Math.floor(v/B),se=Math.floor(k/B),Vt=se+1,He=H-se,xt=new a(He);let he=0;const ue=new Array(B),Oe=new Array(B);let ge=0;const zt=new Uint8Array(d.buffer);for(let Z=0;Z<B;Z++){const pe=Z<S?se:Vt;ue[Z]=zt.slice(he,he+pe),Oe[Z]=xt.encode(ue[Z]),he+=pe,ge=Math.max(ge,pe)}const me=new Uint8Array(v);let Ye=0,V,x;for(V=0;V<ge;V++)for(x=0;x<B;x++)V<ue[x].length&&(me[Ye++]=ue[x][V]);for(V=0;V<He;V++)for(x=0;x<B;x++)me[Ye++]=Oe[x][V];return me}function T(d,y,A,v){let M;if(Array.isArray(d))M=p.fromArray(d);else if(typeof d=="string"){let H=y;if(!H){const se=p.rawSplit(d);H=u.getBestVersionForData(se,A)}M=p.fromString(d,H||40)}else throw new Error("Invalid data");const k=u.getBestVersionForData(M,A);if(!k)throw new Error("The amount of data is too big to be stored in a QR Code");if(!y)y=k;else if(y<k)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+k+`.
`);const B=b(y,A,M),P=s.getSymbolSize(y),S=new n(P);return f(S,y),C(S),E(S,y),w(S,A,0),y>=7&&N(S,y),$(S,B),isNaN(v)&&(v=i.getBestMask(S,w.bind(null,S,A))),i.applyMask(v,S),w(S,A,v),{modules:S,version:y,errorCorrectionLevel:A,maskPattern:v,segments:M}}return _e.create=function(y,A){if(typeof y>"u"||y==="")throw new Error("No input text");let v=o.M,M,k;return typeof A<"u"&&(v=o.from(A.errorCorrectionLevel,o.M),M=u.from(A.version),k=i.from(A.maskPattern),A.toSJISFunc&&s.setToSJISFunction(A.toSJISFunc)),T(y,M,v,k)},_e}var Fe={},Ue={},yt;function Kt(){return yt||(yt=1,function(s){function o(r){if(typeof r=="number"&&(r=r.toString()),typeof r!="string")throw new Error("Color should be defined as hex string");let n=r.slice().replace("#","").split("");if(n.length<3||n.length===5||n.length>8)throw new Error("Invalid hex color: "+r);(n.length===3||n.length===4)&&(n=Array.prototype.concat.apply([],n.map(function(t){return[t,t]}))),n.length===6&&n.push("F","F");const e=parseInt(n.join(""),16);return{r:e>>24&255,g:e>>16&255,b:e>>8&255,a:e&255,hex:"#"+n.slice(0,6).join("")}}s.getOptions=function(n){n||(n={}),n.color||(n.color={});const e=typeof n.margin>"u"||n.margin===null||n.margin<0?4:n.margin,t=n.width&&n.width>=21?n.width:void 0,i=n.scale||4;return{width:t,scale:t?4:i,margin:e,color:{dark:o(n.color.dark||"#000000ff"),light:o(n.color.light||"#ffffffff")},type:n.type,rendererOpts:n.rendererOpts||{}}},s.getScale=function(n,e){return e.width&&e.width>=n+e.margin*2?e.width/(n+e.margin*2):e.scale},s.getImageWidth=function(n,e){const t=s.getScale(n,e);return Math.floor((n+e.margin*2)*t)},s.qrToImageData=function(n,e,t){const i=e.modules.size,l=e.modules.data,a=s.getScale(i,t),u=Math.floor((i+t.margin*2)*a),c=t.margin*a,m=[t.color.light,t.color.dark];for(let p=0;p<u;p++)for(let f=0;f<u;f++){let C=(p*u+f)*4,E=t.color.light;if(p>=c&&f>=c&&p<u-c&&f<u-c){const N=Math.floor((p-c)/a),w=Math.floor((f-c)/a);E=m[l[N*i+w]?1:0]}n[C++]=E.r,n[C++]=E.g,n[C++]=E.b,n[C]=E.a}}}(Ue)),Ue}var _t;function Wn(){return _t||(_t=1,function(s){const o=Kt();function r(e,t,i){e.clearRect(0,0,t.width,t.height),t.style||(t.style={}),t.height=i,t.width=i,t.style.height=i+"px",t.style.width=i+"px"}function n(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}s.render=function(t,i,l){let a=l,u=i;typeof a>"u"&&(!i||!i.getContext)&&(a=i,i=void 0),i||(u=n()),a=o.getOptions(a);const c=o.getImageWidth(t.modules.size,a),m=u.getContext("2d"),p=m.createImageData(c,c);return o.qrToImageData(p.data,t,a),r(m,u,c),m.putImageData(p,0,0),u},s.renderToDataURL=function(t,i,l){let a=l;typeof a>"u"&&(!i||!i.getContext)&&(a=i,i=void 0),a||(a={});const u=s.render(t,i,a),c=a.type||"image/png",m=a.rendererOpts||{};return u.toDataURL(c,m.quality)}}(Fe)),Fe}var qe={},wt;function Xn(){if(wt)return qe;wt=1;const s=Kt();function o(e,t){const i=e.a/255,l=t+'="'+e.hex+'"';return i<1?l+" "+t+'-opacity="'+i.toFixed(2).slice(1)+'"':l}function r(e,t,i){let l=e+t;return typeof i<"u"&&(l+=" "+i),l}function n(e,t,i){let l="",a=0,u=!1,c=0;for(let m=0;m<e.length;m++){const p=Math.floor(m%t),f=Math.floor(m/t);!p&&!u&&(u=!0),e[m]?(c++,m>0&&p>0&&e[m-1]||(l+=u?r("M",p+i,.5+f+i):r("m",a,0),a=0,u=!1),p+1<t&&e[m+1]||(l+=r("h",c),c=0)):a++}return l}return qe.render=function(t,i,l){const a=s.getOptions(i),u=t.modules.size,c=t.modules.data,m=u+a.margin*2,p=a.color.light.a?"<path "+o(a.color.light,"fill")+' d="M0 0h'+m+"v"+m+'H0z"/>':"",f="<path "+o(a.color.dark,"stroke")+' d="'+n(c,u,a.margin)+'"/>',C='viewBox="0 0 '+m+" "+m+'"',N='<svg xmlns="http://www.w3.org/2000/svg" '+(a.width?'width="'+a.width+'" height="'+a.width+'" ':"")+C+' shape-rendering="crispEdges">'+p+f+`</svg>
`;return typeof l=="function"&&l(null,N),N},qe}var bt;function Zn(){if(bt)return ee;bt=1;const s=In(),o=Qn(),r=Wn(),n=Xn();function e(t,i,l,a,u){const c=[].slice.call(arguments,1),m=c.length,p=typeof c[m-1]=="function";if(!p&&!s())throw new Error("Callback required as last argument");if(p){if(m<2)throw new Error("Too few arguments provided");m===2?(u=l,l=i,i=a=void 0):m===3&&(i.getContext&&typeof u>"u"?(u=a,a=void 0):(u=a,a=l,l=i,i=void 0))}else{if(m<1)throw new Error("Too few arguments provided");return m===1?(l=i,i=a=void 0):m===2&&!i.getContext&&(a=l,l=i,i=void 0),new Promise(function(f,C){try{const E=o.create(l,a);f(t(E,i,a))}catch(E){C(E)}})}try{const f=o.create(l,a);u(null,t(f,i,a))}catch(f){u(f)}}return ee.create=o.create,ee.toCanvas=e.bind(null,r.render),ee.toDataURL=e.bind(null,r.renderToDataURL),ee.toString=e.bind(null,function(t,i,l){return n.render(t,l)}),ee}var eo=Zn();const to=q({__name:"QrCode",props:{uri:{}},setup(s){const o=s,r=U("$canvas");return sn(()=>{eo.toCanvas(r.value,o.uri,n=>{n&&console.error(n)})}),(n,e)=>(L(),D("canvas",{ref_key:"$canvas",ref:r},null,512))}}),no={class:"row"},oo={class:"col-md-7"},ro={class:"mt-2"},so={class:"card-text"},io={class:"mt-0"},ao={class:"card-text"},lo={class:"col-md-5"},uo={key:0},co={id:"totp_uri",class:"d-inline-block text-truncate mt-2",style:{width:"100%"}},fo=q({__name:"TwoFactorModal",props:{twoFactorUrl:{}},emits:["relist"],setup(s,{expose:o,emit:r}){const n=s,e=r,t=J(!0),i=J(null),{form:l,resetForm:a,v$:u,ifValid:c}=le({otp:{required:z,minLength:Qt(6)}},{otp:""}),{record:m,reset:p}=ln({secret:null,totp_uri:null,qr_code:null}),f=()=>{a(),p(),t.value=!1,i.value=null},C=U("$modal"),{hide:E,show:N}=fe(C),{notifySuccess:w}=Ct(),{axios:$}=G(),b=()=>{f(),t.value=!0,N(),$.put(n.twoFactorUrl).then(T=>{m.value=T.data,t.value=!1}).catch(()=>{E()})},g=()=>{c(()=>{i.value=null,$({method:"PUT",url:n.twoFactorUrl,data:{secret:m.value.secret,otp:l.value.otp}}).then(()=>{w(),e("relist"),E()}).catch(T=>{T.value=T.response.data.message})})};return o({open:b}),(T,d)=>(L(),Q(xe,{ref_key:"$modal",ref:C,loading:t.value,title:T.$gettext("Enable Two-Factor Authentication"),error:i.value,"disable-save-button":h(u).$invalid,"no-enforce-focus":"",onSubmit:g,onHidden:f},{"save-button-name":F(()=>[re(R(T.$gettext("Submit Code")),1)]),default:F(()=>[_("div",no,[_("div",oo,[_("h5",ro,R(T.$gettext("Step 1: Scan QR Code")),1),_("p",so,R(T.$gettext("From your smartphone, scan the code to the right using an authentication app of your choice (FreeOTP, Authy, etc).")),1),_("h5",io,R(T.$gettext("Step 2: Verify Generated Code")),1),_("p",ao,R(T.$gettext("To verify that the code was set up correctly, enter the 6-digit code the app shows you.")),1),I(dn,null,{default:F(()=>[I(Y,{id:"form_otp",field:h(u).otp,autofocus:"",label:T.$gettext("Code from Authenticator App"),description:T.$gettext("Enter the current code provided by your authenticator app to verify that it's working correctly.")},null,8,["field","label","description"])]),_:1})]),_("div",lo,[h(m).totp_uri?(L(),D("div",uo,[I(to,{uri:h(m).totp_uri},null,8,["uri"]),_("code",co,R(h(m).totp_uri),1),I(It,{text:h(m).totp_uri},null,8,["text"])])):ne("",!0)])])]),_:1},8,["loading","title","error","disable-save-button"]))}}),ho=q({__name:"ChangePasswordModal",emits:["relist"],setup(s,{expose:o,emit:r}){const n=r,e=j("/frontend/account/password"),t=(w,$)=>$.new_password===w,{$gettext:i}=oe(),{form:l,resetForm:a,v$:u,ifValid:c}=le({current_password:{required:z},new_password:{required:z,validatePassword:fn},new_password2:{required:z,passwordsMatch:Wt.withMessage(i("Must match new password."),t)}},{current_password:null,new_password:null,new_password2:null}),m=J(null),p=()=>{m.value=null,a()},f=U("$modal"),C=()=>{var w;p(),(w=f.value)==null||w.show()},{axios:E}=G(),N=()=>{c(()=>{E.put(e.value,l.value).finally(()=>{var w;(w=f.value)==null||w.hide(),n("relist")})})};return o({open:C}),(w,$)=>(L(),Q(xe,{ref_key:"$modal",ref:f,size:"md",centered:"",title:h(i)("Change Password"),"disable-save-button":h(u).$invalid,onSubmit:N,onHidden:p},{"save-button-name":F(()=>[re(R(h(i)("Change Password")),1)]),default:F(()=>[I(Y,{id:"form_current_password",field:h(u).current_password,"input-type":"password",autofocus:"",label:h(i)("Current Password")},null,8,["field","label"]),I(Y,{id:"form_new_password",field:h(u).new_password,"input-type":"password",label:h(i)("New Password")},null,8,["field","label"]),I(Y,{id:"form_current_password",field:h(u).new_password2,"input-type":"password",label:h(i)("Confirm New Password")},null,8,["field","label"])]),_:1},8,["title","disable-save-button"]))}}),go={class:"card-text"},mo={key:0,class:"card-text"},po={key:1,class:"buttons"},yo={key:1},_o={class:"card-text"},wo=q({__name:"PasskeyModal",emits:["relist"],setup(s,{expose:o,emit:r}){const n=r,e=j("/frontend/account/webauthn/register"),t=J(null),{form:i,resetForm:l,v$:a,validate:u}=le({name:{required:z},createResponse:{required:z}},{name:"",createResponse:null}),c=()=>{l(),t.value=null},m=U("$modal"),{show:p,hide:f}=fe(m),C=()=>{c(),p()},{isSupported:E,doRegister:N,cancel:w}=gn(),$=()=>{c(),w(),n("relist")},{axios:b}=G(),g=async()=>{const d=await b.get(e.value).then(y=>y.data);try{i.value.createResponse=await N(d)}catch(y){throw y.name==="InvalidStateError"?t.value="Error: Authenticator was probably already registered by user":t.value=y,y}},T=async()=>{await u()&&(t.value=null,b({method:"PUT",url:e.value,data:i.value}).then(()=>{f()}).catch(y=>{y.value=y.response.data.message}))};return o({create:C}),(d,y)=>(L(),Q(Tt,{id:"api_keys_modal",ref_key:"$modal",ref:m,size:"md",centered:"",title:d.$gettext("Add New Passkey"),"no-enforce-focus":"",onHidden:$},{default:F(()=>[Pt(_("div",{class:"alert alert-danger"},R(t.value),513),[[Bt,t.value!=null]]),h(E)?(L(),D("form",{key:0,class:"form vue-form",onSubmit:Rt(T,["prevent"])},[I(Y,{id:"form_name",field:h(a).name,autofocus:"",class:"mb-3",label:d.$gettext("Passkey Nickname")},null,8,["field","label"]),I(hn,{id:"form_select_passkey"},{label:F(()=>[re(R(d.$gettext("Select Passkey")),1)]),default:F(()=>[_("p",go,R(d.$gettext("Click the button below to open your browser window to select a passkey.")),1),h(i).createResponse?(L(),D("p",mo,R(d.$gettext("A passkey has been selected. Submit this form to add it to your account.")),1)):(L(),D("div",po,[_("button",{type:"button",class:"btn btn-primary",onClick:g},R(d.$gettext("Select Passkey")),1)]))]),_:1}),I(Dt)],32)):(L(),D("div",yo,[_("p",_o,R(d.$gettext("Your browser does not support passkeys. Consider updating your browser to the latest version.")),1)]))]),"modal-footer":F(A=>[Ve(d.$slots,"modal-footer",$t(At(A)),()=>[_("button",{type:"button",class:"btn btn-secondary",onClick:y[0]||(y[0]=(...v)=>h(f)&&h(f)(...v))},R(d.$gettext("Close")),1),_("button",{type:"submit",class:kt(["btn",h(a).$invalid?"btn-danger":"btn-primary"]),onClick:T},R(d.$gettext("Add New Passkey")),3)])]),_:3},8,["title"]))}}),bo={class:"d-flex align-items-center"},vo={class:"flex-fill"},Co=["id"],Eo={class:"flex-shrink-0"},$o={class:"card-body"},Ao={class:"card-text mt-2"},ko={class:"buttons"},Po={class:"card-body"},Bo={class:"card-text mt-2"},Ro={class:"buttons"},To={class:"btn-group btn-group-sm"},Mo=["onClick"],So=q({__name:"SecurityPanel",setup(s){const{axios:o}=G(),r=j("/frontend/account/two-factor"),{state:n,isLoading:e,execute:t}=Mt(()=>o.get(r.value).then(g=>({twoFactorEnabled:g.data.two_factor_enabled})),{twoFactorEnabled:!1}),i=U("$changePasswordModal"),l=()=>{var g;(g=i.value)==null||g.open()},a=U("$twoFactorModal"),u=()=>{var g;(g=a.value)==null||g.open()},{$gettext:c}=oe(),{doDelete:m}=Ke(c("Disable two-factor authentication?"),()=>{t()}),p=()=>m(r.value),f=j("/frontend/account/passkeys"),C=[{key:"name",isRowHeader:!0,label:c("Passkey Nickname"),sortable:!1},{key:"actions",label:c("Actions"),sortable:!1,class:"shrink"}],E=U("$dataTable"),{relist:N}=Lt(E),{doDelete:w}=Ke(c("Delete Passkey?"),N),$=U("$passkeyModal"),b=()=>{var g;(g=$.value)==null||g.create()};return(g,T)=>(L(),D(ae,null,[I(St,{"header-id":"hdr_security"},{header:F(({id:d})=>[_("div",bo,[_("div",vo,[_("h3",{id:d,class:"card-title"},R(h(c)("Security")),9,Co)]),_("div",Eo,[_("button",{type:"button",class:"btn btn-dark",onClick:l},[I(te,{icon:h(Yt)},null,8,["icon"]),_("span",null,R(h(c)("Change Password")),1)])])])]),default:F(()=>[I(cn,{loading:h(e)},{default:F(()=>[_("div",$o,[_("h5",null,[re(R(h(c)("Two-Factor Authentication"))+" ",1),I(un,{enabled:h(n).twoFactorEnabled},null,8,["enabled"])]),_("p",Ao,R(h(c)("Two-factor authentication improves the security of your account by requiring a second one-time access code in addition to your password when you log in.")),1),_("div",ko,[h(n).twoFactorEnabled?(L(),D("button",{key:0,type:"button",class:"btn btn-danger",onClick:p},[I(te,{icon:h(Ht)},null,8,["icon"]),_("span",null,R(h(c)("Disable Two-Factor")),1)])):(L(),D("button",{key:1,type:"button",class:"btn btn-success",onClick:u},[I(te,{icon:h(Ot)},null,8,["icon"]),_("span",null,R(h(c)("Enable Two-Factor")),1)]))])])]),_:1},8,["loading"]),_("div",Po,[_("h5",null,R(h(c)("Passkey Authentication")),1),_("p",Bo,R(h(c)("Using a passkey (like Windows Hello, YubiKey, or your smartphone) allows you to securely log in without needing to enter your password or two-factor code.")),1),_("div",Ro,[_("button",{type:"button",class:"btn btn-primary",onClick:b},[I(te,{icon:h(vt)},null,8,["icon"]),_("span",null,R(h(c)("Add New Passkey")),1)])])]),I(Nt,{id:"account_passkeys",ref_key:"$dataTable",ref:E,"show-toolbar":!1,fields:C,"api-url":h(f)},{"cell(actions)":F(d=>[_("div",To,[_("button",{type:"button",class:"btn btn-danger",onClick:y=>h(w)(d.item.links.self)},R(h(c)("Delete")),9,Mo)])]),_:1},8,["api-url"])]),_:1}),I(ho,{ref_key:"$changePasswordModal",ref:i},null,512),I(fo,{ref_key:"$twoFactorModal",ref:a,"two-factor-url":h(r),onRelist:h(t)},null,8,["two-factor-url","onRelist"]),I(wo,{ref_key:"$passkeyModal",ref:$,onRelist:h(N)},null,8,["onRelist"])],64))}}),Io={class:"card-subtitle"},No={class:"card-text"},Lo={class:"card-text"},Do={class:"px-2"},Fo={id:"api_key"},Uo={class:"buttons pt-2"},qo={class:"card-text pt-3"},Ko={class:"card-text"},Vo=q({__name:"ApiKeyNewKey",props:{newKey:{}},setup(s){return(o,r)=>(L(),D(ae,null,[_("h3",Io,R(o.$gettext("New Key Generated")),1),_("p",No,[_("b",null,R(o.$gettext("Important: copy the key below before continuing!")),1),re(" "+R(o.$gettext("You will not be able to retrieve it again.")),1)]),_("p",Lo,R(o.$gettext("Your full API key is below:")),1),_("div",Do,[_("code",Fo,R(o.newKey),1),_("div",Uo,[I(It,{text:o.newKey},null,8,["text"])])]),_("p",qo,R(o.$gettext('When making API calls, you can pass this value in the "X-API-Key" header to authenticate as yourself.')),1),_("p",Ko,R(o.$gettext("You can only perform the actions your user account is allowed to perform.")),1)],64))}}),xo={key:1},zo=q({__name:"ApiKeyModal",props:{createUrl:{}},emits:["relist"],setup(s,{expose:o,emit:r}){const n=s,e=r,t=J(null),i=J(null),{form:l,resetForm:a,v$:u,validate:c}=le({comment:{required:z}},{comment:""}),m=()=>{a(),t.value=null,i.value=null},p=U("$modal"),{show:f,hide:C}=fe(p),E=()=>{m(),f()},N=U("$field"),w=()=>{an(()=>{var g;(g=N.value)==null||g.focus()})},{axios:$}=G(),b=async()=>{await c()&&(t.value=null,$({method:"POST",url:n.createUrl,data:l.value}).then(T=>{i.value=T.data.key,e("relist")}).catch(T=>{T.value=T.response.data.message}))};return o({create:E}),(g,T)=>(L(),Q(Tt,{id:"api_keys_modal",ref_key:"$modal",ref:p,size:"md",centered:"",title:g.$gettext("Add API Key"),"no-enforce-focus":"",onShown:w,onHidden:m},{default:F(()=>[Pt(_("div",{class:"alert alert-danger"},R(t.value),513),[[Bt,t.value!=null]]),i.value===null?(L(),D("form",{key:0,class:"form vue-form",onSubmit:Rt(b,["prevent"])},[I(Y,{id:"form_comments",ref_key:"$field",ref:N,field:h(u).comment,autofocus:"",label:g.$gettext("API Key Description/Comments")},null,8,["field","label"]),I(Dt)],32)):(L(),D("div",xo,[I(Vo,{"new-key":i.value},null,8,["new-key"])]))]),"modal-footer":F(d=>[Ve(g.$slots,"modal-footer",$t(At(d)),()=>[_("button",{type:"button",class:"btn btn-secondary",onClick:T[0]||(T[0]=(...y)=>h(C)&&h(C)(...y))},R(g.$gettext("Close")),1),i.value===null?(L(),D("button",{key:0,type:"submit",class:kt(["btn",h(u).$invalid?"btn-danger":"btn-primary"]),onClick:b},R(g.$gettext("Create New Key")),3)):ne("",!0)])]),_:3},8,["title"]))}}),Ho={href:"/api",class:"alert-link",target:"_blank"},Oo={class:"btn-group btn-group-sm"},Yo=["onClick"],Jo=q({__name:"ApiKeysPanel",setup(s){const o=j("/frontend/account/api-keys"),{$gettext:r}=oe(),n=[{key:"comment",isRowHeader:!0,label:r("API Key Description/Comments"),sortable:!1},{key:"actions",label:r("Actions"),sortable:!1,class:"shrink"}],e=U("$apiKeyModal"),t=()=>{var u;(u=e.value)==null||u.create()},i=U("$dataTable"),{relist:l}=Lt(i),{doDelete:a}=Ke(r("Delete API Key?"),l);return(u,c)=>(L(),D(ae,null,[I(St,{"header-id":"hdr_api_keys",title:h(r)("API Keys")},{info:F(()=>[re(R(h(r)("Use API keys to authenticate with the Aplus API using the same permissions as your user account."))+" ",1),_("a",Ho,R(h(r)("API Documentation")),1)]),actions:F(()=>[_("button",{type:"button",class:"btn btn-primary",onClick:t},[I(te,{icon:h(vt)},null,8,["icon"]),_("span",null,R(h(r)("Add API Key")),1)])]),default:F(()=>[I(Nt,{id:"account_api_keys",ref_key:"$dataTable",ref:i,"show-toolbar":!1,fields:n,"api-url":h(o)},{"cell(actions)":F(m=>[_("div",Oo,[_("button",{type:"button",class:"btn btn-danger",onClick:p=>h(a)(m.item.links.self)},R(h(r)("Delete")),9,Yo)])]),_:1},8,["api-url"])]),_:1},8,["title"]),I(zo,{ref_key:"$apiKeyModal",ref:e,"create-url":h(o),onRelist:h(l)},null,8,["create-url","onRelist"])],64))}}),jo={class:"outside-card-header mb-1"},Go=["aria-label"],Qo={class:"row row-of-cards"},Wo={class:"col-sm-12 col-md-6"},Xo={class:"col-sm-12 col-md-6"},Zo=q({__name:"Account",props:{supportedLocales:{}},setup(s){const o=U("$editModal"),r=()=>{var e;(e=o.value)==null||e.open()},n=()=>{location.reload()};return(e,t)=>(L(),D(ae,null,[_("h2",jo,R(e.$gettext("My Account")),1),_("section",{class:"card mb-4",role:"region","aria-label":e.$gettext("Account Details")},[I(Sn,{ref:"$userInfoPanel"},{default:F(()=>[_("button",{type:"button",class:"btn btn-dark",onClick:r},[I(te,{icon:h(Jt)},null,8,["icon"]),_("span",null,R(e.$gettext("Edit Profile")),1)])]),_:1},512)],8,Go),_("div",Qo,[_("div",Wo,[I(So)]),_("div",Xo,[I(Jo)])]),I(vn,{ref_key:"$editModal",ref:o,"supported-locales":e.supportedLocales,onReload:n},null,8,["supported-locales"])],64))}});Xt(mn(Zo));
