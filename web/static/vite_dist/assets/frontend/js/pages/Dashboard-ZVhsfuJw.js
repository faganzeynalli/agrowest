import{d as D,u as M,c as O,i as T}from"../../../../usePlayerStore-KLtIIp-S.js";import{u as R}from"../../../../PanelLayout-DXibSST-.js";import{_ as m,m as j,n as A,o as z,p as E,q as W}from"../../../../icons-Yf7pfv1X.js";import{_ as G}from"../../../../PlayButton-CHwgdHi6.js";import{A as J}from"../../../../AlbumArt-3z3lJYbm.js";import{a as N}from"../../../../index-DXvg9C8z.js";import{_ as U}from"../../../../TimeSeriesChart-ByDyO6yx.js";import{_ as K}from"../../../../Loading-B4WK-6A0.js";import{_ as L,a as Q}from"../../../../Tab--yLl8rRe.js";import{d as P,h as y,o,u as e,w as r,g as n,c as S,j as C,b as i,e as t,f as d,t as l,F as b,s as X,x as B,i as Y}from"../../../../vue-B-dHMJBO.js";import{_ as Z}from"../../../../Lightbox-CyVEhnVk.js";import{_ as I}from"../../../../CardPage-0fdasE1K.js";import{_ as ss}from"../../../../HeaderInlinePlayer-CYBOMbUI.js";import{u as ts}from"../../../../lightbox-BJHiTgc7.js";import{u as es}from"../../../../useOptionalStorage-BvRWWVwv.js";import{_ as as}from"../../../../UserInfoPanel--FicyJP7.js";import{a as g}from"../../../../router-CjgRDsAC.js";import{_ as ls}from"../../../../DataTable-vHTsgTi6.js";import{u as os}from"../../../../useHasDatatable-DPFcIMM0.js";import"../../../../bootstrap.esm-BZy605kZ.js";import"../../../../lodash-BwctMegf.js";import"../../../../PanelLayout-B_woGhAF.js";import"../../../../_plugin-vue_export-helper-DlAUqK2U.js";import"../../../../lodash-Bdl6ys83.js";import"../../../../datetime-BTmRqpun.js";import"../../../../luxon-Dh54MNAX.js";import"../../../../InfoCard-D6xe4CFe.js";import"../../../../InlinePlayer-CqVgEHPY.js";import"../../../../useShowVolume-BWrcCy71.js";import"../../../../hlsjs-Cx0E5yqS.js";import"../../../../formatTime-DvDPwXf4.js";import"../../../../MuteButton-CQGiAlAY.js";import"../../../../useRefreshableAsyncState-C1ZBA_bE.js";import"../../../../FormMultiCheck-C8kU6V99.js";import"../../../../FormCheckbox-CBrIHDuX.js";const ns=P({__name:"DashboardCharts",props:{chartsUrl:{}},setup(k){const p=k,{axios:f}=D(),{state:_,isLoading:h}=N(()=>f.get(p.chartsUrl).then(a=>a.data),{average:{metrics:[],alt:[]},unique:{metrics:[],alt:[]}});return(a,v)=>(o(),y(K,{loading:e(h)},{default:r(()=>[n(Q,null,{default:r(()=>[n(L,{label:a.$gettext("Average Listeners")},{default:r(()=>[n(U,{style:{width:"100%"},data:e(_).average.metrics,alt:e(_).average.alt,"aspect-ratio":3},null,8,["data","alt"])]),_:1},8,["label"]),n(L,{label:a.$gettext("Unique Listeners")},{default:r(()=>[n(U,{style:{width:"100%"},data:e(_).unique.metrics,alt:e(_).unique.alt,"aspect-ratio":3},null,8,["data","alt"])]),_:1},8,["label"])]),_:1})]),_:1},8,["loading"]))}}),is={id:"dashboard",class:"row-of-cards"},rs=["aria-label"],cs=["href"],ds=["href"],_s={key:0,class:"flex-shrink-0 me-3"},hs={key:1,class:"flex-shrink-0 me-3"},ms={class:"flex-fill"},us={class:"card-text"},ps={key:2,class:"flex-shrink-0 ms-md-3 mt-3 mt-md-0"},fs=["href"],bs={class:"d-flex align-items-center"},gs={class:"flex-fill"},ys=["id"],ks={class:"flex-shrink-0"},vs={key:0,id:"charts",class:"card-body"},ws={class:"d-flex flex-wrap align-items-center"},xs={class:"flex-fill"},$s=["id"],As={key:0,class:"flex-shrink-0"},Us=["href"],Ls={class:"h5 m-0"},Ss={key:0},Cs=["href"],Bs={class:"pe-1"},Is=["href","aria-label"],Ds={class:"d-flex align-items-center"},Ns={key:1,class:"flex-fill text-muted"},Ps={key:2,class:"flex-fill"},Vs={class:"nowplaying-title"},qs={class:"nowplaying-artist"},Fs={key:3,class:"flex-fill"},Hs={class:"nowplaying-title"},Ms=["href"],Os=P({__name:"Dashboard",props:{profileUrl:{},adminUrl:{},showAdmin:{type:Boolean},showCharts:{type:Boolean},manageStationsUrl:{},showAlbumArt:{type:Boolean}},setup(k){const p=g("/frontend/dashboard/notifications"),f=g("/frontend/dashboard/charts"),_=g("/frontend/dashboard/stations"),h=es("dashboard_show_chart",!0),{$gettext:a}=M(),v=S(()=>h.value?a("Hide Charts"):a("Show Charts")),{axios:V}=D(),{state:w,isLoading:q}=N(()=>V.get(p.value).then(c=>c.data),[]),F=[{key:"play_button",label:"",sortable:!1,class:"shrink"},{key:"name",label:a("Station Name"),sortable:!0},{key:"listeners",label:a("Listeners"),sortable:!0},{key:"now_playing",label:a("Now Playing"),sortable:!0},{key:"actions",label:"",sortable:!1,class:"shrink"}],x=C("$datatable"),{refresh:H}=os(x);O(H,S(()=>document.hidden?3e4:15e3));const $=C("$lightbox");return ts($),(c,u)=>(o(),i(b,null,[t("div",is,[t("section",{class:"card",role:"region","aria-label":e(a)("Account Details")},[n(as,null,{default:r(()=>[t("a",{class:"btn btn-dark",role:"button",href:c.profileUrl},[n(m,{icon:e(j)},null,8,["icon"]),t("span",null,l(e(a)("My Account")),1)],8,cs),c.showAdmin?(o(),i("a",{key:0,class:"btn btn-dark",role:"button",href:c.adminUrl},[n(m,{icon:e(A)},null,8,["icon"]),t("span",null,l(e(a)("Administration")),1)],8,ds)):d("",!0)]),_:1}),!e(q)&&e(w).length>0?(o(!0),i(b,{key:0},X(e(w),s=>(o(),i("div",{key:s.title,class:B(["card-body d-flex align-items-center alert flex-md-row flex-column","alert-"+s.type]),role:"alert","aria-live":"polite"},[s.type==="info"?(o(),i("div",_s,[n(m,{icon:e(z),class:"lg"},null,8,["icon"])])):(o(),i("div",hs,[n(m,{icon:e(E),class:"lg"},null,8,["icon"])])),t("div",ms,[t("h4",null,l(s.title),1),t("p",us,l(s.body),1)]),s.actionLabel&&s.actionUrl?(o(),i("div",ps,[t("a",{class:B(["btn btn-sm","btn-"+s.type]),href:s.actionUrl,target:"_blank"},l(s.actionLabel),11,fs)])):d("",!0)],2))),128)):d("",!0)],8,rs),c.showCharts?(o(),y(I,{key:0,"header-id":"hdr_listeners_per_station"},{header:r(({id:s})=>[t("div",bs,[t("div",gs,[t("h3",{id:s,class:"card-title"},l(e(a)("Listeners Per Station")),9,ys)]),t("div",ks,[t("button",{type:"button",class:"btn btn-sm btn-dark py-2",onClick:u[0]||(u[0]=Ts=>h.value=!e(h))},l(v.value),1)])])]),default:r(()=>[e(h)?(o(),i("div",vs,[n(ns,{"charts-url":e(f)},null,8,["charts-url"])])):d("",!0)]),_:1})):d("",!0),n(I,{"header-id":"hdr_stations"},{header:r(({id:s})=>[t("div",ws,[t("div",xs,[t("h2",{id:s,class:"card-title"},l(e(a)("Station Overview")),9,$s)]),c.showAdmin?(o(),i("div",As,[t("a",{class:"btn btn-dark py-2",href:c.manageStationsUrl},[n(m,{icon:e(A)},null,8,["icon"]),t("span",null,l(e(a)("Manage Stations")),1)],8,Us)])):d("",!0)])]),default:r(()=>[n(ls,{id:"dashboard_stations",ref_key:"$datatable",ref:x,fields:F,"api-url":e(_),paginated:"",responsive:"","show-toolbar":"","hide-on-loading":!1},{"cell(play_button)":r(({item:s})=>[n(G,{class:"file-icon btn-lg",url:s.station.listen_url,"is-stream":""},null,8,["url"])]),"cell(name)":r(({item:s})=>[t("div",Ls,l(s.station.name),1),s.station.is_public?(o(),i("div",Ss,[t("a",{href:s.links.public,target:"_blank"},l(e(a)("Public Page")),9,Cs)])):d("",!0)]),"cell(listeners)":r(({item:s})=>[t("span",Bs,[n(m,{class:"sm align-middle",icon:e(W)},null,8,["icon"])]),s.links.listeners?(o(),i("a",{key:0,href:s.links.listeners,"aria-label":e(a)("View Listener Report")},l(s.listeners.total),9,Is)):(o(),i(b,{key:1},[Y(l(s.listeners.total),1)],64))]),"cell(now_playing)":r(({item:s})=>[t("div",Ds,[c.showAlbumArt?(o(),y(J,{key:0,src:s.now_playing.song.art,class:"flex-shrink-0 pe-3"},null,8,["src"])):d("",!0),s.is_online?s.now_playing.song.title!==""?(o(),i("div",Ps,[t("strong",null,[t("span",Vs,l(s.now_playing.song.title),1)]),u[1]||(u[1]=t("br",null,null,-1)),t("span",qs,l(s.now_playing.song.artist),1)])):(o(),i("div",Fs,[t("strong",null,[t("span",Hs,l(s.now_playing.song.text),1)])])):(o(),i("div",Ns,l(e(a)("Station Offline")),1))])]),"cell(actions)":r(({item:s})=>[t("a",{class:"btn btn-primary",href:s.links.manage,role:"button"},l(e(a)("Manage")),9,Ms)]),_:1},8,["api-url"])]),_:1})]),n(ss),n(Z,{ref_key:"$lightbox",ref:$},null,512)],64))}});T(R(Os));
