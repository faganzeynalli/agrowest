import{_,C as z,af as A,ag as C}from"./icons-Be1GHOkw.js";import{_ as I}from"./DataTable-CrCmxr5K.js";import{_ as V}from"./DateRangeDropdown-DpkC-lYI.js";import{b as $,u as L}from"./usePlayerStore-iWc_R0_O.js";import{g as E}from"./router-DV66O1Vz.js";import{u as B}from"./useHasDatatable-DPFcIMM0.js";import{u as H}from"./useStationDateTimeFormatter-COniCxZ4.js";import{u as J}from"./luxon-BxseJ3_R.js";import{d as O,r as q,c as k,i as F,s as M,b as o,e as l,g as p,t,u as n,w as f,o as r,F as c,h as m,z as N,q as w}from"./vue-Cts3TEHg.js";import"./lodash-Bdl6ys83.js";import"./lodash-BwctMegf.js";import"./FormMultiCheck-BRaoZhWq.js";import"./FormCheckbox-VeRpO6PO.js";import"./useOptionalStorage-DRR25quy.js";import"./index-H7w3-DKz.js";import"./PanelLayout-B-Abw35c.js";import"./bootstrap.esm-BZy605kZ.js";import"./datetime-BTmRqpun.js";const j={class:"card"},G={class:"card-header text-bg-primary"},K={class:"d-lg-flex align-items-center"},Q={class:"card-title flex-fill my-0"},W={class:"flex-shrink buttons mt-2 mt-lg-0"},X=["href"],Y={class:"flex-shrink buttons ms-lg-2 mt-2 mt-lg-0"},Z={class:"typography-subheading"},ee={key:0,class:"text-success"},te={key:1,class:"text-danger"},he=O({__name:"Timeline",setup(ae){const h=E("/history"),{timezone:v}=$(),{DateTime:d}=J(),{now:D,formatDateTimeAsDateTime:x,formatTimestampAsDateTime:S}=H(),b=D(),u=q({startDate:b.minus({days:13}).toJSDate(),endDate:b.toJSDate()}),{$gettext:a}=L(),U=[{key:"played_at",label:a("Date/Time (Browser)"),selectable:!0,sortable:!1,visible:!1,formatter:s=>x(d.fromSeconds(s,{zone:"system"}),d.DATETIME_SHORT)},{key:"played_at_station",label:a("Date/Time (Station)"),sortable:!1,selectable:!0,visible:!0,formatter:(s,i,e)=>S(e.played_at,d.DATETIME_SHORT)},{key:"listeners_start",label:a("Listeners"),selectable:!0,sortable:!1},{key:"delta",label:a("Change"),selectable:!0,sortable:!1},{key:"song",isRowHeader:!0,label:a("Song Title"),selectable:!0,sortable:!1},{key:"source",label:a("Source"),selectable:!0,sortable:!1}],g=k(()=>{const s=new URL(h.value,document.location.href),i=s.searchParams;return i.set("start",d.fromJSDate(u.value.startDate).toISO()),i.set("end",d.fromJSDate(u.value.endDate).toISO()),s.toString()}),P=k(()=>{const s=new URL(g.value,document.location.href);return s.searchParams.set("format","csv"),s.toString()}),y=s=>Math.abs(s),T=F("$dataTable"),{navigate:R}=B(T);return M(u,()=>void w(R)),(s,i)=>(r(),o("div",j,[l("div",G,[l("div",K,[l("h2",Q,t(n(a)("Song Playback Timeline")),1),l("div",W,[l("a",{id:"btn-export",class:"btn btn-dark",href:P.value,target:"_blank"},[p(_,{icon:n(z)},null,8,["icon"]),l("span",null,t(n(a)("Download CSV")),1)],8,X)]),l("div",Y,[p(V,{modelValue:u.value,"onUpdate:modelValue":i[0]||(i[0]=e=>u.value=e),options:{enableTimePicker:!0,timezone:n(v)},class:"btn-dark"},null,8,["modelValue","options"])])])]),p(I,{ref_key:"$dataTable",ref:T,paginated:"","select-fields":"",fields:U,"api-url":g.value},{"cell(delta)":f(e=>[l("span",Z,[e.item.delta_total>0?(r(),o("span",ee,[p(_,{icon:n(A)},null,8,["icon"]),m(" "+t(y(e.item.delta_total)),1)])):e.item.delta_total<0?(r(),o("span",te,[p(_,{icon:n(C)},null,8,["icon"]),m(" "+t(y(e.item.delta_total)),1)])):(r(),o(c,{key:2},[m(" 0 ")],64))])]),"cell(song)":f(e=>[l("div",{class:N({"text-muted":!e.item.is_visible})},[e.item.song.title?(r(),o(c,{key:0},[l("b",null,t(e.item.song.title),1),i[1]||(i[1]=l("br",null,null,-1)),m(" "+t(e.item.song.artist),1)],64)):(r(),o(c,{key:1},[m(t(e.item.song.text),1)],64))],2)]),"cell(source)":f(e=>[e.item.is_request?(r(),o(c,{key:0},[m(t(n(a)("Listener Request")),1)],64)):e.item.playlist?(r(),o(c,{key:1},[m(t(n(a)("Playlist:"))+" "+t(e.item.playlist),1)],64)):e.item.streamer?(r(),o(c,{key:2},[m(t(n(a)("Live Streamer:"))+" "+t(e.item.streamer),1)],64)):(r(),o(c,{key:3},[m(" Â  ")],64))]),_:1},8,["api-url"])]))}});export{he as default};
