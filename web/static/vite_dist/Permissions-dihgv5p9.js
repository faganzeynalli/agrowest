import{_ as z}from"./DataTable-vHTsgTi6.js";import{_ as K}from"./ModalForm-DCJoVv1E.js";import{u as O}from"./useBaseEditModal-sDXNj8zk.js";import{u as G}from"./usePlayerStore-KLtIIp-S.js";import{_ as I,u as J}from"./index-CD5urVsR.js";import{_ as H}from"./FormGroupMultiCheck-C9YvEz8-.js";import{_ as q,a as Q}from"./Tab--yLl8rRe.js";import{u as j}from"./useVuelidateOnFormTab-DDZqQ533.js";import{r as W}from"./index-CSh-MSYs.js";import{d as R,a4 as N,L as V,h as M,o as n,w as $,e as o,g as _,u as t,b,t as c,c as B,B as X,f as S,F as E,s as x,i as L,j as D,K as F}from"./vue-B-dHMJBO.js";import{l as f}from"./lodash-Bdl6ys83.js";import{_ as Y,a5 as Z}from"./icons-Yf7pfv1X.js";import{u as ss}from"./useHasDatatable-DPFcIMM0.js";import{u as ts,_ as es}from"./AddButton-mzslCaiE.js";import{u as os}from"./useConfirmAndDelete-ultb9O-u.js";import{_ as is}from"./CardPage-0fdasE1K.js";import{a as ns}from"./router-CjgRDsAC.js";import"./FormMultiCheck-C8kU6V99.js";import"./FormCheckbox-CBrIHDuX.js";import"./useOptionalStorage-BvRWWVwv.js";import"./index-DXvg9C8z.js";import"./InvisibleSubmitButton-DW6QYji6.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useSlotsExcept-ZKe4NxAj.js";import"./useHasModal-By0OKlXq.js";import"./bootstrap.esm-BZy605kZ.js";import"./Loading-B4WK-6A0.js";import"./mergeExisting-D7dGFTzO.js";import"./useVuelidateOnForm-BP2H-zhB.js";import"./lodash-BwctMegf.js";import"./useFormField-CS-SOlLc.js";import"./FormGroup-DZPf8gKm.js";import"./useDialog-BB0zrQKD.js";import"./InfoCard-D6xe4CFe.js";const rs={class:"row g-3"},as=R({__name:"GlobalForm",props:N({globalPermissions:{}},{form:{required:!0},formModifiers:{}}),emits:["update:form"],setup(m){const d=V(m,"form"),{v$:e}=j(d,{name:{required:W},permissions:{global:{}}},()=>({name:"",permissions:{global:[]}}));return(s,v)=>(n(),M(q,{label:s.$gettext("Global Permissions")},{default:$(()=>[o("div",rs,[_(I,{id:"edit_form_name",class:"col-md-12",field:t(e).name,label:s.$gettext("Role Name")},null,8,["field","label"]),_(H,{id:"edit_form_global_permissions",class:"col-md-12",field:t(e).permissions.global,options:s.globalPermissions,stacked:"",label:s.$gettext("Global Permissions"),description:s.$gettext("Users with this role will have these permissions across the entire installation.")},null,8,["field","options","label","description"])])]),_:1},8,["label"]))}}),ls={class:"card mb-3",role:"region"},ms={class:"card-header text-bg-primary d-flex align-items-center"},ds={class:"flex-fill"},ps={class:"card-title"},us={class:"flex-shrink-0"},cs={class:"card-body"},fs={class:"row g-3"},bs=R({__name:"StationRow",props:N({stations:{},stationPermissions:{}},{row:{required:!0},rowModifiers:{}}),emits:N(["remove"],["update:row"]),setup(m){const d=m,e=V(m,"row"),s=J({permissions:{}},e),v=r=>f.get(d.stations,r,null);return(r,h)=>(n(),b("section",ls,[o("div",ms,[o("div",ds,[o("h2",ps,c(v(e.value.id)),1)]),o("div",us,[o("button",{type:"button",class:"btn btn-sm btn-light py-2",onClick:h[0]||(h[0]=i=>r.$emit("remove"))},[_(Y,{icon:t(Z)},null,8,["icon"]),o("span",null,c(r.$gettext("Remove")),1)])])]),o("div",cs,[o("div",fs,[_(H,{id:"edit_form_station_permissions_"+e.value.id,class:"col-md-12",field:t(s).permissions,options:r.stationPermissions,stacked:"",label:r.$gettext("Station Permissions"),description:r.$gettext("Users with this role will have these permissions for this single station.")},null,8,["id","field","options","label","description"])])])]))}}),_s={key:0,class:"btn-group btn-group-sm"},gs={class:"dropdown btn-group"},$s={class:"btn btn-sm btn-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},vs={class:"dropdown-menu"},hs=["onClick"],ks=R({__name:"StationForm",props:N({stations:{},stationPermissions:{}},{form:{required:!0},formModifiers:{}}),emits:["update:form"],setup(m){const d=m,e=V(m,"form");j(e,{permissions:{station:{}}},()=>({permissions:{station:[]}}));const s=B(()=>{var g;const i=((g=e.value.permissions)==null?void 0:g.station)??[];return f.pickBy(X(d.stations),(k,a)=>!f.find(i,l=>l.id===Number(a)))}),v=B(()=>!f.isEmpty(s.value)),r=i=>{e.value.permissions.station.splice(i,1)},h=i=>{e.value.permissions.station.push({id:Number(i),permissions:[]})};return(i,g)=>(n(),M(q,{label:i.$gettext("Station Permissions")},{default:$(()=>{var k;return[(n(!0),b(E,null,x(((k=e.value.permissions)==null?void 0:k.station)??[],(a,l)=>(n(),M(bs,{key:l,row:e.value.permissions.station[l],"onUpdate:row":y=>e.value.permissions.station[l]=y,stations:i.stations,"station-permissions":i.stationPermissions,onRemove:y=>r(l)},null,8,["row","onUpdate:row","stations","station-permissions","onRemove"]))),128)),v.value?(n(),b("div",_s,[o("div",gs,[o("button",$s,[L(c(i.$gettext("Add Station"))+" ",1),g[0]||(g[0]=o("span",{class:"caret"},null,-1))]),o("ul",vs,[(n(!0),b(E,null,x(s.value,(a,l)=>(n(),b("li",{key:l},[o("button",{type:"button",class:"dropdown-item",onClick:y=>h(l)},c(a),9,hs)]))),128))])])])):S("",!0)]}),_:1},8,["label"]))}}),ys=R({__name:"EditModal",props:{stations:{},globalPermissions:{},stationPermissions:{},createUrl:{}},emits:["relist"],setup(m,{expose:d,emit:e}){const s=m,v=e,r=D("$modal"),{loading:h,error:i,isEditMode:g,v$:k,form:a,clearContents:l,create:y,edit:U,doSubmit:p,close:w}=O(s,v,r),{$gettext:u}=G(),P=B(()=>g.value?u("Edit Role"):u("Add Role"));return d({create:y,edit:U,close:w}),(T,C)=>(n(),M(K,{ref_key:"$modal",ref:r,loading:t(h),title:P.value,error:t(i),"disable-save-button":t(k).$invalid,onSubmit:t(p),onHidden:t(l)},{default:$(()=>[_(Q,{"content-class":"mt-3"},{default:$(()=>[_(as,{form:t(a),"onUpdate:form":C[0]||(C[0]=A=>F(a)?a.value=A:null),"global-permissions":T.globalPermissions},null,8,["form","global-permissions"]),_(ks,{form:t(a),"onUpdate:form":C[1]||(C[1]=A=>F(a)?a.value=A:null),stations:T.stations,"station-permissions":T.stationPermissions},null,8,["form","stations","station-permissions"])]),_:1})]),_:1},8,["loading","title","error","disable-save-button","onSubmit","onHidden"]))}}),Ps={class:"card-text"},ws={key:0},Rs={key:0,class:"btn-group btn-group-sm"},Cs=["onClick"],Ss=["onClick"],lt=R({__name:"Permissions",props:{stations:{},globalPermissions:{},stationPermissions:{}},setup(m){const d=m,e=ns("/admin/roles"),{$gettext:s}=G(),v=[{key:"name",isRowHeader:!0,label:s("Role Name"),sortable:!0},{key:"permissions",label:s("Permissions"),sortable:!1},{key:"actions",label:s("Actions"),sortable:!1,class:"shrink"}],r=p=>f.filter(f.map(p,w=>f.get(d.globalPermissions,w,null))),h=p=>f.filter(f.map(p,w=>f.get(d.stationPermissions,w,null))),i=p=>f.get(d.stations,p,null),g=D("$dataTable"),{relist:k}=ss(g),a=D("$editModal"),{doCreate:l,doEdit:y}=ts(a),{doDelete:U}=os(s("Delete Role?"),k);return(p,w)=>(n(),b(E,null,[_(is,{title:t(s)("Roles & Permissions")},{info:$(()=>[o("p",Ps,c(t(s)("AzuraCast uses a role-based access control system. Roles are given permissions to certain sections of the site, then users are assigned into those roles.")),1)]),actions:$(()=>[_(es,{text:t(s)("Add Role"),onClick:t(l)},null,8,["text","onClick"])]),default:$(()=>[_(z,{id:"permissions",ref_key:"$dataTable",ref:g,paginated:"",fields:v,"api-url":t(e)},{"cell(permissions)":$(u=>[u.item.permissions.global.length>0?(n(),b("div",ws,c(t(s)("Global"))+" : "+c(r(u.item.permissions.global).join(", ")),1)):S("",!0),(n(!0),b(E,null,x(u.item.permissions.station,P=>(n(),b("div",{key:P.id},[o("b",null,c(i(P.id)),1),L(": "+c(h(P.permissions).join(", ")),1)]))),128))]),"cell(actions)":$(u=>[u.item.is_super_admin?S("",!0):(n(),b("div",Rs,[o("button",{type:"button",class:"btn btn-primary",onClick:P=>t(y)(u.item.links.self)},c(t(s)("Edit")),9,Cs),u.item.id!==1?(n(),b("button",{key:0,type:"button",class:"btn btn-danger",onClick:P=>t(U)(u.item.links.self)},c(t(s)("Delete")),9,Ss)):S("",!0)]))]),_:1},8,["api-url"])]),_:1},8,["title"]),_(ys,{ref_key:"$editModal",ref:a,"create-url":t(e),"station-permissions":p.stationPermissions,stations:p.stations,"global-permissions":p.globalPermissions,onRelist:t(k)},null,8,["create-url","station-permissions","stations","global-permissions","onRelist"])],64))}});export{lt as default};
