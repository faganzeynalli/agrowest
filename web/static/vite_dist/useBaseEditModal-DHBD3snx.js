import{m as L}from"./mergeExisting-Ae2otqxP.js";import{f as M,d as N}from"./usePlayerStore-BkbxZM90.js";import{u as O}from"./useVuelidateOnForm-DDGZudIQ.js";import{U as P,r as v,c as k,q as S}from"./vue-iE2ul1Tq.js";function z(F,h,c,y,g,t={}){const E=P(F,"createUrl"),o=v(!1),n=v(null),u=v(null),l=k(()=>u.value!==null),{form:r,v$:i,resetForm:d}=O(y,g,t),a=()=>{if(typeof t.resetForm=="function"){t.resetForm(d);return}d()},f=()=>{if(typeof t.clearContents=="function"){t.clearContents(a);return}a(),o.value=!1,n.value=null,u.value=null},p=()=>{var e;f(),(e=c.value)==null||e.show(),S(()=>{a()})},R=e=>{if(typeof t.populateForm=="function"){t.populateForm(e,r);return}r.value=L(r.value,e)},{notifySuccess:U}=M(),{axios:b}=N(),x=()=>{if(o.value=!0,!u.value)throw new Error("No edit URL!");b.get(u.value).then(e=>{R(e.data)}).catch(()=>{m()}).finally(()=>{o.value=!1})},q=e=>{var s;f(),u.value=e,(s=c.value)==null||s.show(),S(()=>{a(),x()})},w=()=>typeof t.getSubmittableFormData=="function"?t.getSubmittableFormData(r,l):r.value,C=()=>typeof t.buildSubmitRequest=="function"?t.buildSubmitRequest():{method:l.value?"PUT":"POST",url:l.value&&u.value?u.value:E.value,data:w()},m=()=>{var e;(e=c.value)==null||e.hide()},D=()=>{if(typeof t.onSubmitSuccess=="function"){t.onSubmitSuccess();return}U(),h("relist"),m()},T=e=>{if(typeof t.onSubmitError=="function"){t.onSubmitError(e);return}n.value=e.response.data.message};return{loading:o,error:n,editUrl:u,isEditMode:l,form:r,v$:i,resetForm:a,clearContents:f,create:p,edit:q,doSubmit:()=>{i.value.$touch(),i.value.$validate().then(e=>{e&&(n.value=null,b(C()).then(()=>{D()}).catch(s=>{T(s)}))})},close:m}}export{z as u};
