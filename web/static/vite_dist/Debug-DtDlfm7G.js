import{_ as P}from"./DataTable-CmF0F31d.js";import{u as E,d as j,f as W}from"./usePlayerStore-BFODmuDt.js";import{_ as C}from"./CardPage-CE6bIKLu.js";import{u as K}from"./luxon-sR4yydxH.js";import{_ as X,u as Y}from"./useHasModal-wB1w8CB8.js";import{l as w}from"./lodash-Bdl6ys83.js";import{d as L,b as i,o as l,F as p,y as N,e as t,f as D,h as Z,z as tt,t as s,u as e,i as S,r as et,j as V,w as n,g as d}from"./vue-Cts3TEHg.js";import{a as st,_ as at}from"./Tabs-7V6tH1xR.js";import{a as T}from"./router-DXJ7Mde1.js";import{u as ot}from"./useRefreshableAsyncState-DBsl0LgE.js";import{_ as B}from"./Loading-zTzdosl6.js";import{_ as z,a8 as M}from"./icons-DHGLRlMD.js";import{u as O}from"./useAutoRefreshingAsyncState-BduYF3Ox.js";import"./FormMultiCheck-BRaoZhWq.js";import"./FormCheckbox-VeRpO6PO.js";import"./useOptionalStorage-CJpWhhP4.js";import"./index-BqF5ooeJ.js";import"./bootstrap.esm-BZy605kZ.js";import"./lodash-BwctMegf.js";import"./InfoCard-iwtUiWoN.js";import"./datetime-BTmRqpun.js";const nt=["id"],lt={class:"mb-0"},it={key:0,class:"buttons mt-3"},ct=["data-bs-target","aria-controls"],rt=["id","aria-labelledby"],dt={class:"card-body pb-0"},ut=L({__name:"TaskOutput",props:{logs:{}},setup(A){const k={100:"text-bg-info",200:"text-bg-info",250:"text-bg-info",300:"text-bg-warning",400:"text-bg-danger",500:"text-bg-danger",550:"text-bg-danger",600:"text-bg-danger"},v=b=>w.get(k,b,k[100]),{$gettext:c}=E(),h={100:c("Debug"),200:c("Info"),250:c("Notice"),300:c("Warning"),400:c("Error"),500:c("Critical"),550:c("Alert"),600:c("Emergency")},R=b=>w.get(h,b,h[100]),m=b=>JSON.stringify(b);return(b,Q)=>(l(!0),i(p,null,N(b.logs,(_,g)=>(l(),i("div",{id:"log-view",key:g,class:"card mb-3"},[t("div",{id:"log-row-"+g,class:"card-header"},[t("h4",lt,[t("span",{class:tt(["badge",v(_.level)])},s(R(_.level)),3),Z(" "+s(_.message),1)]),_.context||_.extra?(l(),i("div",it,[t("button",{class:"btn btn-sm btn-bg",type:"button","data-bs-toggle":"collapse","data-bs-target":"#detail-row-"+g,"aria-controls":"detail-row-"+g},s(e(c)("Details")),9,ct)])):D("",!0)],8,nt),_.context||_.extra?(l(),i("div",{key:0,id:"detail-row-"+g,class:"collapse","aria-labelledby":"log-row-"+g,"data-parent":"#log-view"},[t("div",dt,[t("dl",null,[(l(!0),i(p,null,N(_.context,($,f)=>(l(),i(p,{key:f},[t("dt",null,s(f),1),t("dd",null,s(m($)),1)],64))),128)),(l(!0),i(p,null,N(_.extra,($,f)=>(l(),i(p,{key:f},[t("dt",null,s(f),1),t("dd",null,s(m($)),1)],64))),128))])])],8,rt)):D("",!0)]))),128))}}),mt={style:{"max-height":"300px","overflow-y":"scroll"}},_t=L({__name:"TaskOutputModal",setup(A,{expose:k}){const v=S("$modal"),{show:c}=Y(v),h=et([]);return k({open:m=>{h.value=m,c()}}),(m,b)=>(l(),V(X,{ref_key:"$modal",ref:v,title:m.$gettext("Log Output"),size:"lg"},{default:n(()=>[t("div",mt,[d(ut,{logs:h.value},null,8,["logs"])])]),_:1},8,["title"]))}}),bt={class:"outside-card-header mb-1"},gt={class:"row row-of-cards"},pt={class:"col-md-6"},ht={class:"card-body"},ft={class:"card-text"},yt={class:"col-md-6"},kt={class:"card-body"},vt={class:"card-text"},xt={class:"d-md-flex align-items-center"},$t={class:"flex-fill my-0"},Ct=["id"],Tt={class:"flex-shrink buttons mt-2 mt-md-0"},Nt={key:0},Rt={key:1},St=["onClick"],Lt={class:"d-md-flex align-items-center"},At={class:"flex-fill my-0"},Qt=["id"],Ut={class:"flex-shrink buttons mt-2 mt-md-0"},qt={class:"card-body"},wt={class:"row"},Dt={class:"mb-0"},Bt={class:"buttons"},zt=["onClick"],Mt={class:"card-body"},Ot={class:"row"},Et={class:"col-md-4"},Vt={class:"buttons"},Ft=["onClick"],Gt=["onClick"],Ht={class:"col-md-4"},It={class:"buttons"},Jt=["onClick"],be=L({__name:"Debug",setup(A){const k=T("/admin/debug/sync-tasks"),v=T("/admin/debug/queues"),c=T("/admin/debug/stations"),h=T("/admin/debug/clear-cache"),R=T("/admin/debug/clear-queue"),{axios:m}=j(),{state:b,isLoading:Q,execute:_}=O(()=>m.get(k.value).then(r=>r.data),[],{timeout:6e4}),{state:g,isLoading:$,execute:f}=O(()=>m.get(v.value).then(r=>r.data),[],{timeout:6e4}),{state:F,isLoading:G}=ot(()=>m.get(c.value).then(r=>r.data),[]),{$gettext:a}=E(),{timestampToRelative:U}=K(),H=[{key:"name",isRowHeader:!0,label:a("Task Name"),sortable:!0},{key:"time",label:a("Last Run"),formatter:r=>r===0?a("Not Run"):U(r),sortable:!0},{key:"nextRun",label:a("Next Run"),formatter:r=>U(r),sortable:!0},{key:"actions",label:a("Actions")}],I=S("$dataTable"),q=S("$modal"),{notifySuccess:J}=W(),y=r=>{m.put(r).then(u=>{var o;u.data.logs?(o=q.value)==null||o.open(u.data.logs):J(u.data.message)})};return(r,u)=>(l(),i(p,null,[t("h2",bt,s(e(a)("System Debugger")),1),t("div",gt,[t("div",pt,[d(C,{"header-id":"hdr_clear_cache",title:e(a)("Clear Cache")},{footer_actions:n(()=>[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:u[0]||(u[0]=o=>y(e(h)))},s(e(a)("Clear Cache")),1)]),default:n(()=>[t("div",ht,[t("p",ft,s(e(a)("Clearing the application cache may log you out of your session.")),1)])]),_:1},8,["title"])]),t("div",yt,[d(C,{"header-id":"hdr_clear_queues",title:e(a)("Clear All Message Queues")},{footer_actions:n(()=>[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:u[1]||(u[1]=o=>y(e(R)))},s(e(a)("Clear All Message Queues")),1)]),default:n(()=>[t("div",kt,[t("p",vt,s(e(a)("This will clear any pending unprocessed messages in all message queues.")),1)])]),_:1},8,["title"])])]),d(C,{class:"mb-3","header-id":"hdr_sync_tasks"},{header:n(({id:o})=>[t("div",xt,[t("div",$t,[t("h2",{id:o,class:"card-title"},s(e(a)("Synchronization Tasks")),9,Ct)]),t("div",Tt,[t("button",{type:"button",class:"btn btn-dark",onClick:u[2]||(u[2]=x=>e(_)())},[d(z,{icon:e(M)},null,8,["icon"]),t("span",null,s(e(a)("Refresh")),1)])])])]),default:n(()=>[d(P,{ref_key:"$dataTable",ref:I,fields:H,items:e(b),loading:e(Q),"handle-client-side":"","show-toolbar":!1},{"cell(name)":n(o=>[t("h5",null,s(o.item.task),1),o.item.pattern?(l(),i("span",Nt,s(o.item.pattern),1)):(l(),i("span",Rt,s(e(a)("Custom")),1))]),"cell(actions)":n(o=>[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:x=>y(o.item.url)},s(e(a)("Run Task")),9,St)]),_:1},8,["items","loading"])]),_:1}),d(C,{class:"mb-3","header-id":"hdr_message_queues"},{header:n(({id:o})=>[t("div",Lt,[t("div",At,[t("h2",{id:o,class:"card-title"},s(e(a)("Message Queues")),9,Qt)]),t("div",Ut,[t("button",{type:"button",class:"btn btn-dark",onClick:u[3]||(u[3]=x=>e(f)())},[d(z,{icon:e(M)},null,8,["icon"]),t("span",null,s(e(a)("Refresh")),1)])])])]),default:n(()=>[t("div",qt,[d(B,{loading:e($)},{default:n(()=>[t("div",wt,[(l(!0),i(p,null,N(e(g),o=>(l(),i("div",{key:o.name,class:"col"},[t("h5",Dt,s(o.name),1),t("p",null,s(e(a)("%{messages} queued messages",{messages:o.count})),1),t("div",Bt,[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:x=>y(o.url)},s(e(a)("Clear Queue")),9,zt)])]))),128))])]),_:1},8,["loading"])])]),_:1}),d(C,{"header-id":"hdr_station_debugging",title:e(a)("Station-Specific Debugging")},{default:n(()=>[t("div",Mt,[d(B,{loading:e(G),lazy:""},{default:n(()=>[d(st,null,{default:n(()=>[(l(!0),i(p,null,N(e(F),o=>(l(),V(at,{key:o.id,label:o.name},{default:n(()=>[t("h3",null,s(o.name),1),t("div",Ot,[t("div",Et,[t("h5",null,s(e(a)("AutoDJ Queue")),1),t("div",Vt,[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:x=>y(o.clearQueueUrl)},s(e(a)("Clear Queue")),9,Ft),t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:x=>y(o.getNextSongUrl)},s(e(a)("Get Next Song")),9,Gt)])]),t("div",Ht,[t("h5",null,s(e(a)("Get Now Playing")),1),t("div",It,[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:x=>y(o.getNowPlayingUrl)},s(e(a)("Run Task")),9,Jt)])])])]),_:2},1032,["label"]))),128))]),_:1})]),_:1},8,["loading"])])]),_:1},8,["title"]),d(_t,{ref_key:"$modal",ref:q},null,512)],64))}});export{be as default};
