import{_ as U,n as Q,i as W,ak as X}from"./icons-Yf7pfv1X.js";import{_ as Y}from"./DataTable-vHTsgTi6.js";import{u as H,_ as Z}from"./useHasModal-By0OKlXq.js";import{d as N,j as w,h as I,o as c,w as r,e as t,t as n,r as T,c as ee,g as o,b as m,f as E,u as e,x as j,D as te,n as ae,k as oe,m as se,v as le,E as ie,i as G,p as ne,F as ue}from"./vue-B-dHMJBO.js";import{f as re}from"./formatFileSize--9DaIXge.js";import{_ as A}from"./index-CD5urVsR.js";import{_ as ce}from"./ModalForm-DCJoVv1E.js";import{_ as K}from"./FormFieldset-CSY1jkmB.js";import{m as de}from"./mergeExisting-D7dGFTzO.js";import{_ as F}from"./FormGroupCheckbox-O5T6tFbU.js";import{_ as pe}from"./TimeCode-CYxn4qP2.js";import{d as P,f as me,u as _e,a as be}from"./usePlayerStore-KLtIIp-S.js";import{u as q}from"./useVuelidateOnForm-BP2H-zhB.js";import{_ as fe}from"./FormGroupMultiCheck-C9YvEz8-.js";import{_ as J}from"./FormGroupSelect-DSNeFZce.js";import{I as ke}from"./InvisibleSubmitButton-DW6QYji6.js";import{_ as ge}from"./StreamingLogView-B6j6brsW.js";import{_ as he}from"./EnabledBadge-Q7PvS3oe.js";import{u as ve}from"./useConfirmAndDelete-ultb9O-u.js";import{_ as $e}from"./Loading-B4WK-6A0.js";import{_ as D}from"./CardPage-0fdasE1K.js";import{u as ye}from"./luxon-Dh54MNAX.js";import{a as V}from"./router-CjgRDsAC.js";import"./lodash-Bdl6ys83.js";import"./lodash-BwctMegf.js";import"./FormMultiCheck-C8kU6V99.js";import"./FormCheckbox-CBrIHDuX.js";import"./useOptionalStorage-BvRWWVwv.js";import"./index-DXvg9C8z.js";import"./bootstrap.esm-BZy605kZ.js";import"./useFormField-CS-SOlLc.js";import"./FormGroup-DZPf8gKm.js";import"./useSlotsExcept-ZKe4NxAj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useDialog-BB0zrQKD.js";import"./InfoCard-D6xe4CFe.js";import"./datetime-BTmRqpun.js";const we={id:"modal-log-view-contents",class:"form-control log-viewer",style:{height:"300px","overflow-y":"auto"}},xe=N({__name:"LastOutputModal",props:{lastOutput:{}},setup(S,{expose:$}){const g=w("$modal"),{show:k}=H(g);return $({show:k}),(_,d)=>(c(),I(Z,{id:"log_view_modal",ref_key:"$modal",ref:g,size:"md",title:_.$gettext("Log Viewer")},{default:r(()=>[t("pre",we,n(_.lastOutput),1)]),_:1},8,["title"]))}}),Be={class:"row g-3 mb-3"},Le={key:0,class:"row g-3"},Se=N({__name:"ConfigureModal",props:{settingsUrl:{},storageLocations:{}},emits:["relist"],setup(S,{expose:$,emit:g}){const k=S,_=g,d=T(!0),{form:u,resetForm:s,v$:p,ifValid:y}=q({backup_enabled:{},backup_time_code:{},backup_exclude_media:{},backup_keep_copies:{},backup_storage_location:{},backup_format:{}},{backup_enabled:!1,backup_time_code:null,backup_exclude_media:null,backup_keep_copies:null,backup_storage_location:null,backup_format:null}),C=ee(()=>[{value:"zip",text:"Zip"},{value:"tgz",text:"TarGz"},{value:"tzst",text:"ZStd"}]),{axios:x}=P(),b=w("$modal"),{hide:M,show:h}=H(b),v=()=>{_("relist"),M()},z=()=>{s(),d.value=!0,h(),x.get(k.settingsUrl).then(a=>{u.value=de(u.value,a.data),d.value=!1}).catch(()=>{v()})},{notifySuccess:B}=me(),i=()=>{y(()=>{x({method:"PUT",url:k.settingsUrl,data:u.value}).then(()=>{B(),v()})})};return $({open:z}),(a,O)=>(c(),I(ce,{ref_key:"$modal",ref:b,size:"lg",title:a.$gettext("Configure Backups"),loading:d.value,"disable-save-button":e(p).$invalid,onSubmit:i,onHidden:e(s)},{default:r(()=>[o(K,null,{default:r(()=>[t("div",Be,[o(F,{id:"form_edit_backup_enabled",class:"col-md-12",field:e(p).backup_enabled,label:a.$gettext("Run Automatic Nightly Backups"),description:a.$gettext("Enable to have AzuraCast automatically run nightly backups at the time specified.")},null,8,["field","label","description"])]),e(u).backup_enabled?(c(),m("div",Le,[o(A,{id:"form_backup_time_code",class:"col-md-6",field:e(p).backup_time_code,label:a.$gettext("Scheduled Backup Time")},{default:r(({id:R,model:l,fieldClass:f})=>[o(pe,{id:R,modelValue:l.$model,"onUpdate:modelValue":L=>l.$model=L,class:j(f)},null,8,["id","modelValue","onUpdate:modelValue","class"])]),_:1},8,["field","label"]),o(F,{id:"form_edit_exclude_media",class:"col-md-6",field:e(p).backup_exclude_media,label:a.$gettext("Exclude Media from Backup"),description:a.$gettext("Excluding media from automated backups will save space, but you should make sure to back up your media elsewhere. Note that only locally stored media will be backed up.")},null,8,["field","label","description"]),o(A,{id:"form_backup_keep_copies",class:"col-md-6",field:e(p).backup_keep_copies,"input-type":"number","input-attrs":{min:"0",max:"365"},label:a.$gettext("Number of Backup Copies to Keep"),description:a.$gettext("Copies older than the specified number of days will automatically be deleted. Set to zero to disable automatic deletion.")},null,8,["field","label","description"]),o(J,{id:"edit_form_backup_storage_location",class:"col-md-6",field:e(p).backup_storage_location,label:a.$gettext("Storage Location"),options:a.storageLocations},null,8,["field","label","options"]),o(fe,{id:"edit_form_backup_format",class:"col-md-6",field:e(p).backup_format,stacked:"",radio:"",options:C.value,label:a.$gettext("Backup Format")},null,8,["field","options","label"])])):E("",!0)]),_:1})]),_:1},8,["title","loading","disable-save-button","onHidden"]))}}),Ce={class:"row g-3"},Me={class:"m-0"},ze={key:1},Re=N({__name:"RunBackupModal",props:{runBackupUrl:{},storageLocations:{}},emits:["relist"],setup(S,{expose:$,emit:g}){const k=S,_=g,d=T(null),u=T(null),s=w("$modal"),{show:p,hide:y}=H(s),{form:C,resetForm:x,v$:b,ifValid:M}=q({storage_location:{},path:{},exclude_media:{}},{storage_location:null,path:"",exclude_media:!1}),{axios:h}=P(),v=()=>{M(()=>{u.value=null,h({method:"POST",url:k.runBackupUrl,data:C.value}).then(i=>{d.value=i.data.links.log}).catch(i=>{i.value=i.response.data.message})})},z=()=>{d.value=null,u.value=null,x()},B=()=>{z(),_("relist")};return $({open:p}),(i,a)=>(c(),I(Z,{id:"run_backup_modal",ref_key:"$modal",ref:s,size:"md",centered:"",title:i.$gettext("Run Manual Backup"),onHidden:B},{default:r(()=>[se(t("div",{class:"alert alert-danger"},n(u.value),513),[[le,u.value!=null]]),d.value===null?(c(),m("form",{key:0,class:"form vue-form",onSubmit:ie(v,["prevent"])},[o(K,null,{default:r(()=>[t("div",Ce,[o(J,{id:"edit_form_storage_location",class:"col-md-12",field:e(b).storage_location,options:i.storageLocations,label:i.$gettext("Storage Location")},null,8,["field","options","label"]),o(A,{id:"edit_form_path",class:"col-md-12",field:e(b).path,label:i.$gettext("File Name")},{description:r(()=>[G(n(i.$gettext("This will be the file name for your backup, include the extension for file type you wish to use. Leave blank to have a name generated automatically."))+" ",1),a[3]||(a[3]=t("br",null,null,-1)),t("strong",null,n(i.$gettext("Supported file formats:")),1),a[4]||(a[4]=t("br",null,null,-1)),t("ul",Me,[a[1]||(a[1]=t("li",null,".zip",-1)),a[2]||(a[2]=t("li",null,".tar.gz",-1)),t("li",null," .tzst ( "+n(i.$gettext("ZStandard compression"))+" ) ",1)])]),_:1},8,["field","label"]),o(F,{id:"edit_form_exclude_media",class:"col-md-12",field:e(b).exclude_media,label:i.$gettext("Exclude Media from Backup"),description:i.$gettext("This will produce a significantly smaller backup, but you should make sure to back up your media elsewhere. Note that only locally stored media will be backed up.")},null,8,["field","label","description"])])]),_:1}),o(ke)],32)):(c(),m("div",ze,[o(ge,{"log-url":d.value},null,8,["log-url"])]))]),"modal-footer":r(O=>[te(i.$slots,"modal-footer",ae(oe(O)),()=>[t("button",{type:"button",class:"btn btn-secondary",onClick:a[0]||(a[0]=(...R)=>e(y)&&e(y)(...R))},n(i.$gettext("Close")),1),d.value===null?(c(),m("button",{key:0,class:j(["btn",e(b).$invalid?"btn-danger":"btn-primary"]),type:"submit",onClick:v},n(i.$gettext("Run Manual Backup")),3)):E("",!0)])]),_:3},8,["title"]))}}),Te={class:"outside-card-header mb-1"},Oe={class:"row row-of-cards"},Ee={class:"col-md-6"},Ne=["id"],Ue={key:0,class:"card-body"},De={key:0,class:"card-text"},Ve={key:1,class:"card-text"},Ae={class:"col-md-6"},Fe={class:"card-body"},He={class:"card-text"},Ie={key:0},Pe={key:1},Ze={class:"card-text text-warning"},je={class:"btn-group btn-group-sm"},Ge=["href"],Ke=["onClick"],Tt=N({__name:"Backups",props:{storageLocations:{},isDocker:{type:Boolean,default:!0}},setup(S){const $=V("/admin/backups"),g=V("/admin/backups/run"),k=V("/admin/settings/backup"),_=T(!1),u=T({...{backupEnabled:!1,backupLastRun:0,backupLastOutput:""}}),{$gettext:s}=_e(),{timeConfig:p}=be(),{DateTime:y,timestampToRelative:C}=ye(),x=[{key:"basename",isRowHeader:!0,label:s("File Name"),sortable:!1},{key:"timestamp",label:s("Last Modified"),sortable:!1,formatter:l=>y.fromSeconds(l).toLocaleString({...y.DATETIME_SHORT,...p})},{key:"size",label:s("Size"),sortable:!1,formatter:l=>re(l)},{key:"actions",label:s("Actions"),sortable:!1,class:"shrink"}],b=w("$dataTable"),{axios:M}=P(),h=()=>{var l;_.value=!0,M.get(k.value).then(f=>{u.value={backupEnabled:f.data.backup_enabled,backupLastRun:f.data.backup_last_run,backupLastOutput:f.data.backup_last_output},_.value=!1}),(l=b.value)==null||l.relist()};ne(h);const v=w("$lastOutputModal"),z=()=>{var l;(l=v.value)==null||l.show()},B=w("$configureModal"),i=()=>{var l;(l=B.value)==null||l.open()},a=w("$runBackupModal"),O=()=>{var l;(l=a.value)==null||l.open()},{doDelete:R}=ve(s("Delete Backup?"),h);return(l,f)=>(c(),m(ue,null,[t("h2",Te,n(e(s)("Backups")),1),t("div",Oe,[t("div",Ee,[o(D,{"header-id":"hdr_automatic_backups"},{header:r(({id:L})=>[t("h2",{id:L,class:"card-title"},[G(n(e(s)("Automatic Backups"))+" ",1),o(he,{enabled:u.value.backupEnabled},null,8,["enabled"])],8,Ne)]),footer_actions:r(()=>[t("button",{type:"button",class:"btn btn-primary",onClick:i},[o(U,{icon:e(Q)},null,8,["icon"]),t("span",null,n(e(s)("Configure")),1)]),u.value.backupEnabled&&u.value.backupLastOutput!==""?(c(),m("button",{key:0,type:"button",class:"btn btn-secondary",onClick:z},[o(U,{icon:e(W)},null,8,["icon"]),t("span",null,n(e(s)("Most Recent Backup Log")),1)])):E("",!0)]),default:r(()=>[o($e,{loading:_.value},{default:r(()=>[u.value.backupEnabled?(c(),m("div",Ue,[u.value.backupLastRun>0?(c(),m("p",De,n(e(s)("Last run:"))+" "+n(e(C)(u.value.backupLastRun)),1)):(c(),m("p",Ve,n(e(s)("Never run")),1))])):E("",!0)]),_:1},8,["loading"])]),_:1})]),t("div",Ae,[o(D,{"header-id":"hdr_restoring_backups",title:e(s)("Restoring Backups")},{default:r(()=>[t("div",Fe,[t("p",He,n(e(s)("To restore a backup from your host computer, run:")),1),l.isDocker?(c(),m("pre",Ie,f[0]||(f[0]=[t("code",null,"./docker.sh restore path_to_backup.zip",-1)]))):(c(),m("pre",Pe,f[1]||(f[1]=[t("code",null,"/var/azuracast/www/bin/console azuracast:restore path_to_backup.zip",-1)]))),t("p",Ze,n(e(s)("Note that restoring a backup will clear your existing database. Never restore backup files from untrusted users.")),1)])]),_:1},8,["title"])])]),o(D,{"header-id":"hdr_backups",title:e(s)("Backups")},{actions:r(()=>[t("button",{type:"button",class:"btn btn-primary",onClick:O},[o(U,{icon:e(X)},null,8,["icon"]),t("span",null,n(e(s)("Run Manual Backup")),1)])]),default:r(()=>[o(Y,{id:"api_keys",ref_key:"$dataTable",ref:b,fields:x,"api-url":e($)},{"cell(actions)":r(L=>[t("div",je,[t("a",{class:"btn btn-primary",href:L.item.links.download,target:"_blank"},n(e(s)("Download")),9,Ge),t("button",{type:"button",class:"btn btn-danger",onClick:qe=>e(R)(L.item.links.delete)},n(e(s)("Delete")),9,Ke)])]),_:1},8,["api-url"])]),_:1},8,["title"]),o(Se,{ref_key:"$configureModal",ref:B,"settings-url":e(k),"storage-locations":l.storageLocations,onRelist:h},null,8,["settings-url","storage-locations"]),o(Re,{ref_key:"$runBackupModal",ref:a,"run-backup-url":e(g),"storage-locations":l.storageLocations,onRelist:h},null,8,["run-backup-url","storage-locations"]),o(xe,{ref_key:"$lastOutputModal",ref:v,"last-output":u.value.backupLastOutput},null,8,["last-output"])],64))}});export{Tt as default};
