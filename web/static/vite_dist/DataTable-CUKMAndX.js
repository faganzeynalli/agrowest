import{d as ae,b as o,z as U,H as le,t as k,o as l,c as u,r as R,s as N,U as te,e as s,f,j as V,F as w,y as j,m as pe,J as ve,ac as $e,E as Fe,N as ee,p as Re,g as B,u as L,G as M,h as D,A as Be,B as ue}from"./vue-Cts3TEHg.js";import{l as r}from"./lodash-Bdl6ys83.js";import{_ as G,a6 as De,a4 as Ue,a7 as Ve,a8 as xe,a9 as Ae}from"./icons-Be1GHOkw.js";import{a as Le,d as Oe,F as Ie}from"./usePlayerStore-CxT2g0bA.js";import{_ as Ke}from"./FormMultiCheck-BRaoZhWq.js";import{_ as ce}from"./FormCheckbox-VeRpO6PO.js";import{u as Ee}from"./useOptionalStorage-DbX2JW9G.js";const qe={key:1,class:"page-link"},T=ae({__name:"PaginationItem",props:{page:{default:1},label:{},active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["click"],setup(O,{emit:I}){const g=O,n=I,y=()=>{n("click",g.page)};return(c,h)=>(l(),o("li",{class:U(["page-item",[c.active?"active":"",c.disabled?"disabled":""]])},[c.disabled?(l(),o("span",qe,k(c.label??c.page),1)):(l(),o("a",{key:0,class:"page-link",href:"#",onClick:le(y,["prevent"])},k(c.label??c.page),1))],2))}}),Me={class:"d-flex"},Te={class:"pagination mb-0"},Ne={key:0,class:"input-group input-group-sm ms-2"},je=["max","aria-label","onKeydown"],de=ae({__name:"Pagination",props:{total:{},perPage:{},currentPage:{default:1},pageSpace:{default:1}},emits:["update:currentPage","change"],setup(O,{emit:I}){const g=O,n=I,y=u(()=>Math.max(1,Math.ceil(g.total/g.perPage))),c=R(1),h=i=>{i=r.clamp(i,1,y.value),d.value=i,c.value=i};N(te(g,"currentPage"),i=>{h(i)});const d=u({get(){return g.currentPage},set(i){n("update:currentPage",i),n("change",i)}}),b=u(()=>d.value>=g.pageSpace+2),K=u(()=>d.value>=g.pageSpace+4),m=u(()=>d.value<=y.value-(g.pageSpace+1)),P=u(()=>d.value<y.value-(g.pageSpace+2)),x=u(()=>{let i=Math.max(1,d.value-g.pageSpace);i-1===2&&i--;let $=Math.min(d.value+g.pageSpace,y.value);y.value-$===2&&$++;const _=[];for(let E=i;E<=$;E++)_.push(E);return _}),S=u(()=>y.value>10),F=()=>{h(c.value)};return(i,$)=>(l(),o("nav",Me,[s("ul",Te,[b.value?(l(),V(T,{key:0,page:1,active:d.value===1,onClick:h},null,8,["active"])):f("",!0),K.value?(l(),V(T,{key:1,label:"...",disabled:""})):f("",!0),(l(!0),o(w,null,j(x.value,_=>(l(),V(T,{key:_,page:_,active:d.value===_,onClick:h},null,8,["page","active"]))),128)),P.value?(l(),V(T,{key:2,label:"...",disabled:""})):f("",!0),m.value?(l(),V(T,{key:3,page:y.value,active:d.value===y.value,onClick:h},null,8,["page","active"])):f("",!0)]),S.value?(l(),o("div",Ne,[pe(s("input",{"onUpdate:modelValue":$[0]||($[0]=_=>c.value=_),type:"number",min:1,max:y.value,step:"1",class:"form-control rounded-start-2","aria-label":i.$gettext("Page"),style:{"max-width":"60px"},onKeydown:$e(le(F,["prevent"]),["enter"])},null,40,je),[[ve,c.value]]),s("button",{class:"btn btn-outline-secondary rounded-end-2",type:"button",onClick:F},k(i.$gettext("Go")),1)])):f("",!0)]))}}),ze=["id"],He={key:0,class:"datatable-toolbar-top card-body"},Ge={class:"row align-items-center"},Je={key:0,class:"col-xl-6 col-lg-5 col-md-12 col-sm-12"},We={key:1,class:"col-xl-6 col-lg-5 col-md-12 col-sm-12"},Qe={class:"col-xl-6 col-lg-7 col-md-12 col-sm-12 d-flex my-2"},Xe={class:"flex-fill"},Ye={class:"input-group"},Ze={class:"input-group-text"},et=["placeholder"],tt={class:"flex-shrink-1 ps-3"},at={class:"btn-group actions"},lt=["title"],st={key:0,class:"dropdown btn-group",role:"group"},ot=["title"],nt={class:"dropdown-menu"},rt=["onClick"],it={key:1,class:"dropdown btn-group",role:"group"},ut=["title"],ct={class:"dropdown-menu"},dt={class:"px-3 py-1"},pt={key:0},vt={key:0,class:"checkbox"},ft={class:"form-check"},gt={class:"visually-hidden"},ht=["aria-sort","onClick"],yt={class:"d-flex align-items-center"},bt={key:0},mt=["colspan"],kt={class:"spinner-border",role:"status"},_t={class:"visually-hidden"},Ct={key:1},wt=["colspan"],Pt={key:0,class:"checkbox"},St={class:"form-check"},$t={class:"visually-hidden"},Ft=["colspan"],Rt={key:1,class:"datatable-toolbar-bottom card-body"},It=ae({__name:"DataTable",props:{id:{},fields:{},apiUrl:{},items:{},responsive:{type:[Boolean,String],default:()=>!0},paginated:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},hideOnLoading:{type:Boolean,default:!0},showToolbar:{type:Boolean,default:!0},pageOptions:{default:()=>[10,25,50,100,250,500,0]},defaultPerPage:{default:10},selectable:{type:Boolean,default:!1},detailed:{type:Boolean,default:!1},selectFields:{type:Boolean,default:!1},handleClientSide:{type:Boolean,default:!1},requestConfig:{type:Function,default:void 0},requestProcess:{type:Function,default:void 0}},emits:["refresh-clicked","refreshed","row-selected","filtered","data-loaded"],setup(O,{expose:I,emit:g}){const n=O,y=Fe(),c=g,h=ee([]);N(h,e=>{c("row-selected",e)});const d=R(""),b=R(1),K=R(!1),m=R(null),P=R(null),x=R(!1);N(te(n,"loading"),e=>{x.value=e});const S=ee([]),F=R(0),i=ee(null),$=u(()=>r.map(n.fields,e=>({isRowHeader:!1,sortable:!1,selectable:!1,visible:!0,class:null,formatter:null,sorter:a=>r.get(a,e.key),...e}))),_=u(()=>r.filter({...$.value},e=>e.selectable??!1)),E=u(()=>r.map(_.value,e=>({value:e.key,text:e.label}))),J=u(()=>r.filter({..._.value},e=>e.visible??!0)),z=Ee("datatable_"+n.id+"_settings",{sortBy:null,sortDesc:!1,perPage:n.defaultPerPage,visibleFieldKeys:r.map(J.value,e=>e.key)},{mergeDefaults:!0}),W=u({get:()=>{const e=ue(z.value.visibleFieldKeys);return r.isEmpty(e)?r.map(J.value,a=>a.key):e},set:e=>{r.isEmpty(e)&&(e=r.map(J.value,a=>a.key)),z.value.visibleFieldKeys=e}}),C=u(()=>{var e;return n.paginated?((e=z.value)==null?void 0:e.perPage)??n.defaultPerPage:-1}),Q=u(()=>{const e=$.value.slice();if(!n.selectFields)return e;const a=W.value;return r.filter(e,t=>t.selectable?r.includes(a,t.key):!0)}),se=e=>e===0?"Hamısı":e.toString(),fe=u(()=>se(C.value)),oe=u(()=>n.paginated&&C.value!==0),{localeShort:ge}=Le(),ne=()=>{let e=r.filter(ue(n.items),a=>Object.entries(a).filter(t=>{const[p,v]=t;return!v||p[0]==="_"?!1:(typeof v=="object"?JSON.stringify(Object.values(v)):typeof v=="string"?v:v.toString()).toLowerCase().includes(d.value.toLowerCase())}).length>0);if(F.value=e.length,m.value){const a=new Intl.Collator(ge,{numeric:!0,sensitivity:"base"});e=e.sort((t,p)=>a.compare(m.value.sorter(t),m.value.sorter(p))),P.value==="desc"&&(e=r.reverse(e))}n.paginated&&C.value>0&&(e=r.slice(e,(b.value-1)*C.value,b.value*C.value)),S.value=e,c("refreshed")};N(te(n,"items"),()=>{n.handleClientSide&&ne()},{immediate:!0});const{axios:he}=Oe(),ye=()=>{const e={internal:!0};n.handleClientSide?e.rowCount=0:(n.paginated?(e.rowCount=C.value,e.current=C.value!==0?b.value:1):e.rowCount=0,K.value&&(e.flushCache=!0),d.value!==""&&(e.searchPhrase=d.value),m.value!==null&&(e.sort=m.value.key,e.sortOrder=P.value==="desc"?"DESC":"ASC"));let a={params:e};typeof n.requestConfig=="function"&&(a=n.requestConfig(a)),x.value=!0,he.get(n.apiUrl,a).then(t=>{F.value=t.data.total;let p=t.data.rows??[];typeof n.requestProcess=="function"&&(p=n.requestProcess(p)),c("data-loaded",p),S.value=p}).catch(t=>{F.value=0,console.error(t.response.data.message)}).finally(()=>{x.value=!1,K.value=!1,c("refreshed")})},A=()=>{h.value=[],i.value=null,n.handleClientSide?ne():ye()},re=e=>{b.value=e,A()},q=()=>{K.value=!0,A()},be=e=>{c("refresh-clicked",e),e.shiftKey?q():A()},me=()=>{d.value="",b.value=1,q()},ke=e=>{d.value=e};N(C,()=>{b.value=1,q()}),Ie(d,e=>{b.value=1,q(),c("filtered",e)},{debounce:500,maxWait:1e3}),Re(A);const X=u(()=>S.value.length===0?!1:!r.some(S.value,e=>r.indexOf(h.value,e)<0)),Y=e=>r.indexOf(h.value,e)>=0,Z=u(()=>{let e=Q.value.length;return e+=n.selectable?1:0,e}),_e=e=>{var a,t;e.sortable&&(((a=m.value)==null?void 0:a.key)===e.key&&P.value==="desc"?(P.value=null,m.value=null):(P.value=((t=m.value)==null?void 0:t.key)===e.key?"desc":"asc",m.value=e),A())},Ce=e=>{const a=h.value.slice();if(Y(e)){const t=r.indexOf(a,e);t>=0&&a.splice(t,1)}else a.push(e);h.value=a},we=()=>{const e=[];X.value||r.forEach(S.value,a=>{e.push(a)}),h.value=e},H=e=>i.value===e,ie=e=>{i.value=H(e)?null:e},Pe=u(()=>typeof n.responsive=="string"?n.responsive:n.responsive?"table-responsive":""),Se=(e,a)=>{const t=r.get(a,e.key,null);return e.formatter?e.formatter(t,e.key,a):t};return I({refresh:A,relist:q,navigate:me,setFilter:ke,toggleDetails:ie}),(e,a)=>(l(),o("div",{id:e.id,class:"datatable-wrapper"},[e.showToolbar?(l(),o("div",He,[s("div",Ge,[oe.value?(l(),o("div",Je,[B(de,{"current-page":b.value,"onUpdate:currentPage":a[0]||(a[0]=t=>b.value=t),total:F.value,"per-page":C.value,onChange:re},null,8,["current-page","total","per-page"])])):(l(),o("div",We,"   ")),s("div",Qe,[s("div",Xe,[s("div",Ye,[s("span",Ze,[B(G,{icon:L(De)},null,8,["icon"])]),pe(s("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>d.value=t),class:"form-control",type:"search",placeholder:e.$gettext("Search")},null,8,et),[[ve,d.value]])])]),s("div",tt,[s("div",at,[s("button",{type:"button","data-bs-tooltip":"",class:"btn btn-secondary","data-bs-placement":"left",title:e.$gettext("Refresh rows"),onClick:be},[B(G,{icon:L(Ue)},null,8,["icon"])],8,lt),e.paginated?(l(),o("div",st,[s("button",{type:"button","data-bs-tooltip":"",class:"btn btn-secondary dropdown-toggle","data-bs-toggle":"dropdown","aria-expanded":"false","data-bs-placement":"left",title:e.$gettext("Items per page")},[s("span",null,k(fe.value),1),a[4]||(a[4]=s("span",{class:"caret"},null,-1))],8,ot),s("ul",nt,[(l(!0),o(w,null,j(e.pageOptions,t=>(l(),o("li",{key:t},[s("button",{type:"button",class:U(["dropdown-item",t===C.value?"active":""]),onClick:p=>L(z).perPage=t},k(se(t)),11,rt)]))),128))])])):f("",!0),e.selectFields?(l(),o("div",it,[s("button",{type:"button",class:"btn btn-secondary dropdown-toggle","data-bs-toggle":"dropdown","aria-expanded":"false","data-bs-placement":"left",title:e.$gettext("Display fields")},[B(G,{icon:L(Ve)},null,8,["icon"]),a[5]||(a[5]=s("span",{class:"caret"},null,-1))],8,ut),s("div",ct,[s("div",dt,[B(Ke,{id:"field_select",modelValue:W.value,"onUpdate:modelValue":a[2]||(a[2]=t=>W.value=t),options:E.value,stacked:""},null,8,["modelValue","options"])])])])):f("",!0)])])])])])):f("",!0),s("div",{class:U(["datatable-main",[Pe.value]])},[s("table",{class:U(["table align-middle table-striped table-hover",[e.selectable?"table-selectable":""]])},[y.caption?(l(),o("caption",pt,[M(e.$slots,"caption")])):f("",!0),s("thead",null,[s("tr",null,[e.selectable?(l(),o("th",vt,[s("label",ft,[B(ce,{autocomplete:"off","model-value":X.value,"onUpdate:modelValue":we},null,8,["model-value"]),s("span",gt,[X.value?(l(),o(w,{key:0},[D(k(e.$gettext("Unselect All Rows")),1)],64)):(l(),o(w,{key:1},[D(k(e.$gettext("Select All Rows")),1)],64))])])])):f("",!0),(l(!0),o(w,null,j(Q.value,t=>{var p;return l(),o("th",{key:t.key+"header",class:U([t.class,t.sortable?"sortable":""]),"aria-sort":t.sortable&&((p=m.value)==null?void 0:p.key)===t.key?P.value==="asc"?"ascending":"descending":void 0,onClick:le(v=>_e(t),["stop"])},[M(e.$slots,"header("+t.key+")",Be({ref_for:!0},t),()=>{var v;return[s("div",yt,[D(k(t.label)+" ",1),t.sortable&&((v=m.value)==null?void 0:v.key)===t.key?(l(),V(G,{key:0,icon:P.value==="asc"?L(xe):L(Ae)},null,8,["icon"])):f("",!0)])]})],10,ht)}),128))])]),s("tbody",null,[x.value&&e.hideOnLoading?(l(),o("tr",bt,[s("td",{colspan:Z.value,class:"text-center p-5"},[s("div",kt,[s("span",_t,k(e.$gettext("Loading")),1)])],8,mt)])):S.value.length===0?(l(),o("tr",Ct,[s("td",{colspan:Z.value},[M(e.$slots,"empty",{},()=>[D(k(e.$gettext("No records.")),1)])],8,wt)])):(l(!0),o(w,{key:2},j(S.value,(t,p)=>(l(),o(w,{key:p},[s("tr",{class:U([H(t)?"table-active":""])},[e.selectable?(l(),o("td",Pt,[s("label",St,[B(ce,{autocomplete:"off","model-value":Y(t),"onUpdate:modelValue":v=>Ce(t)},null,8,["model-value","onUpdate:modelValue"]),s("span",$t,[Y(t)?(l(),o(w,{key:0},[D(k(e.$gettext("Unselect Row")),1)],64)):(l(),o(w,{key:1},[D(k(e.$gettext("Select Row")),1)],64))])])])):f("",!0),(l(!0),o(w,null,j(Q.value,v=>(l(),o("td",{key:v.key+":"+p,class:U(v.class)},[M(e.$slots,"cell("+v.key+")",{column:v,item:t,isActive:H(t),toggleDetails:()=>ie(t)},()=>[D(k(Se(v,t)),1)])],2))),128))],2),H(t)?(l(),o("tr",{key:p+":detail",class:"table-active"},[s("td",{colspan:Z.value},[M(e.$slots,"detail",{item:t,index:p})],8,Ft)])):f("",!0)],64))),128))])],2)],2),e.showToolbar?(l(),o("div",Rt,[oe.value?(l(),V(de,{key:0,"current-page":b.value,"onUpdate:currentPage":a[3]||(a[3]=t=>b.value=t),total:F.value,"per-page":C.value,onChange:re},null,8,["current-page","total","per-page"])):f("",!0)])):f("",!0)],8,ze))}});export{It as _,de as a};
