import{_ as K}from"./DataTable-GBWT48IS.js";import{_ as O}from"./ModalForm-BXS73Tm6.js";import{u as W}from"./useBaseEditModal-8faJWUkS.js";import{u as G}from"./usePlayerStore-BlBABSf7.js";import{_ as z,u as I}from"./index-_C8mTG1e.js";import{_ as H}from"./FormGroupMultiCheck-DbWZJYF1.js";import{_ as q,a as J}from"./Tabs-qkGGOLea.js";import{u as j}from"./useVuelidateOnFormTab-BwIn_2my.js";import{r as Q}from"./index-Hn1RL1dT.js";import{d as R,a4 as N,L as V,j as M,o as n,w as $,e as o,g as _,u as e,b,t as c,c as B,B as X,f as S,F as E,y as x,h as L,i as D,K as F}from"./vue-Cts3TEHg.js";import{l as f}from"./lodash-Bdl6ys83.js";import{_ as Y,W as Z}from"./icons-Be1GHOkw.js";import{u as ss}from"./useHasDatatable-DPFcIMM0.js";import{u as es,_ as ts}from"./AddButton-uc7Azowb.js";import{u as os}from"./useConfirmAndDelete-BYG6kxKa.js";import{_ as is}from"./CardPage-BV0W_9Ux.js";import{a as ns}from"./router-BM8d8xiL.js";import"./FormMultiCheck-BRaoZhWq.js";import"./FormCheckbox-VeRpO6PO.js";import"./useOptionalStorage-BdJu5QYI.js";import"./index-DP9oPqoW.js";import"./InvisibleSubmitButton-EsMx6l8t.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useSlotsExcept-By0Eq2ad.js";import"./useHasModal-BY4NP-pH.js";import"./bootstrap.esm-BZy605kZ.js";import"./Loading-vp9RNwAY.js";import"./mergeExisting-DGzkK79d.js";import"./useVuelidateOnForm-9fRwUaqh.js";import"./lodash-BwctMegf.js";import"./useFormField-Cbkq4UJg.js";import"./FormGroup-LCbWR38E.js";import"./useDialog-M9x0VuxT.js";import"./InfoCard-C2q1AMp7.js";const rs={class:"row g-3"},as=R({__name:"GlobalForm",props:N({globalPermissions:{}},{form:{required:!0},formModifiers:{}}),emits:["update:form"],setup(m){const d=V(m,"form"),{v$:t}=j(d,{name:{required:Q},permissions:{global:{}}},()=>({name:"",permissions:{global:[]}}));return(s,v)=>(n(),M(q,{label:s.$gettext("Global Permissions")},{default:$(()=>[o("div",rs,[_(z,{id:"edit_form_name",class:"col-md-12",field:e(t).name,label:s.$gettext("Role Name")},null,8,["field","label"]),_(H,{id:"edit_form_global_permissions",class:"col-md-12",field:e(t).permissions.global,options:s.globalPermissions,stacked:"",label:s.$gettext("Global Permissions"),description:s.$gettext("Users with this role will have these permissions across the entire installation.")},null,8,["field","options","label","description"])])]),_:1},8,["label"]))}}),ls={class:"card mb-3",role:"region"},ms={class:"card-header text-bg-primary d-flex align-items-center"},ds={class:"flex-fill"},ps={class:"card-title"},us={class:"flex-shrink-0"},cs={class:"card-body"},fs={class:"row g-3"},bs=R({__name:"StationRow",props:N({stations:{},stationPermissions:{}},{row:{required:!0},rowModifiers:{}}),emits:N(["remove"],["update:row"]),setup(m){const d=m,t=V(m,"row"),s=I({permissions:{}},t),v=r=>f.get(d.stations,r,null);return(r,h)=>(n(),b("section",ls,[o("div",ms,[o("div",ds,[o("h2",ps,c(v(t.value.id)),1)]),o("div",us,[o("button",{type:"button",class:"btn btn-sm btn-light py-2",onClick:h[0]||(h[0]=i=>r.$emit("remove"))},[_(Y,{icon:e(Z)},null,8,["icon"]),o("span",null,c(r.$gettext("Remove")),1)])])]),o("div",cs,[o("div",fs,[_(H,{id:"edit_form_station_permissions_"+t.value.id,class:"col-md-12",field:e(s).permissions,options:r.stationPermissions,stacked:"",label:r.$gettext("Station Permissions"),description:r.$gettext("Users with this role will have these permissions for this single station.")},null,8,["id","field","options","label","description"])])])]))}}),_s={key:0,class:"btn-group btn-group-sm"},gs={class:"dropdown btn-group"},$s={class:"btn btn-sm btn-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},vs={class:"dropdown-menu"},hs=["onClick"],ks=R({__name:"StationForm",props:N({stations:{},stationPermissions:{}},{form:{required:!0},formModifiers:{}}),emits:["update:form"],setup(m){const d=m,t=V(m,"form");j(t,{permissions:{station:{}}},()=>({permissions:{station:[]}}));const s=B(()=>{var g;const i=((g=t.value.permissions)==null?void 0:g.station)??[];return f.pickBy(X(d.stations),(k,a)=>!f.find(i,l=>l.id===Number(a)))}),v=B(()=>!f.isEmpty(s.value)),r=i=>{t.value.permissions.station.splice(i,1)},h=i=>{t.value.permissions.station.push({id:Number(i),permissions:[]})};return(i,g)=>(n(),M(q,{label:i.$gettext("Station Permissions")},{default:$(()=>{var k;return[(n(!0),b(E,null,x(((k=t.value.permissions)==null?void 0:k.station)??[],(a,l)=>(n(),M(bs,{key:l,row:t.value.permissions.station[l],"onUpdate:row":y=>t.value.permissions.station[l]=y,stations:i.stations,"station-permissions":i.stationPermissions,onRemove:y=>r(l)},null,8,["row","onUpdate:row","stations","station-permissions","onRemove"]))),128)),v.value?(n(),b("div",_s,[o("div",gs,[o("button",$s,[L(c(i.$gettext("Add Station"))+" ",1),g[0]||(g[0]=o("span",{class:"caret"},null,-1))]),o("ul",vs,[(n(!0),b(E,null,x(s.value,(a,l)=>(n(),b("li",{key:l},[o("button",{type:"button",class:"dropdown-item",onClick:y=>h(l)},c(a),9,hs)]))),128))])])])):S("",!0)]}),_:1},8,["label"]))}}),ys=R({__name:"EditModal",props:{stations:{},globalPermissions:{},stationPermissions:{},createUrl:{}},emits:["relist"],setup(m,{expose:d,emit:t}){const s=m,v=t,r=D("$modal"),{loading:h,error:i,isEditMode:g,v$:k,form:a,clearContents:l,create:y,edit:U,doSubmit:p,close:w}=W(s,v,r),{$gettext:u}=G(),P=B(()=>g.value?u("Edit Role"):u("Add Role"));return d({create:y,edit:U,close:w}),(T,C)=>(n(),M(O,{ref_key:"$modal",ref:r,loading:e(h),title:P.value,error:e(i),"disable-save-button":e(k).$invalid,onSubmit:e(p),onHidden:e(l)},{default:$(()=>[_(J,{"content-class":"mt-3"},{default:$(()=>[_(as,{form:e(a),"onUpdate:form":C[0]||(C[0]=A=>F(a)?a.value=A:null),"global-permissions":T.globalPermissions},null,8,["form","global-permissions"]),_(ks,{form:e(a),"onUpdate:form":C[1]||(C[1]=A=>F(a)?a.value=A:null),stations:T.stations,"station-permissions":T.stationPermissions},null,8,["form","stations","station-permissions"])]),_:1})]),_:1},8,["loading","title","error","disable-save-button","onSubmit","onHidden"]))}}),Ps={class:"card-text"},ws={key:0},Rs={key:0,class:"btn-group btn-group-sm"},Cs=["onClick"],Ss=["onClick"],le=R({__name:"Permissions",props:{stations:{},globalPermissions:{},stationPermissions:{}},setup(m){const d=m,t=ns("/admin/roles"),{$gettext:s}=G(),v=[{key:"name",isRowHeader:!0,label:s("Role Name"),sortable:!0},{key:"permissions",label:s("Permissions"),sortable:!1},{key:"actions",label:s("Actions"),sortable:!1,class:"shrink"}],r=p=>f.filter(f.map(p,w=>f.get(d.globalPermissions,w,null))),h=p=>f.filter(f.map(p,w=>f.get(d.stationPermissions,w,null))),i=p=>f.get(d.stations,p,null),g=D("$dataTable"),{relist:k}=ss(g),a=D("$editModal"),{doCreate:l,doEdit:y}=es(a),{doDelete:U}=os(s("Delete Role?"),k);return(p,w)=>(n(),b(E,null,[_(is,{title:e(s)("Roles & Permissions")},{info:$(()=>[o("p",Ps,c(e(s)("Aplus uses a role-based access control system. Roles are given permissions to certain sections of the site, then users are assigned into those roles.")),1)]),actions:$(()=>[_(ts,{text:e(s)("Add Role"),onClick:e(l)},null,8,["text","onClick"])]),default:$(()=>[_(K,{id:"permissions",ref_key:"$dataTable",ref:g,paginated:"",fields:v,"api-url":e(t)},{"cell(permissions)":$(u=>[u.item.permissions.global.length>0?(n(),b("div",ws,c(e(s)("Global"))+" : "+c(r(u.item.permissions.global).join(", ")),1)):S("",!0),(n(!0),b(E,null,x(u.item.permissions.station,P=>(n(),b("div",{key:P.id},[o("b",null,c(i(P.id)),1),L(": "+c(h(P.permissions).join(", ")),1)]))),128))]),"cell(actions)":$(u=>[u.item.is_super_admin?S("",!0):(n(),b("div",Rs,[o("button",{type:"button",class:"btn btn-primary",onClick:P=>e(y)(u.item.links.self)},c(e(s)("Edit")),9,Cs),u.item.id!==1?(n(),b("button",{key:0,type:"button",class:"btn btn-danger",onClick:P=>e(U)(u.item.links.self)},c(e(s)("Delete")),9,Ss)):S("",!0)]))]),_:1},8,["api-url"])]),_:1},8,["title"]),_(ys,{ref_key:"$editModal",ref:a,"create-url":e(t),"station-permissions":p.stationPermissions,stations:p.stations,"global-permissions":p.globalPermissions,onRelist:e(k)},null,8,["create-url","station-permissions","stations","global-permissions","onRelist"])],64))}});export{le as default};
