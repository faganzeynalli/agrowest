import{_ as S}from"./DataTable-CXmd0SqX.js";import{_ as v}from"./index-BFjAyuuB.js";import{_ as V}from"./FormGroupMultiCheck-Bu_mkgLI.js";import{u as L}from"./useVuelidateOnFormTab-DVVYqO43.js";import{r as U,e as q}from"./index-Hn1RL1dT.js";import{v as T}from"./validatePassword-tAK3Ex3f.js";import{d as M,a4 as P,L as j,c as A,b as n,o as l,g as r,u as e,x as I,w as m,h as K,t as i,i as E,j as O,K as Y,f as w,e as k,F as D,y as z}from"./vue-Cts3TEHg.js";import{l as G}from"./lodash-Bdl6ys83.js";import{u as J}from"./useBaseEditModal-bUENso3_.js";import{u as B}from"./usePlayerStore-DOWZeqmH.js";import{_ as Q}from"./ModalForm-6A6FuW_4.js";import{m as W}from"./mergeExisting-DGzkK79d.js";import{u as X}from"./useHasDatatable-DPFcIMM0.js";import{u as Z,_ as ee}from"./AddButton-uc7Azowb.js";import{u as te}from"./useConfirmAndDelete-BI_Y8vaS.js";import{_ as se}from"./CardPage-BV0W_9Ux.js";import{a as oe}from"./router-CzhCnqE6.js";import"./icons-Be1GHOkw.js";import"./FormMultiCheck-BRaoZhWq.js";import"./FormCheckbox-VeRpO6PO.js";import"./useOptionalStorage-CP14PsgK.js";import"./index-D6B2xxAX.js";import"./useFormField-BGrQPUJN.js";import"./FormGroup-LCbWR38E.js";import"./useSlotsExcept-By0Eq2ad.js";import"./useVuelidateOnForm-DvID9VAf.js";import"./lodash-BwctMegf.js";import"./zxcvbn-C681xa0x.js";import"./bootstrap.esm-BZy605kZ.js";import"./InvisibleSubmitButton-EsMx6l8t.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useHasModal-CIl4-uQE.js";import"./Loading-vp9RNwAY.js";import"./useDialog-CNFbWYBq.js";import"./InfoCard-C2q1AMp7.js";const re={class:"row g-3"},ae=M({__name:"Form",props:P({roles:{},isEditMode:{type:Boolean}},{form:{required:!0},formModifiers:{}}),emits:["update:form"],setup(u){const d=u,t=j(u,"form"),{v$:a}=L(t,A(()=>({email:{required:U,email:q},new_password:d.isEditMode?{validatePassword:T}:{required:U,validatePassword:T},name:{},roles:{}})),{email:"",new_password:"",name:"",roles:[]});return(o,p)=>(l(),n("div",re,[r(v,{id:"edit_form_email",class:"col-md-6",field:e(a).email,"input-type":"email",label:o.$gettext("E-mail Address")},null,8,["field","label"]),r(v,{id:"edit_form_new_password",class:"col-md-6",field:e(a).new_password,"input-type":"password",label:o.$gettext("Password")},I({_:2},[o.isEditMode?{name:"description",fn:m(()=>[K(i(o.$gettext("Leave blank to use the current password.")),1)]),key:"0"}:void 0]),1032,["field","label"]),r(v,{id:"edit_form_name",class:"col-md-12",field:e(a).name,label:o.$gettext("Display Name")},null,8,["field","label"]),r(V,{id:"edit_form_roles",class:"col-md-12",field:e(a).roles,options:o.roles,label:o.$gettext("Roles")},null,8,["field","options","label"])]))}}),ie=M({__name:"EditModal",props:{roles:{},createUrl:{}},emits:["relist"],setup(u,{expose:d,emit:t}){const a=u,o=t,p=E("$modal"),{loading:b,error:y,isEditMode:$,form:f,v$:h,clearContents:C,create:s,edit:c,doSubmit:N,close:R}=J(a,o,p,{roles:{},new_password:{}},{roles:[],new_password:null},{populateForm:(g,_)=>{_.value=W(_.value,{...g,roles:G.map(g.roles,"id"),new_password:""})}}),{$gettext:x}=B(),F=A(()=>$.value?x("Edit User"):x("Add User"));return d({create:s,edit:c,close:R}),(g,_)=>(l(),O(Q,{ref_key:"$modal",ref:p,loading:e(b),title:F.value,error:e(y),"disable-save-button":e(h).$invalid,onSubmit:e(N),onHidden:e(C)},{default:m(()=>[r(ae,{form:e(f),"onUpdate:form":_[0]||(_[0]=H=>Y(f)?f.value=H:null),roles:g.roles,"is-edit-mode":e($)},null,8,["form","roles","is-edit-mode"])]),_:1},8,["loading","title","error","disable-save-button","onSubmit","onHidden"]))}}),le={key:0,class:"mb-0"},ne=["href"],me={key:1,class:"badge text-bg-primary ms-1"},de={key:0,class:"btn-group btn-group-sm"},pe=["href"],ce=["onClick"],ue=["onClick"],Je=M({__name:"Users",props:{roles:{}},setup(u){const d=oe("/admin/users"),{$gettext:t}=B(),a=[{key:"name",isRowHeader:!0,label:t("User Name"),sortable:!0},{key:"roles",label:t("Roles"),sortable:!1},{key:"actions",label:t("Actions"),sortable:!1,class:"shrink"}],o=E("$dataTable"),{relist:p}=X(o),b=E("$editModal"),{doCreate:y,doEdit:$}=Z(b),{doDelete:f}=te(t("Delete User?"),p);return(h,C)=>(l(),n(D,null,[r(se,{title:e(t)("Users")},{actions:m(()=>[r(ee,{text:e(t)("Add User"),onClick:e(y)},null,8,["text","onClick"])]),default:m(()=>[r(S,{id:"users",ref_key:"$dataTable",ref:o,paginated:"",fields:a,"api-url":e(d)},{"cell(name)":m(s=>[s.item.name!==""?(l(),n("h5",le,i(s.item.name),1)):w("",!0),k("a",{href:"mailto:"+s.item.email},i(s.item.email),9,ne),s.item.is_me?(l(),n("span",me,i(e(t)("You")),1)):w("",!0)]),"cell(roles)":m(s=>[(l(!0),n(D,null,z(s.item.roles,c=>(l(),n("div",{key:c.id},i(c.name),1))),128))]),"cell(actions)":m(s=>[s.item.is_me?w("",!0):(l(),n("div",de,[k("a",{class:"btn btn-secondary",href:s.item.links.masquerade,target:"_blank"},i(e(t)("Log In")),9,pe),k("button",{type:"button",class:"btn btn-primary",onClick:c=>e($)(s.item.links.self)},i(e(t)("Edit")),9,ce),k("button",{type:"button",class:"btn btn-danger",onClick:c=>e(f)(s.item.links.self)},i(e(t)("Delete")),9,ue)]))]),_:1},8,["api-url"])]),_:1},8,["title"]),r(ie,{ref_key:"$editModal",ref:b,"create-url":e(d),roles:h.roles,onRelist:e(p)},null,8,["create-url","roles","onRelist"])],64))}});export{Je as default};
