import{l as re,d as q,U as Te,c as X,r as z,s as ae,i as B,b as _,e,t as c,u as t,g as a,H as Q,F as T,y as te,m as ne,O as he,J as Be,o as r,j as Y,w as U,z as ge,q as we,h as K,f as ve}from"./vue-Cts3TEHg.js";import{_ as De}from"./DataTable-CuDCWdIJ.js";import{D as Ee}from"./bootstrap.esm-BZy605kZ.js";import{l as I}from"./lodash-Bdl6ys83.js";import{_ as L,P as Ne,Q as Ae,R as qe,S as ce,T as He,I as Ve,U as ze}from"./icons-Be1GHOkw.js";import{f as de,u as se,d as le}from"./usePlayerStore-D2Yy6Bxy.js";import{u as Le}from"./useDialog-B4KfCD8t.js";import{_ as Qe}from"./FlowUpload-kcQCYQuD.js";import{r as ue}from"./index-Hn1RL1dT.js";import{_ as W}from"./index-B7HOtTO3.js";import{u as xe,a as je}from"./useVuelidateOnForm-CVJ7UnZt.js";import{u as me,_ as pe}from"./useHasModal-BWWcbDj3.js";import{I as Ce}from"./InvisibleSubmitButton-EsMx6l8t.js";import{a as Oe}from"./index-Bav4EGom.js";import{_ as Ge}from"./FormGroupMultiCheck-DiXBs_id.js";import{_ as Je}from"./ModalForm-fxrU3nGH.js";import{_ as $e,a as We}from"./Tabs-CfAAyljz.js";import{u as Ke}from"./useBaseEditModal-CtcnK2Zv.js";import{m as ke}from"./mergeExisting-DGzkK79d.js";import{_ as Xe}from"./Quota-Bd-KxFn0.js";import{_ as Ye}from"./PlayButton-C_xWNWvy.js";import{f as Ze}from"./formatFileSize--9DaIXge.js";import{g as J}from"./router-4MaTkvgX.js";import{b as et,u as tt}from"./router-Czc3TqKo.js";import{u as st}from"./useStationDateTimeFormatter-CQlryVgl.js";import"./FormMultiCheck-BRaoZhWq.js";import"./FormCheckbox-VeRpO6PO.js";import"./useOptionalStorage-DBOfakfd.js";import"./lodash-BwctMegf.js";import"./useFormField-CVK_EJdG.js";import"./FormGroup-LCbWR38E.js";import"./Loading-vp9RNwAY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useSlotsExcept-By0Eq2ad.js";import"./luxon-BJyPbqTc.js";import"./datetime-BTmRqpun.js";function Me(){const{notifySuccess:v,notifyError:d}=de();return{handleBatchResponse:(i,g,u)=>{if(i.success){const s=[];I.forEach(i.dirs,l=>{s.push(re("div",{},l))}),I.forEach(i.files,l=>{s.push(re("div",{},l))}),v(s,{title:g})}else{const s=[];I.forEach(i.errors,l=>{s.push(re("div",{},l))}),d(s,{title:u})}}}}const lt={id:"app-toolbar",class:"d-flex pt-4"},ot={class:"flex-fill buttons d-flex align-items-center"},it={class:"btn-group btn-group-sm dropdown allow-focus"},rt={class:"dropdown"},nt=["disabled"],at={class:"dropdown-menu",style:{"min-width":"300px"}},ct={class:"custom-control custom-checkbox"},dt=["id","value"],ut=["for"],mt={class:"form-group mt-3 mb-4"},pt={class:"input-group custom-control custom-checkbox"},ft={class:"input-group-text"},yt=["placeholder"],_t={class:"buttons"},bt={class:"btn btn-primary",type:"submit"},ht=["disabled"],vt=["disabled"],$t={class:"flex-shrink-0"},kt=q({__name:"MediaToolbar",props:{currentDirectory:{},selectedItems:{},playlists:{},batchUrl:{},supportsImmediateQueue:{type:Boolean}},emits:["relist","add-playlist","move-files","create-directory"],setup(v,{emit:d}){const $=v,i=d,g=Te($,"selectedItems"),u=X(()=>g.value.all.length>0),s=z([]),l=z("");ae(g,h=>{const w=I.map(h.all,D=>{var x,R;const H=((x=D.dir)==null?void 0:x.playlists)??((R=D.media)==null?void 0:R.playlists)??[];return I.map(H,"id")});s.value=I.intersection(...w)}),ae(l,h=>{h!==""&&(s.value.includes("new")||s.value.push("new"))});const{$gettext:m}=se(),{axios:p}=le(),{handleBatchResponse:C}=Me(),{notifyError:A}=de(),F=()=>{A(m("No files selected."))},P=(h,w,D)=>{u.value?p.put($.batchUrl,{do:h,current_directory:$.currentDirectory,files:g.value.files,dirs:g.value.directories}).then(({data:H})=>{C(H,w,D),i("relist")}):F()},{confirmDelete:M}=Le(),N=()=>{const h=g.value.all.length,w=m("Delete %{num} media files?",{num:String(h)});M({title:w,confirmButtonText:m("Delete")}).then(D=>{D.value&&P("delete",m("Files removed:"),m("Error removing files:"))})},f=B("$playlistDropdown"),b=()=>{f.value&&Ee.getInstance(f.value).hide(),u.value?p.put($.batchUrl,{do:"playlist",playlists:s.value,new_playlist_name:l.value,currentDirectory:$.currentDirectory,files:g.value.files,dirs:g.value.directories}).then(({data:h})=>{C(h,s.value.length>0?m("Playlists updated for selected files:"):m("Playlists cleared for selected files:"),m("Error updating playlists:")),h.success&&(h.record&&i("add-playlist",h.record),s.value=[],l.value=""),i("relist")}):F()},S=()=>{s.value=[],l.value="",b()},k=()=>{i("move-files")},E=()=>{i("create-directory")};return(h,w)=>(r(),_("div",lt,[e("div",ot,[e("span",null,c(t(m)("With selected:")),1),e("div",it,[e("div",rt,[e("button",{ref_key:"$playlistDropdown",ref:f,class:"btn btn-sm btn-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","data-bs-auto-close":"outside","aria-expanded":"false",disabled:!u.value},[a(L,{icon:t(Ne)},null,8,["icon"]),e("span",null,c(t(m)("Playlists")),1),w[4]||(w[4]=e("span",{class:"caret"},null,-1))],8,nt),e("div",at,[e("form",{class:"px-4 py-3",onSubmit:Q(b,["prevent"])},[(r(!0),_(T,null,te(h.playlists,D=>(r(),_("div",{key:D.id,class:"form-group"},[e("div",ct,[ne(e("input",{id:"chk_playlist_"+D.id,"onUpdate:modelValue":w[0]||(w[0]=H=>s.value=H),type:"checkbox",class:"custom-control-input",name:"playlists[]",value:D.id},null,8,dt),[[he,s.value]]),e("label",{class:"custom-control-label",for:"chk_playlist_"+D.id},c(D.name),9,ut)])]))),128)),w[6]||(w[6]=e("hr",{class:"dropdown-divider"},null,-1)),e("div",mt,[e("div",pt,[e("div",ft,[ne(e("input",{id:"chk_playlist_new","onUpdate:modelValue":w[1]||(w[1]=D=>s.value=D),type:"checkbox",class:"custom-control-input",value:"new"},null,512),[[he,s.value]]),w[5]||(w[5]=e("label",{class:"custom-control-label",for:"chk_playlist_new"},null,-1))]),ne(e("input",{id:"new_playlist_name","onUpdate:modelValue":w[2]||(w[2]=D=>l.value=D),type:"text",class:"form-control p-2",name:"new_playlist_name",style:{"min-width":"150px"},placeholder:t(m)("New Playlist")},null,8,yt),[[Be,l.value]])])]),e("div",_t,[e("button",bt,c(t(m)("Save")),1),e("button",{class:"btn btn-warning",type:"button",onClick:w[3]||(w[3]=D=>S())},c(t(m)("Clear")),1)])],32)])])]),e("button",{type:"button",class:"btn btn-sm btn-primary",disabled:!u.value,onClick:k},[a(L,{icon:t(Ae)},null,8,["icon"]),e("span",null,c(t(m)("Move")),1)],8,ht),e("button",{type:"button",class:"btn btn-sm btn-danger",disabled:!u.value,onClick:N},[a(L,{icon:t(qe)},null,8,["icon"]),e("span",null,c(t(m)("Delete")),1)],8,vt)]),e("div",$t,[e("button",{type:"button",class:"btn btn-sm btn-primary",onClick:E},[a(L,{icon:t(ce)},null,8,["icon"]),e("span",null,c(t(m)("New Folder")),1)])])]))}}),gt={"aria-label":"breadcrumb"},wt={class:"breadcrumb"},Dt={class:"breadcrumb-item"},xt=["onClick"],Ct=q({__name:"Breadcrumb",props:{currentDirectory:{}},emits:["change-directory"],setup(v,{emit:d}){const $=v,i=d,g=X(()=>{const s=[];if($.currentDirectory==="")return s;let l="";return $.currentDirectory.split("/").forEach(p=>{l===""?l+=p:l+="/"+p,s.push({dir:l,display:p})}),s}),u=s=>{i("change-directory",s)};return(s,l)=>(r(),_(T,null,[e("nav",gt,[e("ol",wt,[e("li",Dt,[e("a",{href:"#",onClick:l[0]||(l[0]=Q(m=>u(""),["prevent"]))},c(s.$gettext("Home")),1)]),(r(!0),_(T,null,te(g.value,m=>(r(),_("li",{key:m.dir,class:"breadcrumb-item"},[e("a",{href:"#",onClick:Q(p=>u(m.dir),["prevent"])},c(m.display),9,xt)]))),128))])]),l[1]||(l[1]=e("h3",{id:"breadcrumb",class:"card-subtitle mt-0 mb-2"},null,-1))],64))}}),Mt=q({__name:"FileUpload",props:{uploadUrl:{},currentDirectory:{},searchPhrase:{},validMimeTypes:{default:()=>["audio/*"]}},emits:["relist"],setup(v,{emit:d}){const $=v,i=d,g=X(()=>{const s=new URL($.uploadUrl,document.location.href);return s.searchParams.set("currentDirectory",$.currentDirectory),s.searchParams.set("searchPhrase",$.searchPhrase),s.toString()}),u=()=>{i("relist")};return(s,l)=>(r(),Y(Qe,{"target-url":g.value,"valid-mime-types":s.validMimeTypes,"allow-multiple":"",onComplete:u,onError:u},null,8,["target-url","valid-mime-types"]))}}),Ft=q({__name:"NewDirectoryModal",props:{currentDirectory:{},mkdirUrl:{}},emits:["relist"],setup(v,{expose:d,emit:$}){const i=v,g=$,{form:u,v$:s,resetForm:l,ifValid:m}=xe({newDirectory:{required:ue}},{newDirectory:null}),p=B("$modal"),{hide:C,show:A}=me(p),F=()=>{l()},P=B("$field"),M=()=>{we(()=>{var k;(k=P.value)==null||k.focus()})},{notifySuccess:N}=de(),{axios:f}=le(),{$gettext:b}=se(),S=()=>{m(()=>{f.post(i.mkdirUrl,{currentDirectory:i.currentDirectory,name:u.value.newDirectory}).then(()=>{N(b("New directory created."))}).finally(()=>{g("relist"),C()})})};return d({open:A}),(k,E)=>(r(),Y(pe,{id:"create_directory",ref_key:"$modal",ref:p,centered:"",title:t(b)("New Directory"),onHidden:F,onShown:M},{"modal-footer":U(()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:E[0]||(E[0]=(...h)=>t(C)&&t(C)(...h))},c(t(b)("Close")),1),e("button",{type:"button",class:ge(["btn",t(s).$invalid?"btn-danger":"btn-primary"]),onClick:S},c(t(b)("Create Directory")),3)]),default:U(()=>[e("form",{onSubmit:Q(S,["prevent"])},[a(W,{id:"new_directory_name",ref_key:"$field",ref:P,field:t(s).newDirectory,label:t(b)("Directory Name")},null,8,["field","label"]),a(Ce)],32)]),_:1},8,["title"]))}}),St={class:"d-flex flex-column flex-md-row mb-3 align-items-center"},Ut={class:"flex-shrink m-2 m-md-0 me-md-3"},It=["disabled"],Pt={class:"flex-fill m-2 m-md-0 text-end"},Rt={class:"m-0"},Tt={class:"row"},Bt={class:"col-md-12"},Et={class:"is_dir d-flex align-items-center"},Nt={class:"file-icon me-2"},At=["onClick"],qt=["disabled"],Ht=q({__name:"MoveFilesModal",props:{selectedItems:{},currentDirectory:{},batchUrl:{},listDirectoriesUrl:{}},emits:["relist"],setup(v,{expose:d,emit:$}){const i=v,g=$,u=z(""),s=z([]),{$gettext:l}=se(),m=[{key:"name",label:l("Directory"),sortable:!0}],p=X(()=>l("Move %{num} File(s) to",{num:String(i.selectedItems.all.length)})),C=B("$modal"),{show:A,hide:F}=me(C),P=()=>{s.value=[],u.value=""},{axios:M}=le(),{handleBatchResponse:N}=Me(),{state:f,execute:b,isLoading:S}=Oe(()=>M.get(i.listDirectoriesUrl,{params:{currentDirectory:u.value}}).then(x=>x.data.rows),[],{immediate:!1}),k=()=>{M.put(i.batchUrl,{do:"move",currentDirectory:i.currentDirectory,directory:u.value,files:i.selectedItems.files,dirs:i.selectedItems.directories}).then(({data:x})=>{N(x,l("Files moved:"),l("Error moving files:"))}).finally(()=>{F(),g("relist")})},E=B("$dataTable"),h=()=>{b().finally(()=>{var x;(x=E.value)==null||x.refresh()})},w=x=>{s.value.push(x),u.value=x,h()},D=()=>{s.value.pop();let x=s.value.slice(-1)[0];(typeof x>"u"||x===null)&&(x=""),u.value=x,h()};return d({open:()=>{b(),A()}}),(x,R)=>(r(),Y(pe,{id:"move_file",ref_key:"$modal",ref:C,size:"xl",centered:"",title:p.value,onHidden:R[2]||(R[2]=j=>P())},{"modal-footer":U(()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:R[1]||(R[1]=(...j)=>t(F)&&t(F)(...j))},c(t(l)("Close")),1),e("button",{type:"button",class:"btn btn-primary",disabled:i.selectedItems.all.length===0,onClick:k},c(t(l)("Move to Directory")),9,qt)]),default:U(()=>[e("div",St,[e("div",Ut,[e("button",{type:"button",class:"btn btn-sm btn-primary",disabled:s.value.length===0,onClick:D},[a(L,{icon:t(He)},null,8,["icon"]),e("span",null,c(t(l)("Back")),1)],8,It)]),e("div",Pt,[e("h5",Rt,[e("small",null,c(t(l)("Selected directory:")),1),R[3]||(R[3]=e("br",null,null,-1)),u.value?(r(),_(T,{key:0},[K(c(u.value),1)],64)):(r(),_(T,{key:1},[K(c(t(l)("Base Directory")),1)],64))])])]),e("div",Tt,[e("div",Bt,[a(De,{id:"station_media",ref_key:"$dataTable",ref:E,"show-toolbar":"",paginated:"",fields:m,items:t(f),loading:t(S),"handle-client-side":"",onRefreshClicked:R[0]||(R[0]=j=>t(b)())},{"cell(name)":U(({item:j})=>[e("div",Et,[e("span",Nt,[a(L,{icon:t(ce)},null,8,["icon"])]),e("a",{href:"#",onClick:Q(oe=>w(j.path),["prevent"])},c(j.name),9,At)])]),_:1},8,["items","loading"])])])]),_:1},8,["title"]))}}),Vt=q({__name:"RenameModal",props:{renameUrl:{}},emits:["relist"],setup(v,{expose:d,emit:$}){const i=v,g=$,u=z(null),{form:s,v$:l,resetForm:m,ifValid:p}=xe({newPath:{required:ue}},{newPath:null}),C=B("$modal"),{show:A,hide:F}=me(C),P=k=>{u.value=k,s.value.newPath=k,A()},M=B("$field"),N=()=>{we(()=>{var k;(k=M.value)==null||k.focus()})},f=()=>{m(),u.value=null},{axios:b}=le(),S=()=>{p(()=>{b.put(i.renameUrl,{file:u.value,...s.value}).finally(()=>{F(),g("relist")})})};return d({open:P}),(k,E)=>(r(),Y(pe,{id:"rename_file",ref_key:"$modal",ref:C,centered:"",title:k.$gettext("Rename File/Directory"),onShown:N,onHidden:f},{"modal-footer":U(()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:E[0]||(E[0]=(...h)=>t(F)&&t(F)(...h))},c(k.$gettext("Close")),1),e("button",{type:"button",class:ge(["btn",t(l).$invalid?"btn-danger":"btn-primary"]),onClick:S},c(k.$gettext("Rename")),3)]),default:U(()=>[e("form",{onSubmit:Q(S,["prevent"])},[a(W,{id:"new_directory_name",ref_key:"$field",ref:M,field:t(l).newPath,label:k.$gettext("New File Name")},null,8,["field","label"]),a(Ce)],32)]),_:1},8,["title"]))}}),zt={class:"row g-3"},Lt=q({__name:"BasicInfo",props:{form:{}},setup(v){return(d,$)=>(r(),_("div",zt,[a(W,{id:"edit_form_path",class:"col-md-6",field:d.form.path,label:d.$gettext("File Name"),description:d.$gettext("The relative path of the file in the station's media directory.")},null,8,["field","label","description"]),a(W,{id:"edit_form_title",class:"col-md-6",field:d.form.title,label:d.$gettext("Song Title")},null,8,["field","label"]),a(W,{id:"edit_form_artist",class:"col-md-6",field:d.form.artist,label:d.$gettext("Song Artist")},null,8,["field","label"]),a(W,{id:"edit_form_genre",class:"col-md-6",field:d.form.genre,label:d.$gettext("Song Genre")},null,8,["field","label"]),a(W,{id:"edit_form_album",class:"col-md-6",field:d.form.album,label:d.$gettext("Song Album")},null,8,["field","label"])]))}}),Qt={class:"row"},jt=q({__name:"Playlists",props:{form:{},playlists:{}},setup(v){const d=v,$=X(()=>I.map(d.playlists,function(i){return{text:i.name,value:i.id}}));return(i,g)=>(r(),_("div",Qt,[a(Ge,{id:"edit_form_playlists",class:"col-md-12",field:i.form.playlists,options:$.value,stacked:"",label:i.$gettext("Playlists")},null,8,["field","options","label"])]))}}),Ot=q({__name:"EditModal",props:{customFields:{},playlists:{},createUrl:{}},emits:["relist"],setup(v,{expose:d,emit:$}){const i=v,g=$,{record:u,reset:s}=je({length:null,length_text:null,links:{art:null,waveform:null,waveform_cache:null,play:null}}),l=B("$modal"),{loading:m,error:p,v$:C,clearContents:A,edit:F,doSubmit:P}=Ke(i,g,l,()=>{const f={path:{required:ue},title:{},artist:{},album:{},genre:{},lyrics:{},isrc:{},art:{},custom_fields:{},extra_metadata:{amplify:{},cross_start_next:{},fade_in:{},fade_out:{},cue_in:{},cue_out:{}},playlists:{}};return I.forEach(i.customFields.slice(),b=>{b.short_name&&(f.custom_fields[b.short_name]={})}),f},()=>{const f={path:null,title:null,artist:null,album:null,genre:null,lyrics:null,isrc:null,custom_fields:{},extra_metadata:{amplify:null,cross_start_next:null,fade_in:null,fade_out:null,cue_in:null,cue_out:null},playlists:[]};return I.forEach(i.customFields.slice(),b=>{b.short_name&&(f.custom_fields[b.short_name]=null)}),f},{resetForm:f=>{f(),s()},populateForm:(f,b)=>{u.value=ke(u.value,f);const S=ke(b.value,f);S.playlists=I.map(f.playlists,"id"),S.custom_fields={},I.forEach(i.customFields.slice(),k=>{S.custom_fields[k.short_name]=I.defaultTo(f.custom_fields[k.short_name],null)}),b.value=S}}),M=f=>{F(f)},N=()=>{A()};return d({open:M}),(f,b)=>(r(),Y(Je,{ref_key:"$modal",ref:l,loading:t(m),title:f.$gettext("Edit Media"),error:t(p),"disable-save-button":t(C).$invalid,onSubmit:t(P),onHidden:N},{default:U(()=>[a(We,{"destroy-on-hide":""},{default:U(()=>[a($e,{label:f.$gettext("Basic Information")},{default:U(()=>[a(Lt,{form:t(C)},null,8,["form"])]),_:1},8,["label"]),a($e,{label:f.$gettext("Playlists")},{default:U(()=>[a(jt,{form:t(C),playlists:f.playlists},null,8,["form","playlists"])]),_:1},8,["label"])]),_:1})]),_:1},8,["loading","title","error","disable-save-button","onSubmit"]))}});var O=(v=>(v.Directory="directory",v.Media="media",v.CoverArt="cover_art",v.UnprocessableFile="unprocessable_file",v.Other="other",v))(O||{});const Gt={class:"card",role:"region","aria-labelledby":"hdr_music_files"},Jt={class:"card-header text-bg-primary"},Wt={class:"row align-items-center"},Kt={class:"col-md-7"},Xt={id:"hdr_music_files",class:"card-title"},Yt={class:"col-md-5 text-end"},Zt={class:"card-body"},es={class:"d-flex align-items-center"},ts={class:"flex-shrink-0 pe-2"},ss={key:0,class:"file-icon"},ls={key:1,class:"file-icon"},os={key:2,class:"file-icon"},is={class:"flex-fill"},rs=["title","onClick"],ns=["href","title"],as=["href","title"],cs={key:3},ds={key:4},us=["title","onClick"],ms={key:0},ps=["title","onClick"],fs={key:0},ys=["onClick"],_s=["onClick"],Zs=q({__name:"Media",props:{initialPlaylists:{default:()=>[]},customFields:{default:()=>[]},validMimeTypes:{default:()=>[]},showSftp:{type:Boolean,default:!0},supportsImmediateQueue:{type:Boolean,default:!0}},setup(v){const d=v,$=J("/files/list"),i=J("/files/batch"),g=J("/files/upload"),u=J("/files/directories"),s=J("/files/mkdir"),l=J("/files/rename"),m=J("/quota/station_media"),{$gettext:p}=se(),{formatTimestampAsDateTime:C}=st(),A=X(()=>{const o=[{key:"path",isRowHeader:!0,label:p("Name"),sortable:!0},{key:"media.title",label:p("Title"),sortable:!0,selectable:!0,visible:!0},{key:"media.artist",label:p("Artist"),sortable:!0,selectable:!0,visible:!1},{key:"media.album",label:p("Album"),sortable:!0,selectable:!0,visible:!1},{key:"media.genre",label:p("Genre"),sortable:!0,selectable:!0,visible:!1}];return I.forEach({...d.customFields},y=>{o.push({key:"media.custom_fields["+y.short_name+"]",label:y.name,sortable:!0,selectable:!0,visible:!1})}),o.push({key:"size",label:p("Size"),sortable:!0,selectable:!0,visible:!0},{key:"timestamp",label:p("Modified"),sortable:!0,formatter:y=>C(y),selectable:!0,visible:!0},{key:"media.uploaded_at",label:p("Uploaded Time"),sortable:!0,formatter:y=>C(y),selectable:!0,visible:!1},{key:"playlists",label:p("Playlists"),sortable:!1,selectable:!0,visible:!0},{key:"commands",label:p("Actions"),sortable:!1,class:"shrink"}),o}),F=z(d.initialPlaylists),P=z({all:[],files:[],directories:[]}),M=z(""),N=z(""),f=o=>{const y=I.partition(o,n=>n.type===O.Directory);P.value={all:o,files:I.map(y[1],"path"),directories:I.map(y[0],"path")}},b=B("$dataTable"),S=()=>{var o;(o=b.value)==null||o.navigate()},k=o=>{var y;(y=b.value)==null||y.setFilter(o)},E=B("$quota"),h=()=>{var o,y;(o=E.value)==null||o.update(),(y=b.value)==null||y.relist()},w=o=>{F.value.push(o)},D=o=>{N.value=o},H=B("$renameModal"),x=o=>{var y;(y=H.value)==null||y.open(o)},R=B("$editModal"),j=o=>{var y;(y=R.value)==null||y.open(o)},oe=B("$newDirectoryModal"),Fe=()=>{var o;(o=oe.value)==null||o.open()},fe=B("$moveFilesModal"),Se=()=>{var o;(o=fe.value)==null||o.open()},Ue=o=>(o.params.currentDirectory=M.value,o),Ie=o=>o.substring(0,9)==="playlist:"||o.substring(0,8)==="special:",ye=et(),Pe=tt(),_e=o=>{ye.push({name:"stations:files:index",params:{path:o}})};return ae(()=>Pe.params,async o=>{let y=o.path??"";Array.isArray(y)&&(y=y.join("")),Ie(y)?(await ye.push({name:"stations:files:index"}),k(y)):(M.value=y,S())},{immediate:!0}),(o,y)=>(r(),_(T,null,[e("section",Gt,[e("div",Jt,[e("div",Wt,[e("div",Kt,[e("h2",Xt,c(t(p)("Music Files")),1)]),e("div",Yt,[a(Xe,{ref_key:"$quota",ref:E,"quota-url":t(m)},null,8,["quota-url"])])])]),e("div",Zt,[a(Ct,{"current-directory":M.value,onChangeDirectory:_e},null,8,["current-directory"]),a(Mt,{"upload-url":t(g),"search-phrase":N.value,"valid-mime-types":o.validMimeTypes,"current-directory":M.value,onRelist:h},null,8,["upload-url","search-phrase","valid-mime-types","current-directory"]),a(kt,{"batch-url":t(i),"selected-items":P.value,"current-directory":M.value,"supports-immediate-queue":o.supportsImmediateQueue,playlists:F.value,onAddPlaylist:w,onRelist:h,onCreateDirectory:Fe,onMoveFiles:Se},null,8,["batch-url","selected-items","current-directory","supports-immediate-queue","playlists"])]),a(De,{id:"station_media",ref_key:"$dataTable",ref:b,selectable:"",paginated:"","select-fields":"",fields:A.value,"api-url":t($),"request-config":Ue,onRowSelected:f,onFiltered:D},{"cell(path)":U(({item:n})=>[e("div",es,[e("div",ts,[n.type===t(O).Media?(r(),Y(Ye,{key:0,url:n.media.links.play,class:"btn-lg"},null,8,["url"])):(r(),_(T,{key:1},[n.type===t(O).Directory?(r(),_("span",ss,[a(L,{icon:t(ce)},null,8,["icon"])])):n.type===t(O).CoverArt?(r(),_("span",ls,[a(L,{icon:t(Ve)},null,8,["icon"])])):(r(),_("span",os,[a(L,{icon:t(ze)},null,8,["icon"])]))],64))]),e("div",is,[n.type===t(O).Directory?(r(),_("a",{key:0,class:"name",href:"#",title:n.text,onClick:Q(V=>_e(n.path),["prevent"])},c(n.path_short),9,rs)):n.type===t(O).Media?(r(),_("a",{key:1,class:"name",href:n.media.links.play,target:"_blank",title:n.text},c(n.text),9,ns)):(r(),_("a",{key:2,class:"name",href:n.links.download,target:"_blank",title:n.text},c(n.path_short),9,as)),y[0]||(y[0]=e("br",null,null,-1)),n.type===t(O).Media?(r(),_("small",cs,c(n.path_short),1)):(r(),_("small",ds,c(n.text),1))])])]),"cell(media.length)":U(({item:n})=>{var V;return[K(c((V=n.media)==null?void 0:V.length_text),1)]}),"cell(size)":U(({item:n})=>[n.size?(r(),_(T,{key:1},[K(c(t(Ze)(n.size)),1)],64)):(r(),_(T,{key:0},[K("   ")],64))]),"cell(playlists)":U(({item:n})=>{var V,Z,ee,be;return[((Z=(V=n.media)==null?void 0:V.playlists)==null?void 0:Z.length)>0?(r(!0),_(T,{key:0},te(n.media.playlists,(G,ie)=>(r(),_(T,{key:G.id},[e("a",{class:"btn-search",href:"#",title:t(p)("View tracks in playlist"),onClick:Q(Re=>k("playlist:"+G.short_name),["prevent"])},c(G.name),9,us),ie+1<n.media.playlists.length?(r(),_("span",ms,", ")):ve("",!0)],64))),128)):((be=(ee=n.dir)==null?void 0:ee.playlists)==null?void 0:be.length)>0?(r(!0),_(T,{key:1},te(n.dir.playlists,(G,ie)=>(r(),_(T,{key:G.id},[e("a",{class:"btn-search",href:"#",title:t(p)("View tracks in playlist"),onClick:Q(Re=>k("playlist:"+G.short_name),["prevent"])},c(G.name),9,ps),ie+1<n.dir.playlists.length?(r(),_("span",fs,", ")):ve("",!0)],64))),128)):(r(),_(T,{key:2},[K("   ")],64))]}),"cell(commands)":U(({item:n})=>{var V,Z;return[(Z=(V=n.media)==null?void 0:V.links)!=null&&Z.self?(r(),_("button",{key:0,type:"button",class:"btn btn-sm btn-primary",onClick:ee=>j(n.media.links.self)},c(t(p)("Edit")),9,ys)):(r(),_("button",{key:1,type:"button",class:"btn btn-sm btn-primary",onClick:ee=>x(n.path)},c(t(p)("Rename")),9,_s))]}),_:1},8,["fields","api-url"])]),a(Ft,{ref_key:"$newDirectoryModal",ref:oe,"current-directory":M.value,"mkdir-url":t(s),onRelist:h},null,8,["current-directory","mkdir-url"]),a(Ht,{ref_key:"$moveFilesModal",ref:fe,"selected-items":P.value,"current-directory":M.value,"batch-url":t(i),"list-directories-url":t(u),onRelist:h},null,8,["selected-items","current-directory","batch-url","list-directories-url"]),a(Vt,{ref_key:"$renameModal",ref:H,"rename-url":t(l),onRelist:h},null,8,["rename-url"]),a(Ot,{ref_key:"$editModal",ref:R,"custom-fields":o.customFields,playlists:F.value,onRelist:h},null,8,["custom-fields","playlists"])],64))}});export{Zs as default};
