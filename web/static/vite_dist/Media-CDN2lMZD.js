import{l as ie,d as V,U as Te,c as Z,r as Q,s as ne,i as B,b as _,e,t as u,u as t,g as c,H as O,F as T,y as te,m as ae,O as he,J as Be,o as a,j as ee,w as U,z as ke,q as we,h as Y,f as ve}from"./vue-Cts3TEHg.js";import{_ as De}from"./DataTable-GBWT48IS.js";import{D as Ne}from"./bootstrap.esm-BZy605kZ.js";import{l as I}from"./lodash-Bdl6ys83.js";import{_ as j,P as Ee,Q as Ae,R as qe,S as ce,T as He,I as Ve,U as ze}from"./icons-Be1GHOkw.js";import{f as de,u as se,d as le}from"./usePlayerStore-BlBABSf7.js";import{u as Le}from"./useDialog-M9x0VuxT.js";import{_ as Qe}from"./FlowUpload-BzBEHYe9.js";import{r as ue}from"./index-Hn1RL1dT.js";import{_ as X}from"./index-_C8mTG1e.js";import{u as xe,a as je}from"./useVuelidateOnForm-9fRwUaqh.js";import{u as me,_ as pe}from"./useHasModal-BY4NP-pH.js";import{I as Ce}from"./InvisibleSubmitButton-EsMx6l8t.js";import{a as Oe}from"./index-DP9oPqoW.js";import{_ as Ge}from"./FormGroupMultiCheck-DbWZJYF1.js";import{_ as Je}from"./ModalForm-BXS73Tm6.js";import{_ as $e,a as We}from"./Tabs-qkGGOLea.js";import{u as Ke}from"./useBaseEditModal-8faJWUkS.js";import{m as ge}from"./mergeExisting-DGzkK79d.js";import{_ as Xe}from"./Quota-DVuHIoJa.js";import{_ as Ye}from"./PlayButton-D_xZh6QL.js";import{f as Ze}from"./formatFileSize--9DaIXge.js";import{g as K}from"./router-BM8d8xiL.js";import{b as et,u as tt}from"./router-CIKHY1kb.js";import{u as st}from"./useStationDateTimeFormatter-BhT1ixPB.js";import"./FormMultiCheck-BRaoZhWq.js";import"./FormCheckbox-VeRpO6PO.js";import"./useOptionalStorage-BdJu5QYI.js";import"./lodash-BwctMegf.js";import"./useFormField-Cbkq4UJg.js";import"./FormGroup-LCbWR38E.js";import"./Loading-vp9RNwAY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useSlotsExcept-By0Eq2ad.js";import"./luxon-DgfqPo3b.js";import"./datetime-BTmRqpun.js";function Me(){const{notifySuccess:v,notifyError:m}=de();return{handleBatchResponse:(r,k,p)=>{if(r.success){const s=[];I.forEach(r.dirs,l=>{s.push(ie("div",{},l))}),I.forEach(r.files,l=>{s.push(ie("div",{},l))}),v(s,{title:k})}else{const s=[];I.forEach(r.errors,l=>{s.push(ie("div",{},l))}),m(s,{title:p})}}}}const lt={id:"app-toolbar",class:"d-flex pt-4"},ot={class:"flex-fill buttons d-flex align-items-center"},rt={class:"btn-group btn-group-sm dropdown allow-focus"},it={class:"dropdown"},at=["disabled"],nt={class:"dropdown-menu",style:{"min-width":"300px"}},ct={class:"custom-control custom-checkbox"},dt=["id","value"],ut=["for"],mt={class:"form-group mt-3 mb-4"},pt={class:"input-group custom-control custom-checkbox"},ft={class:"input-group-text"},yt=["placeholder"],_t={class:"buttons"},bt={class:"btn btn-primary",type:"submit"},ht=["disabled"],vt=["disabled"],$t={class:"flex-shrink-0"},gt=V({__name:"MediaToolbar",props:{currentDirectory:{},selectedItems:{},playlists:{},batchUrl:{},supportsImmediateQueue:{type:Boolean}},emits:["relist","add-playlist","move-files","create-directory"],setup(v,{emit:m}){const $=v,r=m,k=Te($,"selectedItems"),p=Z(()=>k.value.all.length>0),s=Q([]),l=Q("");ne(k,h=>{const w=I.map(h.all,D=>{var x,R;const z=((x=D.dir)==null?void 0:x.playlists)??((R=D.media)==null?void 0:R.playlists)??[];return I.map(z,"id")});s.value=I.intersection(...w)}),ne(l,h=>{h!==""&&(s.value.includes("new")||s.value.push("new"))});const{$gettext:f}=se(),{axios:d}=le(),{handleBatchResponse:C}=Me(),{notifyError:q}=de(),F=()=>{q(f("No files selected."))},P=(h,w,D)=>{p.value?d.put($.batchUrl,{do:h,current_directory:$.currentDirectory,files:k.value.files,dirs:k.value.directories}).then(({data:z})=>{C(z,w,D),r("relist")}):F()},{confirmDelete:M}=Le(),A=()=>{const h=k.value.all.length,w=f("Delete %{num} media files?",{num:String(h)});M({title:w,confirmButtonText:f("Delete")}).then(D=>{D.value&&P("delete",f("Files removed:"),f("Error removing files:"))})},y=B("$playlistDropdown"),b=()=>{y.value&&Ne.getInstance(y.value).hide(),p.value?d.put($.batchUrl,{do:"playlist",playlists:s.value,new_playlist_name:l.value,currentDirectory:$.currentDirectory,files:k.value.files,dirs:k.value.directories}).then(({data:h})=>{C(h,s.value.length>0?f("Playlists updated for selected files:"):f("Playlists cleared for selected files:"),f("Error updating playlists:")),h.success&&(h.record&&r("add-playlist",h.record),s.value=[],l.value=""),r("relist")}):F()},S=()=>{s.value=[],l.value="",b()},g=()=>{r("move-files")},N=()=>{r("create-directory")};return(h,w)=>(a(),_("div",lt,[e("div",ot,[e("span",null,u(t(f)("With selected:")),1),e("div",rt,[e("div",it,[e("button",{ref_key:"$playlistDropdown",ref:y,class:"btn btn-sm btn-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","data-bs-auto-close":"outside","aria-expanded":"false",disabled:!p.value},[c(j,{icon:t(Ee)},null,8,["icon"]),e("span",null,u(t(f)("Playlists")),1),w[4]||(w[4]=e("span",{class:"caret"},null,-1))],8,at),e("div",nt,[e("form",{class:"px-4 py-3",onSubmit:O(b,["prevent"])},[(a(!0),_(T,null,te(h.playlists,D=>(a(),_("div",{key:D.id,class:"form-group"},[e("div",ct,[ae(e("input",{id:"chk_playlist_"+D.id,"onUpdate:modelValue":w[0]||(w[0]=z=>s.value=z),type:"checkbox",class:"custom-control-input",name:"playlists[]",value:D.id},null,8,dt),[[he,s.value]]),e("label",{class:"custom-control-label",for:"chk_playlist_"+D.id},u(D.name),9,ut)])]))),128)),w[6]||(w[6]=e("hr",{class:"dropdown-divider"},null,-1)),e("div",mt,[e("div",pt,[e("div",ft,[ae(e("input",{id:"chk_playlist_new","onUpdate:modelValue":w[1]||(w[1]=D=>s.value=D),type:"checkbox",class:"custom-control-input",value:"new"},null,512),[[he,s.value]]),w[5]||(w[5]=e("label",{class:"custom-control-label",for:"chk_playlist_new"},null,-1))]),ae(e("input",{id:"new_playlist_name","onUpdate:modelValue":w[2]||(w[2]=D=>l.value=D),type:"text",class:"form-control p-2",name:"new_playlist_name",style:{"min-width":"150px"},placeholder:t(f)("New Playlist")},null,8,yt),[[Be,l.value]])])]),e("div",_t,[e("button",bt,u(t(f)("Save")),1),e("button",{class:"btn btn-warning",type:"button",onClick:w[3]||(w[3]=D=>S())},u(t(f)("Clear")),1)])],32)])])]),e("button",{type:"button",class:"btn btn-sm btn-primary",disabled:!p.value,onClick:g},[c(j,{icon:t(Ae)},null,8,["icon"]),e("span",null,u(t(f)("Move")),1)],8,ht),e("button",{type:"button",class:"btn btn-sm btn-danger",disabled:!p.value,onClick:A},[c(j,{icon:t(qe)},null,8,["icon"]),e("span",null,u(t(f)("Delete")),1)],8,vt)]),e("div",$t,[e("button",{type:"button",class:"btn btn-sm btn-primary",onClick:N},[c(j,{icon:t(ce)},null,8,["icon"]),e("span",null,u(t(f)("New Folder")),1)])])]))}}),kt={"aria-label":"breadcrumb"},wt={class:"breadcrumb"},Dt={class:"breadcrumb-item"},xt=["onClick"],Ct=V({__name:"Breadcrumb",props:{currentDirectory:{}},emits:["change-directory"],setup(v,{emit:m}){const $=v,r=m,k=Z(()=>{const s=[];if($.currentDirectory==="")return s;let l="";return $.currentDirectory.split("/").forEach(d=>{l===""?l+=d:l+="/"+d,s.push({dir:l,display:d})}),s}),p=s=>{r("change-directory",s)};return(s,l)=>(a(),_(T,null,[e("nav",kt,[e("ol",wt,[e("li",Dt,[e("a",{href:"#",onClick:l[0]||(l[0]=O(f=>p(""),["prevent"]))},u(s.$gettext("Home")),1)]),(a(!0),_(T,null,te(k.value,f=>(a(),_("li",{key:f.dir,class:"breadcrumb-item"},[e("a",{href:"#",onClick:O(d=>p(f.dir),["prevent"])},u(f.display),9,xt)]))),128))])]),l[1]||(l[1]=e("h3",{id:"breadcrumb",class:"card-subtitle mt-0 mb-2"},null,-1))],64))}}),Mt=V({__name:"FileUpload",props:{uploadUrl:{},currentDirectory:{},searchPhrase:{},validMimeTypes:{default:()=>["audio/*"]}},emits:["relist"],setup(v,{emit:m}){const $=v,r=m,k=Z(()=>{const s=new URL($.uploadUrl,document.location.href);return s.searchParams.set("currentDirectory",$.currentDirectory),s.searchParams.set("searchPhrase",$.searchPhrase),s.toString()}),p=()=>{r("relist")};return(s,l)=>(a(),ee(Qe,{"target-url":k.value,"valid-mime-types":s.validMimeTypes,"allow-multiple":"",onComplete:p,onError:p},null,8,["target-url","valid-mime-types"]))}}),Ft=V({__name:"NewDirectoryModal",props:{currentDirectory:{},mkdirUrl:{}},emits:["relist"],setup(v,{expose:m,emit:$}){const r=v,k=$,{form:p,v$:s,resetForm:l,ifValid:f}=xe({newDirectory:{required:ue}},{newDirectory:null}),d=B("$modal"),{hide:C,show:q}=me(d),F=()=>{l()},P=B("$field"),M=()=>{we(()=>{var g;(g=P.value)==null||g.focus()})},{notifySuccess:A}=de(),{axios:y}=le(),{$gettext:b}=se(),S=()=>{f(()=>{y.post(r.mkdirUrl,{currentDirectory:r.currentDirectory,name:p.value.newDirectory}).then(()=>{A(b("New directory created."))}).finally(()=>{k("relist"),C()})})};return m({open:q}),(g,N)=>(a(),ee(pe,{id:"create_directory",ref_key:"$modal",ref:d,centered:"",title:t(b)("New Directory"),onHidden:F,onShown:M},{"modal-footer":U(()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:N[0]||(N[0]=(...h)=>t(C)&&t(C)(...h))},u(t(b)("Close")),1),e("button",{type:"button",class:ke(["btn",t(s).$invalid?"btn-danger":"btn-primary"]),onClick:S},u(t(b)("Create Directory")),3)]),default:U(()=>[e("form",{onSubmit:O(S,["prevent"])},[c(X,{id:"new_directory_name",ref_key:"$field",ref:P,field:t(s).newDirectory,label:t(b)("Directory Name")},null,8,["field","label"]),c(Ce)],32)]),_:1},8,["title"]))}}),St={class:"d-flex flex-column flex-md-row mb-3 align-items-center"},Ut={class:"flex-shrink m-2 m-md-0 me-md-3"},It=["disabled"],Pt={class:"flex-fill m-2 m-md-0 text-end"},Rt={class:"m-0"},Tt={class:"row"},Bt={class:"col-md-12"},Nt={class:"is_dir d-flex align-items-center"},Et={class:"file-icon me-2"},At=["onClick"],qt=["disabled"],Ht=V({__name:"MoveFilesModal",props:{selectedItems:{},currentDirectory:{},batchUrl:{},listDirectoriesUrl:{}},emits:["relist"],setup(v,{expose:m,emit:$}){const r=v,k=$,p=Q(""),s=Q([]),{$gettext:l}=se(),f=[{key:"name",label:l("Directory"),sortable:!0}],d=Z(()=>l("Move %{num} File(s) to",{num:String(r.selectedItems.all.length)})),C=B("$modal"),{show:q,hide:F}=me(C),P=()=>{s.value=[],p.value=""},{axios:M}=le(),{handleBatchResponse:A}=Me(),{state:y,execute:b,isLoading:S}=Oe(()=>M.get(r.listDirectoriesUrl,{params:{currentDirectory:p.value}}).then(x=>x.data.rows),[],{immediate:!1}),g=()=>{M.put(r.batchUrl,{do:"move",currentDirectory:r.currentDirectory,directory:p.value,files:r.selectedItems.files,dirs:r.selectedItems.directories}).then(({data:x})=>{A(x,l("Files moved:"),l("Error moving files:"))}).finally(()=>{F(),k("relist")})},N=B("$dataTable"),h=()=>{b().finally(()=>{var x;(x=N.value)==null||x.refresh()})},w=x=>{s.value.push(x),p.value=x,h()},D=()=>{s.value.pop();let x=s.value.slice(-1)[0];(typeof x>"u"||x===null)&&(x=""),p.value=x,h()};return m({open:()=>{b(),q()}}),(x,R)=>(a(),ee(pe,{id:"move_file",ref_key:"$modal",ref:C,size:"xl",centered:"",title:d.value,onHidden:R[2]||(R[2]=G=>P())},{"modal-footer":U(()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:R[1]||(R[1]=(...G)=>t(F)&&t(F)(...G))},u(t(l)("Close")),1),e("button",{type:"button",class:"btn btn-primary",disabled:r.selectedItems.all.length===0,onClick:g},u(t(l)("Move to Directory")),9,qt)]),default:U(()=>[e("div",St,[e("div",Ut,[e("button",{type:"button",class:"btn btn-sm btn-primary",disabled:s.value.length===0,onClick:D},[c(j,{icon:t(He)},null,8,["icon"]),e("span",null,u(t(l)("Back")),1)],8,It)]),e("div",Pt,[e("h5",Rt,[e("small",null,u(t(l)("Selected directory:")),1),R[3]||(R[3]=e("br",null,null,-1)),p.value?(a(),_(T,{key:0},[Y(u(p.value),1)],64)):(a(),_(T,{key:1},[Y(u(t(l)("Base Directory")),1)],64))])])]),e("div",Tt,[e("div",Bt,[c(De,{id:"station_media",ref_key:"$dataTable",ref:N,"show-toolbar":"",paginated:"",fields:f,items:t(y),loading:t(S),"handle-client-side":"",onRefreshClicked:R[0]||(R[0]=G=>t(b)())},{"cell(name)":U(({item:G})=>[e("div",Nt,[e("span",Et,[c(j,{icon:t(ce)},null,8,["icon"])]),e("a",{href:"#",onClick:O(oe=>w(G.path),["prevent"])},u(G.name),9,At)])]),_:1},8,["items","loading"])])])]),_:1},8,["title"]))}}),Vt=V({__name:"RenameModal",props:{renameUrl:{}},emits:["relist"],setup(v,{expose:m,emit:$}){const r=v,k=$,p=Q(null),{form:s,v$:l,resetForm:f,ifValid:d}=xe({newPath:{required:ue}},{newPath:null}),C=B("$modal"),{show:q,hide:F}=me(C),P=g=>{p.value=g,s.value.newPath=g,q()},M=B("$field"),A=()=>{we(()=>{var g;(g=M.value)==null||g.focus()})},y=()=>{f(),p.value=null},{axios:b}=le(),S=()=>{d(()=>{b.put(r.renameUrl,{file:p.value,...s.value}).finally(()=>{F(),k("relist")})})};return m({open:P}),(g,N)=>(a(),ee(pe,{id:"rename_file",ref_key:"$modal",ref:C,centered:"",title:g.$gettext("Rename File/Directory"),onShown:A,onHidden:y},{"modal-footer":U(()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:N[0]||(N[0]=(...h)=>t(F)&&t(F)(...h))},u(g.$gettext("Close")),1),e("button",{type:"button",class:ke(["btn",t(l).$invalid?"btn-danger":"btn-primary"]),onClick:S},u(g.$gettext("Rename")),3)]),default:U(()=>[e("form",{onSubmit:O(S,["prevent"])},[c(X,{id:"new_directory_name",ref_key:"$field",ref:M,field:t(l).newPath,label:g.$gettext("New File Name")},null,8,["field","label"]),c(Ce)],32)]),_:1},8,["title"]))}}),zt={class:"row g-3"},Lt=V({__name:"BasicInfo",props:{form:{}},setup(v){return(m,$)=>(a(),_("div",zt,[c(X,{id:"edit_form_path",class:"col-md-6",field:m.form.path,label:m.$gettext("File Name"),description:m.$gettext("The relative path of the file in the station's media directory.")},null,8,["field","label","description"]),c(X,{id:"edit_form_title",class:"col-md-6",field:m.form.title,label:m.$gettext("Song Title")},null,8,["field","label"]),c(X,{id:"edit_form_artist",class:"col-md-6",field:m.form.artist,label:m.$gettext("Song Artist")},null,8,["field","label"]),c(X,{id:"edit_form_genre",class:"col-md-6",field:m.form.genre,label:m.$gettext("Song Genre")},null,8,["field","label"]),c(X,{id:"edit_form_album",class:"col-md-6",field:m.form.album,label:m.$gettext("Song Album")},null,8,["field","label"])]))}}),Qt={class:"row"},jt=V({__name:"Playlists",props:{form:{},playlists:{}},setup(v){const m=v,$=Z(()=>I.map(m.playlists,function(r){return{text:r.name,value:r.id}}));return(r,k)=>(a(),_("div",Qt,[c(Ge,{id:"edit_form_playlists",class:"col-md-12",field:r.form.playlists,options:$.value,stacked:"",label:r.$gettext("Playlists")},null,8,["field","options","label"])]))}}),Ot=V({__name:"EditModal",props:{customFields:{},playlists:{},createUrl:{}},emits:["relist"],setup(v,{expose:m,emit:$}){const r=v,k=$,{record:p,reset:s}=je({length:null,length_text:null,links:{art:null,waveform:null,waveform_cache:null,play:null}}),l=B("$modal"),{loading:f,error:d,v$:C,clearContents:q,edit:F,doSubmit:P}=Ke(r,k,l,()=>{const y={path:{required:ue},title:{},artist:{},album:{},genre:{},lyrics:{},isrc:{},art:{},custom_fields:{},extra_metadata:{amplify:{},cross_start_next:{},fade_in:{},fade_out:{},cue_in:{},cue_out:{}},playlists:{}};return I.forEach(r.customFields.slice(),b=>{b.short_name&&(y.custom_fields[b.short_name]={})}),y},()=>{const y={path:null,title:null,artist:null,album:null,genre:null,lyrics:null,isrc:null,custom_fields:{},extra_metadata:{amplify:null,cross_start_next:null,fade_in:null,fade_out:null,cue_in:null,cue_out:null},playlists:[]};return I.forEach(r.customFields.slice(),b=>{b.short_name&&(y.custom_fields[b.short_name]=null)}),y},{resetForm:y=>{y(),s()},populateForm:(y,b)=>{p.value=ge(p.value,y);const S=ge(b.value,y);S.playlists=I.map(y.playlists,"id"),S.custom_fields={},I.forEach(r.customFields.slice(),g=>{S.custom_fields[g.short_name]=I.defaultTo(y.custom_fields[g.short_name],null)}),b.value=S}}),M=y=>{F(y)},A=()=>{q()};return m({open:M}),(y,b)=>(a(),ee(Je,{ref_key:"$modal",ref:l,loading:t(f),title:y.$gettext("Edit Media"),error:t(d),"disable-save-button":t(C).$invalid,onSubmit:t(P),onHidden:A},{default:U(()=>[c(We,{"destroy-on-hide":""},{default:U(()=>[c($e,{label:y.$gettext("Basic Information")},{default:U(()=>[c(Lt,{form:t(C)},null,8,["form"])]),_:1},8,["label"]),c($e,{label:y.$gettext("Playlists")},{default:U(()=>[c(jt,{form:t(C),playlists:y.playlists},null,8,["form","playlists"])]),_:1},8,["label"])]),_:1})]),_:1},8,["loading","title","error","disable-save-button","onSubmit"]))}});var J=(v=>(v.Directory="directory",v.Media="media",v.CoverArt="cover_art",v.UnprocessableFile="unprocessable_file",v.Other="other",v))(J||{});const Gt={class:"card",role:"region","aria-labelledby":"hdr_music_files"},Jt={class:"card-header text-bg-primary"},Wt={class:"row align-items-center"},Kt={class:"col-md-7"},Xt={id:"hdr_music_files",class:"card-title"},Yt={class:"col-md-5 text-end"},Zt={class:"card-body"},es={class:"d-flex align-items-center"},ts={class:"flex-shrink-0 pe-2"},ss={key:0,class:"file-icon"},ls={key:1,class:"file-icon"},os={key:2,class:"file-icon"},rs={class:"flex-fill"},is=["title","onClick"],as=["href","title"],ns=["href","title"],cs={key:3},ds={key:4},us=["title","onClick"],ms={key:0},ps=["title","onClick"],fs={key:0},ys=["onClick"],_s=["onClick"],Zs=V({__name:"Media",props:{initialPlaylists:{default:()=>[]},customFields:{default:()=>[]},validMimeTypes:{default:()=>[]},showSftp:{type:Boolean,default:!0},supportsImmediateQueue:{type:Boolean,default:!0}},setup(v){const m=v,$=K("/files/list"),r=K("/files/batch"),k=K("/files/upload"),p=K("/files/directories"),s=K("/files/mkdir"),l=K("/files/rename"),f=K("/quota/station_media"),{$gettext:d}=se(),{formatTimestampAsDateTime:C}=st(),q=Z(()=>{const o=[{key:"path",isRowHeader:!0,label:d("Name"),sortable:!0,sortFn:(n,i)=>{const E=n.path.match(/\d+/g)?n.path.match(/\d+/g).map(Number):[n.path],L=i.path.match(/\d+/g)?i.path.match(/\d+/g).map(Number):[i.path];for(let H=0;H<Math.min(E.length,L.length);H++)if(E[H]!==L[H])return E[H]-L[H];return n.path.localeCompare(i.path,void 0,{numeric:!0})}},{key:"media.title",label:d("Title"),sortable:!0,selectable:!0,visible:!0},{key:"media.artist",label:d("Artist"),sortable:!0,selectable:!0,visible:!1},{key:"media.album",label:d("Album"),sortable:!0,selectable:!0,visible:!1},{key:"media.genre",label:d("Genre"),sortable:!0,selectable:!0,visible:!1},{key:"media.length",label:d("Length"),sortable:!0,selectable:!0,visible:!0}];return I.forEach({...m.customFields},n=>{o.push({key:"media.custom_fields["+n.short_name+"]",label:n.name,sortable:!0,selectable:!0,visible:!1})}),o.push({key:"size",label:d("Size"),sortable:!0,selectable:!0,visible:!0},{key:"timestamp",label:d("Modified"),sortable:!0,formatter:n=>C(n),selectable:!0,visible:!1},{key:"media.uploaded_at",label:d("Uploaded Time"),sortable:!0,formatter:n=>C(n),selectable:!0,visible:!1},{key:"playlists",label:d("Playlists"),sortable:!1,selectable:!0,visible:!0},{key:"commands",label:d("Actions"),sortable:!1,class:"shrink"}),o}),F=Q(m.initialPlaylists),P=Q({all:[],files:[],directories:[]}),M=Q(""),A=Q(""),y=o=>{const n=I.partition(o,i=>i.type===J.Directory);P.value={all:o,files:I.map(n[1],"path"),directories:I.map(n[0],"path")}},b=B("$dataTable"),S=()=>{var o;(o=b.value)==null||o.navigate()},g=o=>{var n;(n=b.value)==null||n.setFilter(o)},N=B("$quota"),h=()=>{var o,n;(o=N.value)==null||o.update(),(n=b.value)==null||n.relist()},w=o=>{F.value.push(o)},D=o=>{A.value=o},z=B("$renameModal"),x=o=>{var n;(n=z.value)==null||n.open(o)},R=B("$editModal"),G=o=>{var n;(n=R.value)==null||n.open(o)},oe=B("$newDirectoryModal"),Fe=()=>{var o;(o=oe.value)==null||o.open()},fe=B("$moveFilesModal"),Se=()=>{var o;(o=fe.value)==null||o.open()},Ue=o=>(o.params.currentDirectory=M.value,o),Ie=o=>o.substring(0,9)==="playlist:"||o.substring(0,8)==="special:",ye=et(),Pe=tt(),_e=o=>{ye.push({name:"stations:files:index",params:{path:o}})};return ne(()=>Pe.params,async o=>{let n=o.path??"";Array.isArray(n)&&(n=n.join("")),Ie(n)?(await ye.push({name:"stations:files:index"}),g(n)):(M.value=n,S())},{immediate:!0}),(o,n)=>(a(),_(T,null,[e("section",Gt,[e("div",Jt,[e("div",Wt,[e("div",Kt,[e("h2",Xt,u(t(d)("Music Files")),1)]),e("div",Yt,[c(Xe,{ref_key:"$quota",ref:N,"quota-url":t(f)},null,8,["quota-url"])])])]),e("div",Zt,[c(Ct,{"current-directory":M.value,onChangeDirectory:_e},null,8,["current-directory"]),c(Mt,{"upload-url":t(k),"search-phrase":A.value,"valid-mime-types":o.validMimeTypes,"current-directory":M.value,onRelist:h},null,8,["upload-url","search-phrase","valid-mime-types","current-directory"]),c(gt,{"batch-url":t(r),"selected-items":P.value,"current-directory":M.value,"supports-immediate-queue":o.supportsImmediateQueue,playlists:F.value,onAddPlaylist:w,onRelist:h,onCreateDirectory:Fe,onMoveFiles:Se},null,8,["batch-url","selected-items","current-directory","supports-immediate-queue","playlists"])]),c(De,{id:"station_media",ref_key:"$dataTable",ref:b,selectable:"",paginated:"","select-fields":"",fields:q.value,"api-url":t($),"request-config":Ue,onRowSelected:y,onFiltered:D},{"cell(path)":U(({item:i})=>[e("div",es,[e("div",ts,[i.type===t(J).Media?(a(),ee(Ye,{key:0,url:i.media.links.play,class:"btn-lg"},null,8,["url"])):(a(),_(T,{key:1},[i.type===t(J).Directory?(a(),_("span",ss,[c(j,{icon:t(ce)},null,8,["icon"])])):i.type===t(J).CoverArt?(a(),_("span",ls,[c(j,{icon:t(Ve)},null,8,["icon"])])):(a(),_("span",os,[c(j,{icon:t(ze)},null,8,["icon"])]))],64))]),e("div",rs,[i.type===t(J).Directory?(a(),_("a",{key:0,class:"name",href:"#",title:i.text,onClick:O(E=>_e(i.path),["prevent"])},u(i.path_short),9,is)):i.type===t(J).Media?(a(),_("a",{key:1,class:"name",href:i.media.links.play,target:"_blank",title:i.text},u(i.text),9,as)):(a(),_("a",{key:2,class:"name",href:i.links.download,target:"_blank",title:i.text},u(i.path_short),9,ns)),n[0]||(n[0]=e("br",null,null,-1)),i.type===t(J).Media?(a(),_("small",cs,u(i.path_short),1)):(a(),_("small",ds,u(i.text),1))])])]),"cell(media.length)":U(({item:i})=>{var E;return[Y(u((E=i.media)==null?void 0:E.length_text),1)]}),"cell(size)":U(({item:i})=>[i.size?(a(),_(T,{key:1},[Y(u(t(Ze)(i.size)),1)],64)):(a(),_(T,{key:0},[Y("   ")],64))]),"cell(playlists)":U(({item:i})=>{var E,L,H,be;return[((L=(E=i.media)==null?void 0:E.playlists)==null?void 0:L.length)>0?(a(!0),_(T,{key:0},te(i.media.playlists,(W,re)=>(a(),_(T,{key:W.id},[e("a",{class:"btn-search",href:"#",title:t(d)("View tracks in playlist"),onClick:O(Re=>g("playlist:"+W.short_name),["prevent"])},u(W.name),9,us),re+1<i.media.playlists.length?(a(),_("span",ms,", ")):ve("",!0)],64))),128)):((be=(H=i.dir)==null?void 0:H.playlists)==null?void 0:be.length)>0?(a(!0),_(T,{key:1},te(i.dir.playlists,(W,re)=>(a(),_(T,{key:W.id},[e("a",{class:"btn-search",href:"#",title:t(d)("View tracks in playlist"),onClick:O(Re=>g("playlist:"+W.short_name),["prevent"])},u(W.name),9,ps),re+1<i.dir.playlists.length?(a(),_("span",fs,", ")):ve("",!0)],64))),128)):(a(),_(T,{key:2},[Y("   ")],64))]}),"cell(commands)":U(({item:i})=>{var E,L;return[(L=(E=i.media)==null?void 0:E.links)!=null&&L.self?(a(),_("button",{key:0,type:"button",class:"btn btn-sm btn-primary",onClick:H=>G(i.media.links.self)},u(t(d)("Edit")),9,ys)):(a(),_("button",{key:1,type:"button",class:"btn btn-sm btn-primary",onClick:H=>x(i.path)},u(t(d)("Rename")),9,_s))]}),_:1},8,["fields","api-url"])]),c(Ft,{ref_key:"$newDirectoryModal",ref:oe,"current-directory":M.value,"mkdir-url":t(s),onRelist:h},null,8,["current-directory","mkdir-url"]),c(Ht,{ref_key:"$moveFilesModal",ref:fe,"selected-items":P.value,"current-directory":M.value,"batch-url":t(r),"list-directories-url":t(p),onRelist:h},null,8,["selected-items","current-directory","batch-url","list-directories-url"]),c(Vt,{ref_key:"$renameModal",ref:z,"rename-url":t(l),onRelist:h},null,8,["rename-url"]),c(Ot,{ref_key:"$editModal",ref:R,"custom-fields":o.customFields,playlists:F.value,onRelist:h},null,8,["custom-fields","playlists"])],64))}});export{Zs as default};
