import{_ as U,m as W,i as X,ac as Y}from"./icons-Be1GHOkw.js";import{_ as ee}from"./DataTable-IpCKErCf.js";import{u as I,_ as j}from"./useHasModal-CpoPjHcE.js";import{d as E,i as w,j as P,o as c,w as r,e as t,t as i,r as T,c as A,g as o,b,f as N,u as e,z as G,G as te,n as ae,k as oe,m as se,v as le,H as ne,h as J,p as ie,F as ue}from"./vue-Cts3TEHg.js";import{f as re}from"./formatFileSize--9DaIXge.js";import{_ as F}from"./index-_yzKx5VP.js";import{_ as ce}from"./ModalForm-C6TMMAim.js";import{_ as K}from"./FormFieldset-BDg23QuA.js";import{m as de}from"./mergeExisting-DGzkK79d.js";import{_ as H}from"./FormGroupCheckbox-D-gLeBTN.js";import{_ as pe}from"./TimeCode-Dwib3imv.js";import{d as Z,f as me,J as be,u as _e,a as fe}from"./usePlayerStore-DS4JWrVc.js";import{u as q}from"./useVuelidateOnForm-Djx7l4YG.js";import{_ as ke}from"./FormGroupMultiCheck-C7bjG8ut.js";import{_ as Q}from"./FormGroupSelect-DlvjWHXm.js";import{I as ge}from"./InvisibleSubmitButton-EsMx6l8t.js";import{_ as ve}from"./StreamingLogView-D2-IR_1J.js";import{u as he}from"./useConfirmAndDelete-OgT0B0nj.js";import{_ as $e}from"./Loading-vp9RNwAY.js";import{_ as D}from"./CardPage-BV0W_9Ux.js";import{u as ye}from"./luxon-D8V-fPAL.js";import{a as V}from"./router-DKP-J9qz.js";import"./lodash-Bdl6ys83.js";import"./lodash-BwctMegf.js";import"./FormMultiCheck-BRaoZhWq.js";import"./FormCheckbox-VeRpO6PO.js";import"./useOptionalStorage-D1XbMmRA.js";import"./index-TG6t8ei9.js";import"./bootstrap.esm-BZy605kZ.js";import"./useFormField-gQcyfaLO.js";import"./FormGroup-LCbWR38E.js";import"./useSlotsExcept-By0Eq2ad.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useDialog-CxBg2-5w.js";import"./InfoCard-C2q1AMp7.js";import"./datetime-BTmRqpun.js";const xe={id:"modal-log-view-contents",class:"form-control log-viewer",style:{height:"300px","overflow-y":"auto"}},we=E({__name:"LastOutputModal",props:{lastOutput:{}},setup(y,{expose:f}){const k=w("$modal"),{show:d}=I(k);return f({show:d}),(p,m)=>(c(),P(j,{id:"log_view_modal",ref_key:"$modal",ref:k,size:"md",title:p.$gettext("Log Viewer")},{default:r(()=>[t("pre",xe,i(p.lastOutput),1)]),_:1},8,["title"]))}}),Be={class:"row g-3 mb-3"},Le={key:0,class:"row g-3"},Se=E({__name:"ConfigureModal",props:{settingsUrl:{},storageLocations:{}},emits:["relist"],setup(y,{expose:f,emit:k}){const d=y,p=k,m=T(!0),{form:u,resetForm:s,v$:_,ifValid:x}=q({backup_enabled:{},backup_time_code:{},backup_exclude_media:{},backup_keep_copies:{},backup_storage_location:{},backup_format:{}},{backup_enabled:!1,backup_time_code:null,backup_exclude_media:null,backup_keep_copies:null,backup_storage_location:null,backup_format:null}),C=A(()=>[{value:"zip",text:"Zip"},{value:"tgz",text:"TarGz"},{value:"tzst",text:"ZStd"}]),{axios:B}=Z(),g=w("$modal"),{hide:M,show:h}=I(g),$=()=>{p("relist"),M()},z=()=>{s(),m.value=!0,h(),B.get(d.settingsUrl).then(a=>{u.value=de(u.value,a.data),m.value=!1}).catch(()=>{$()})},{notifySuccess:L}=me(),n=()=>{x(()=>{B({method:"PUT",url:d.settingsUrl,data:u.value}).then(()=>{L(),$()})})};return f({open:z}),(a,O)=>(c(),P(ce,{ref_key:"$modal",ref:g,size:"lg",title:a.$gettext("Configure Backups"),loading:m.value,"disable-save-button":e(_).$invalid,onSubmit:n,onHidden:e(s)},{default:r(()=>[o(K,null,{default:r(()=>[t("div",Be,[o(H,{id:"form_edit_backup_enabled",class:"col-md-12",field:e(_).backup_enabled,label:a.$gettext("Run Automatic Nightly Backups"),description:a.$gettext("Enable to have Aplus automatically run nightly backups at the time specified.")},null,8,["field","label","description"])]),e(u).backup_enabled?(c(),b("div",Le,[o(F,{id:"form_backup_time_code",class:"col-md-6",field:e(_).backup_time_code,label:a.$gettext("Scheduled Backup Time")},{default:r(({id:R,model:l,fieldClass:v})=>[o(pe,{id:R,modelValue:l.$model,"onUpdate:modelValue":S=>l.$model=S,class:G(v)},null,8,["id","modelValue","onUpdate:modelValue","class"])]),_:1},8,["field","label"]),o(H,{id:"form_edit_exclude_media",class:"col-md-6",field:e(_).backup_exclude_media,label:a.$gettext("Exclude Media from Backup"),description:a.$gettext("Excluding media from automated backups will save space, but you should make sure to back up your media elsewhere. Note that only locally stored media will be backed up.")},null,8,["field","label","description"]),o(F,{id:"form_backup_keep_copies",class:"col-md-6",field:e(_).backup_keep_copies,"input-type":"number","input-attrs":{min:"0",max:"365"},label:a.$gettext("Number of Backup Copies to Keep"),description:a.$gettext("Copies older than the specified number of days will automatically be deleted. Set to zero to disable automatic deletion.")},null,8,["field","label","description"]),o(Q,{id:"edit_form_backup_storage_location",class:"col-md-6",field:e(_).backup_storage_location,label:a.$gettext("Storage Location"),options:a.storageLocations},null,8,["field","label","options"]),o(ke,{id:"edit_form_backup_format",class:"col-md-6",field:e(_).backup_format,stacked:"",radio:"",options:C.value,label:a.$gettext("Backup Format")},null,8,["field","options","label"])])):N("",!0)]),_:1})]),_:1},8,["title","loading","disable-save-button","onHidden"]))}}),Ce={class:"row g-3"},Me={class:"m-0"},ze={key:1},Re=E({__name:"RunBackupModal",props:{runBackupUrl:{},storageLocations:{}},emits:["relist"],setup(y,{expose:f,emit:k}){const d=y,p=k,m=T(null),u=T(null),s=w("$modal"),{show:_,hide:x}=I(s),{form:C,resetForm:B,v$:g,ifValid:M}=q({storage_location:{},path:{},exclude_media:{}},{storage_location:null,path:"",exclude_media:!1}),{axios:h}=Z(),$=()=>{M(()=>{u.value=null,h({method:"POST",url:d.runBackupUrl,data:C.value}).then(n=>{m.value=n.data.links.log}).catch(n=>{n.value=n.response.data.message})})},z=()=>{m.value=null,u.value=null,B()},L=()=>{z(),p("relist")};return f({open:_}),(n,a)=>(c(),P(j,{id:"run_backup_modal",ref_key:"$modal",ref:s,size:"md",centered:"",title:n.$gettext("Run Manual Backup"),onHidden:L},{default:r(()=>[se(t("div",{class:"alert alert-danger"},i(u.value),513),[[le,u.value!=null]]),m.value===null?(c(),b("form",{key:0,class:"form vue-form",onSubmit:ne($,["prevent"])},[o(K,null,{default:r(()=>[t("div",Ce,[o(Q,{id:"edit_form_storage_location",class:"col-md-12",field:e(g).storage_location,options:n.storageLocations,label:n.$gettext("Storage Location")},null,8,["field","options","label"]),o(F,{id:"edit_form_path",class:"col-md-12",field:e(g).path,label:n.$gettext("File Name")},{description:r(()=>[J(i(n.$gettext("This will be the file name for your backup, include the extension for file type you wish to use. Leave blank to have a name generated automatically."))+" ",1),a[3]||(a[3]=t("br",null,null,-1)),t("strong",null,i(n.$gettext("Supported file formats:")),1),a[4]||(a[4]=t("br",null,null,-1)),t("ul",Me,[a[1]||(a[1]=t("li",null,".zip",-1)),a[2]||(a[2]=t("li",null,".tar.gz",-1)),t("li",null," .tzst ( "+i(n.$gettext("ZStandard compression"))+" ) ",1)])]),_:1},8,["field","label"]),o(H,{id:"edit_form_exclude_media",class:"col-md-12",field:e(g).exclude_media,label:n.$gettext("Exclude Media from Backup"),description:n.$gettext("This will produce a significantly smaller backup, but you should make sure to back up your media elsewhere. Note that only locally stored media will be backed up.")},null,8,["field","label","description"])])]),_:1}),o(ge)],32)):(c(),b("div",ze,[o(ve,{"log-url":m.value},null,8,["log-url"])]))]),"modal-footer":r(O=>[te(n.$slots,"modal-footer",ae(oe(O)),()=>[t("button",{type:"button",class:"btn btn-secondary",onClick:a[0]||(a[0]=(...R)=>e(x)&&e(x)(...R))},i(n.$gettext("Close")),1),m.value===null?(c(),b("button",{key:0,class:G(["btn",e(g).$invalid?"btn-danger":"btn-primary"]),type:"submit",onClick:$},i(n.$gettext("Run Manual Backup")),3)):N("",!0)])]),_:3},8,["title"]))}}),Te=E({__name:"EnabledBadge",props:{enabled:{type:Boolean}},setup(y){const f=y,k=A(()=>f.enabled?"text-bg-success":"text-bg-danger"),{$gettext:d}=be(),p=A(()=>f.enabled?d("Enabled"):d("Disabled"));return(m,u)=>(c(),b("small",{class:G(["badge rounded-pill ms-2",k.value])},i(p.value),3))}}),Ee={class:"outside-card-header mb-1"},Oe={class:"row row-of-cards"},Ne={class:"col-md-6"},Ue=["id"],De={key:0,class:"card-body"},Ve={key:0,class:"card-text"},Ae={key:1,class:"card-text"},Fe={class:"col-md-6"},He={class:"card-body"},Ie={class:"card-text"},Pe={key:0},Ge={key:1},Ze={class:"card-text text-warning"},je={class:"btn-group btn-group-sm"},Je=["href"],Ke=["onClick"],Tt=E({__name:"Backups",props:{storageLocations:{},isDocker:{type:Boolean,default:!0}},setup(y){const f=V("/admin/backups"),k=V("/admin/backups/run"),d=V("/admin/settings/backup"),p=T(!1),u=T({...{backupEnabled:!1,backupLastRun:0,backupLastOutput:""}}),{$gettext:s}=_e(),{timeConfig:_}=fe(),{DateTime:x,timestampToRelative:C}=ye(),B=[{key:"basename",isRowHeader:!0,label:s("File Name"),sortable:!1},{key:"timestamp",label:s("Last Modified"),sortable:!1,formatter:l=>x.fromSeconds(l).toLocaleString({...x.DATETIME_SHORT,..._})},{key:"size",label:s("Size"),sortable:!1,formatter:l=>re(l)},{key:"actions",label:s("Actions"),sortable:!1,class:"shrink"}],g=w("$dataTable"),{axios:M}=Z(),h=()=>{var l;p.value=!0,M.get(d.value).then(v=>{u.value={backupEnabled:v.data.backup_enabled,backupLastRun:v.data.backup_last_run,backupLastOutput:v.data.backup_last_output},p.value=!1}),(l=g.value)==null||l.relist()};ie(h);const $=w("$lastOutputModal"),z=()=>{var l;(l=$.value)==null||l.show()},L=w("$configureModal"),n=()=>{var l;(l=L.value)==null||l.open()},a=w("$runBackupModal"),O=()=>{var l;(l=a.value)==null||l.open()},{doDelete:R}=he(s("Delete Backup?"),h);return(l,v)=>(c(),b(ue,null,[t("h2",Ee,i(e(s)("Backups")),1),t("div",Oe,[t("div",Ne,[o(D,{"header-id":"hdr_automatic_backups"},{header:r(({id:S})=>[t("h2",{id:S,class:"card-title"},[J(i(e(s)("Automatic Backups"))+" ",1),o(Te,{enabled:u.value.backupEnabled},null,8,["enabled"])],8,Ue)]),footer_actions:r(()=>[t("button",{type:"button",class:"btn btn-primary",onClick:n},[o(U,{icon:e(W)},null,8,["icon"]),t("span",null,i(e(s)("Configure")),1)]),u.value.backupEnabled&&u.value.backupLastOutput!==""?(c(),b("button",{key:0,type:"button",class:"btn btn-secondary",onClick:z},[o(U,{icon:e(X)},null,8,["icon"]),t("span",null,i(e(s)("Most Recent Backup Log")),1)])):N("",!0)]),default:r(()=>[o($e,{loading:p.value},{default:r(()=>[u.value.backupEnabled?(c(),b("div",De,[u.value.backupLastRun>0?(c(),b("p",Ve,i(e(s)("Last run:"))+" "+i(e(C)(u.value.backupLastRun)),1)):(c(),b("p",Ae,i(e(s)("Never run")),1))])):N("",!0)]),_:1},8,["loading"])]),_:1})]),t("div",Fe,[o(D,{"header-id":"hdr_restoring_backups",title:e(s)("Restoring Backups")},{default:r(()=>[t("div",He,[t("p",Ie,i(e(s)("To restore a backup from your host computer, run:")),1),l.isDocker?(c(),b("pre",Pe,v[0]||(v[0]=[t("code",null,"./docker.sh restore path_to_backup.zip",-1)]))):(c(),b("pre",Ge,v[1]||(v[1]=[t("code",null,"/var/azuracast/www/bin/console azuracast:restore path_to_backup.zip",-1)]))),t("p",Ze,i(e(s)("Note that restoring a backup will clear your existing database. Never restore backup files from untrusted users.")),1)])]),_:1},8,["title"])])]),o(D,{"header-id":"hdr_backups",title:e(s)("Backups")},{actions:r(()=>[t("button",{type:"button",class:"btn btn-primary",onClick:O},[o(U,{icon:e(Y)},null,8,["icon"]),t("span",null,i(e(s)("Run Manual Backup")),1)])]),default:r(()=>[o(ee,{id:"api_keys",ref_key:"$dataTable",ref:g,fields:B,"api-url":e(f)},{"cell(actions)":r(S=>[t("div",je,[t("a",{class:"btn btn-primary",href:S.item.links.download,target:"_blank"},i(e(s)("Download")),9,Je),t("button",{type:"button",class:"btn btn-danger",onClick:qe=>e(R)(S.item.links.delete)},i(e(s)("Delete")),9,Ke)])]),_:1},8,["api-url"])]),_:1},8,["title"]),o(Se,{ref_key:"$configureModal",ref:L,"settings-url":e(d),"storage-locations":l.storageLocations,onRelist:h},null,8,["settings-url","storage-locations"]),o(Re,{ref_key:"$runBackupModal",ref:a,"run-backup-url":e(k),"storage-locations":l.storageLocations,onRelist:h},null,8,["run-backup-url","storage-locations"]),o(we,{ref_key:"$lastOutputModal",ref:$,"last-output":u.value.backupLastOutput},null,8,["last-output"])],64))}});export{Tt as default};
