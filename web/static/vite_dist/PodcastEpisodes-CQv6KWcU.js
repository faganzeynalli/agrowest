import{_ as de}from"./DataTable-Dp56V6rG.js";import{_ as M,u as re}from"./index-C_UvpT9Y.js";import{_ as se}from"./FormGroupCheckbox-CTHhadoY.js";import{u as ce}from"./useVuelidateOnFormTab-BUBlrGIU.js";import{r as z}from"./index-ewPk_2zx.js";import{_ as le,a as ue}from"./Tabs-DrIrlpc6.js";import{d as C,a4 as X,L as O,r as W,s as j,b as f,o as u,e as s,m as G,J as Q,A as me,h as D,u as e,w as p,g as i,z as Y,U as oe,c as A,i as F,t as n,f as H,j as N,K as pe,l as ee,y as _e,F as q,H as fe,N as be,x as he,a as ve}from"./vue-iE2ul1Tq.js";import{u as ge}from"./luxon-CN0Wl2c5.js";import{b as $e,D as ke,d as Z,u as L,f as ye}from"./usePlayerStore-BEpUNPqs.js";import{_ as we}from"./Artwork-CLXq5iJ_.js";import{_ as Ee}from"./FlowUpload-CEdwB1zF.js";import{_ as xe}from"./FormGroup-CskLXm1p.js";import{_ as Me}from"./FormMarkup-DNyWgSl8.js";import{u as Ue}from"./useBaseEditModal-BohQVK9I.js";import{a as Ve,u as Ce}from"./useVuelidateOnForm-Dy2skimr.js";import{m as J}from"./mergeExisting-Ae2otqxP.js";import{_ as Se}from"./ModalForm-B59dRoID.js";import{_ as K,j as Ie,X as Te,Z as Ae}from"./icons-BWfrmhNV.js";import{A as te}from"./AlbumArt-BbneoqZJ.js";import{_ as De}from"./Quota-CYdCy5Ae.js";import{u as Be,_ as Ne}from"./AddButton-BZZEg7Ne.js";import{u as Re}from"./useHasDatatable-DPFcIMM0.js";import{g as Pe}from"./router-B10VPpWI.js";import{u as Fe}from"./useConfirmAndDelete-B7jnOVNE.js";import{u as He}from"./useStationDateTimeFormatter-BSYCTUoe.js";import{_ as qe}from"./CardPage-ZJgGeLMb.js";import{l as R}from"./lodash-Bdl6ys83.js";import{u as ze}from"./useDialog-Bv90pssM.js";import{u as ae,_ as Oe}from"./useHasModal-CoYYgkj_.js";import{I as Le}from"./InvisibleSubmitButton-CdJXAqzD.js";import{a as je}from"./index-BEa1kYZR.js";import{_ as We}from"./Loading-DwEn1sGo.js";import"./FormMultiCheck-DlXuiotF.js";import"./FormCheckbox-3stnvCiS.js";import"./useOptionalStorage-CgK__Z8z.js";import"./useFormField-D62M9aUc.js";import"./datetime-BTmRqpun.js";import"./bootstrap.esm-BZy605kZ.js";import"./lodash-BwctMegf.js";import"./FormFile-BqgG6Tes.js";import"./formatFileSize--9DaIXge.js";import"./useSlotsExcept-CgqFDf0x.js";import"./lightbox-D_HhKVLL.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./InfoCard-BAqonmYw.js";const Je={class:"col-6"},Ke=["id"],Xe={class:"col-6"},Ye=["id"],ie=C({__name:"PublishAtFields",props:X({id:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(b){const m=O(b,"modelValue"),l=W(""),t=W(""),{DateTime:o}=ge(),{timezone:v}=$e();j(m,d=>{if(d!==null){const a=o.fromSeconds(Number(d),{zone:v});l.value=a.toISODate(),t.value=a.toISOTime({suppressMilliseconds:!0,includeOffset:!1})}else l.value="",t.value=""},{immediate:!0});const c=()=>{if(l.value.length>0&&t.value.length>0){const d=l.value+"T"+t.value,a=o.fromISO(d,{zone:v});m.value=a.toSeconds()}else m.value=null};return j(l,()=>{c()}),j(t,()=>{c()}),(d,a)=>(u(),f("div",me({class:"row g-2"},d.$attrs),[s("div",Je,[G(s("input",{id:d.id+"_date","onUpdate:modelValue":a[0]||(a[0]=_=>l.value=_),class:"form-control",type:"date"},null,8,Ke),[[Q,l.value]])]),s("div",Xe,[G(s("input",{id:d.id+"_time","onUpdate:modelValue":a[1]||(a[1]=_=>t.value=_),class:"form-control",type:"time"},null,8,Ye),[[Q,t.value]])])],16))}}),Ze={class:"row g-3"},Ge=C({__name:"BasicInfo",props:{form:{required:!0},formModifiers:{}},emits:["update:form"],setup(b){const m=O(b,"form"),{v$:l,tabClass:t}=ce(m,{title:{required:z},link:{},description:{required:z},publish_at:{},explicit:{},season_number:{},episode_number:{}},{title:"",link:"",description:"",publish_at:null,explicit:!1,season_number:null,episode_number:null});return(o,v)=>(u(),D(le,{label:o.$gettext("Basic Information"),"item-header-class":e(t)},{default:p(()=>[s("div",Ze,[i(M,{id:"form_edit_title",class:"col-md-6",field:e(l).title,label:o.$gettext("Episode")},null,8,["field","label"]),i(M,{id:"form_edit_link",class:"col-md-6",field:e(l).link,label:o.$gettext("Website"),description:o.$gettext("Typically a website with content about the episode.")},null,8,["field","label","description"]),i(M,{id:"form_edit_description",class:"col-md-12",field:e(l).description,"input-type":"textarea",label:o.$gettext("Description"),description:o.$gettext("The description of the episode. The typical maximum amount of text allowed for this is 4000 characters.")},null,8,["field","label","description"]),i(M,{id:"form_edit_publish_at",class:"col-md-12",field:e(l).publish_at,label:o.$gettext("Publish At"),description:o.$gettext("The date and time when the episode should be published.")},{default:p(({id:c,model:d,fieldClass:a})=>[i(ie,{id:c,modelValue:d.$model,"onUpdate:modelValue":_=>d.$model=_,class:Y(a)},null,8,["id","modelValue","onUpdate:modelValue","class"])]),_:1},8,["field","label","description"]),i(se,{id:"form_edit_explicit",class:"col-md-12",field:e(l).explicit,label:o.$gettext("Contains explicit content"),description:o.$gettext("Indicates the presence of explicit content (explicit language or adult content). Apple Podcasts displays an Explicit parental advisory graphic for your episode if turned on. Episodes containing explicit material aren't available in some Apple Podcasts territories.")},null,8,["field","label","description"]),i(M,{id:"form_edit_season_number",class:"col-md-6",field:e(l).season_number,"input-type":"number","input-attrs":{step:"1"},label:o.$gettext("Season Number"),description:o.$gettext("Optionally list this episode as part of a season in some podcast aggregators."),clearable:""},null,8,["field","label","description"]),i(M,{id:"form_edit_episode_number",class:"col-md-6",field:e(l).episode_number,"input-type":"number","input-attrs":{step:"1"},label:o.$gettext("Episode Number"),description:o.$gettext("Optionally set a specific episode number in some podcast aggregators."),clearable:""},null,8,["field","label","description"])])]),_:1},8,["label","item-header-class"]))}}),Qe={class:"row g-3"},et={key:0,class:"block-buttons pt-3"},tt=["href"],st={key:1},lt=C({__name:"Media",props:X({recordHasMedia:{type:Boolean},editMediaUrl:{},newMediaUrl:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(b){const m=b,l=O(b,"modelValue"),t=W(null);ke(oe(m,"recordHasMedia"),t,{direction:"ltr"});const o=A(()=>m.editMediaUrl?m.editMediaUrl:m.newMediaUrl),v=(a,_)=>{t.value=!0,!m.editMediaUrl&&_&&(l.value=_)},{axios:c}=Z(),d=()=>{m.editMediaUrl?c.delete(m.editMediaUrl).then(()=>{t.value=!1}):(t.value=!1,l.value=null)};return(a,_)=>(u(),D(le,{label:a.$gettext("Media")},{default:p(()=>[s("div",Qe,[i(xe,{id:"media_file",class:"col-md-6"},{label:p(()=>[F(n(a.$gettext("Select Media File")),1)]),description:p(()=>[F(n(a.$gettext("Podcast media should be in the MP3 or M4A (AAC) format for the greatest compatibility.")),1)]),default:p(()=>[i(Ee,{"target-url":o.value,"valid-mime-types":["audio/x-m4a","audio/mpeg"],onSuccess:v},null,8,["target-url"])]),_:1}),i(Me,{id:"current_podcast_media",class:"col-md-6"},{label:p(()=>[F(n(a.$gettext("Current Podcast Media")),1)]),default:p(()=>[t.value?(u(),f("div",et,[a.editMediaUrl?(u(),f("a",{key:0,class:"btn btn-block btn-dark",href:a.editMediaUrl,target:"_blank"},n(a.$gettext("Download")),9,tt)):H("",!0),s("button",{type:"button",class:"btn btn-block btn-danger",onClick:d},n(a.$gettext("Clear Media")),1)])):(u(),f("div",st,n(a.$gettext("There is no existing media associated with this episode.")),1))]),_:1})])]),_:1},8,["label"]))}}),ot=C({__name:"EpisodeEditModal",props:{podcast:{},createUrl:{}},emits:["relist"],setup(b,{expose:m,emit:l}){const t=b,o=l,v=A(()=>t.podcast.links.episode_new_art),c=A(()=>t.podcast.links.episode_new_media),d=A(()=>t.podcast.source=="manual"),a=N("$modal"),{record:_,reset:w}=Ve({has_custom_art:!1,art:null,has_media:!1,media:null,links:{art:null,media:null,download:null}}),{loading:U,error:S,isEditMode:g,form:k,v$:V,clearContents:I,create:B,edit:y,doSubmit:P,close:h}=Ue(t,o,a,{artwork_file:{},media_file:{}},{artwork_file:null,media_file:null},{resetForm:r=>{r(),w()},populateForm:(r,$)=>{_.value=J(_.value,r),$.value=J($.value,r)}}),{$gettext:x}=L(),E=A(()=>g.value?x("Edit Episode"):x("Add Episode"));return m({create:B,edit:y,close:h}),(r,$)=>(u(),D(Se,{ref_key:"$modal",ref:a,loading:e(U),title:E.value,error:e(S),"disable-save-button":e(V).$invalid,onSubmit:e(P),onHidden:e(I)},{default:p(()=>[i(ue,null,{default:p(()=>[i(Ge,{form:e(k),"onUpdate:form":$[0]||($[0]=T=>pe(k)?k.value=T:null)},null,8,["form"]),d.value?(u(),D(lt,{key:0,modelValue:e(k).media_file,"onUpdate:modelValue":$[1]||($[1]=T=>e(k).media_file=T),"record-has-media":e(_).has_media,"new-media-url":c.value,"edit-media-url":e(_).links.media},null,8,["modelValue","record-has-media","new-media-url","edit-media-url"])):H("",!0),i(we,{modelValue:e(k).artwork_file,"onUpdate:modelValue":$[2]||($[2]=T=>e(k).artwork_file=T),"artwork-src":e(_).links.art,"new-art-url":v.value},null,8,["modelValue","artwork-src","new-art-url"])]),_:1})]),_:1},8,["loading","title","error","disable-save-button","onSubmit","onHidden"]))}});function ne(){const{notifySuccess:b,notifyError:m}=ye();return{handleBatchResponse:(t,o,v)=>{if(t.success){const c=[];R.forEach(t.episodes,d=>{c.push(ee("div",{},d.title))}),b(c,{title:o})}else{const c=[];R.forEach(t.errors,d=>{c.push(ee("div",{},d))}),m(c,{title:v})}}}}const at={class:"card-body py-1 buttons d-flex align-items-center"},it=["disabled"],nt=["disabled"],dt=C({__name:"EpisodesToolbar",props:{batchUrl:{},selectedItems:{},podcastIsManual:{type:Boolean,default:!0}},emits:["relist","batch-edit"],setup(b,{emit:m}){const l=b,t=m,{$gettext:o}=L(),{axios:v}=Z(),c=oe(l,"selectedItems"),d=A(()=>c.value.length>0),{handleBatchResponse:a}=ne(),_=(g,k,V)=>{v.put(l.batchUrl,{do:g,episodes:R.map(l.selectedItems,"id")}).then(({data:I})=>{a(I,k,V),t("relist")})},{confirmDelete:w}=ze(),U=()=>{w({title:o("Delete %{num} episodes?",{num:String(l.selectedItems.length)})}).then(g=>{g.value&&_("delete",o("Episodes removed:"),o("Error removing episodes:"))})},S=()=>{t("batch-edit")};return(g,k)=>(u(),f("div",at,[s("span",null,n(e(o)("With selected:")),1),s("button",{type:"button",class:"btn btn-sm btn-warning",disabled:!d.value,onClick:S},[i(K,{icon:e(Ie)},null,8,["icon"]),s("span",null,n(e(o)("Edit")),1)],8,it),g.podcastIsManual?(u(),f("button",{key:0,type:"button",class:"btn btn-sm btn-danger",disabled:!d.value,onClick:U},[i(K,{icon:e(Te)},null,8,["icon"]),s("span",null,n(e(o)("Delete")),1)],8,nt)):H("",!0)]))}}),rt=C({__name:"BatchEditRow",props:X({index:{}},{row:{},rowModifiers:{}}),emits:["update:row"],setup(b){const m=O(b,"row"),l=re({id:{required:z},title:{required:z},publish_at:{},explicit:{},season_number:{},episode_number:{}},m);return(t,o)=>(u(),f("tr",null,[s("td",null,[i(M,{id:"form_edit_title_"+t.index,field:e(l).title},null,8,["id","field"])]),s("td",null,[i(M,{id:"form_edit_publish_at_"+t.index,field:e(l).publish_at},{default:p(({id:v,model:c,fieldClass:d})=>[i(ie,{id:v,modelValue:c.$model,"onUpdate:modelValue":a=>c.$model=a,class:Y(d)},null,8,["id","modelValue","onUpdate:modelValue","class"])]),_:1},8,["id","field"])]),s("td",null,[i(se,{id:"form_edit_explicit_"+t.index,field:e(l).explicit},null,8,["id","field"])]),s("td",null,[i(M,{id:"form_edit_season_number_"+t.index,field:e(l).season_number,"input-type":"number","input-attrs":{step:"1"},clearable:""},null,8,["id","field"])]),s("td",null,[i(M,{id:"form_edit_episode_number_"+t.index,field:e(l).episode_number,"input-type":"number","input-attrs":{step:"1"},clearable:""},null,8,["id","field"])])]))}}),ct={class:"table-responsive"},ut={class:"table table-sm align-middle table-striped table-hover"},mt=C({__name:"BatchEditModal",props:{batchUrl:{},selectedItems:{}},emits:["relist"],setup(b,{expose:m,emit:l}){const t=b,o=l,{v$:v,resetForm:c,ifValid:d}=Ce(),a=N("$modal"),{show:_,hide:w}=ae(a),{axios:U}=Z(),S={id:null,title:null,publish_at:null,explicit:!1,season_number:null,episode_number:null},{state:g,execute:k,isLoading:V}=je(()=>U.put(t.batchUrl,{do:"list",episodes:R.map(t.selectedItems,"id")}).then(x=>R.map(x.data.records,E=>J(S,E))),[],{immediate:!1,shallow:!1}),I=()=>{k(),_()},B=()=>{g.value=[],c()},{$gettext:y}=L(),{handleBatchResponse:P}=ne(),h=()=>{d(()=>{U.put(t.batchUrl,{do:"edit",episodes:R.map(t.selectedItems,"id"),records:g.value}).then(({data:x})=>{P(x,y("Episodes updated:"),y("Error updating episodes:")),w(),o("relist")})})};return m({show:I,hide:w}),(x,E)=>(u(),D(Oe,{id:"batch_edit_modal",ref_key:"$modal",ref:a,centered:"",size:"xl",title:e(y)("Bulk Edit Episodes"),onHidden:B},{"modal-footer":p(()=>[s("button",{type:"button",class:"btn btn-secondary",onClick:E[0]||(E[0]=(...r)=>e(w)&&e(w)(...r))},n(e(y)("Close")),1),s("button",{type:"button",class:Y(["btn",e(v).$invalid?"btn-danger":"btn-primary"]),onClick:h},n(e(y)("Save Changes")),3)]),default:p(()=>[s("form",{onSubmit:fe(h,["prevent"])},[i(We,{loading:e(V)},{default:p(()=>[s("div",ct,[s("table",ut,[E[1]||(E[1]=s("colgroup",null,[s("col"),s("col"),s("col",{style:{width:"8rem"}}),s("col",{style:{width:"11rem"}}),s("col",{style:{width:"11rem"}})],-1)),s("thead",null,[s("tr",null,[s("th",null,n(e(y)("Episode")),1),s("th",null,n(e(y)("Publish At")),1),s("th",null,n(e(y)("Explicit")),1),s("th",null,n(e(y)("Season Number")),1),s("th",null,n(e(y)("Episode Number")),1)])]),s("tbody",null,[(u(!0),f(q,null,_e(e(g),(r,$)=>(u(),D(rt,{key:r.id,row:e(g)[$],"onUpdate:row":T=>e(g)[$]=T,index:$},null,8,["row","onUpdate:row","index"]))),128))])])])]),_:1},8,["loading"]),i(Le)],32)]),_:1},8,["title"]))}}),pt={class:"row align-items-center"},_t={class:"col-md-7"},ft={class:"d-flex align-items-center"},bt={class:"flex-shrink-0 pe-3"},ht={class:"flex-fill"},vt={class:"card-title"},gt={class:"card-subtitle"},$t={class:"col-md-5 text-end"},kt={class:"card-text"},yt={class:"m-0"},wt={key:0},Et=["href"],xt={key:1,class:"badges"},Mt={class:"badge text-bg-info"},Ut={key:1},Vt={key:0},Ct={key:1},St={key:0,class:"badge text-bg-danger"},It={key:1},Tt={class:"btn-group btn-group-sm"},At=["onClick"],Dt=["onClick"],Ms=C({__name:"PodcastEpisodes",props:{podcast:{}},setup(b){const m=b,l=Pe("/quota/station_podcasts"),{$gettext:t}=L(),{formatTimestampAsDateTime:o}=He(),v=[{key:"art",label:t("Art"),sortable:!1,class:"shrink pe-0",selectable:!0},{key:"title",label:t("Episode"),sortable:!1},{key:"media",label:t("File Name"),sortable:!1},{key:"is_published",label:t("Is Published"),visible:!1,sortable:!1,selectable:!0},{key:"publish_at",label:t("Publish At"),formatter:(h,x,E)=>o(E.publish_at),sortable:!0,selectable:!0},{key:"explicit",label:t("Explicit"),sortable:!0,selectable:!0},{key:"season_number",label:t("Season Number"),visible:!1,sortable:!0,selectable:!0},{key:"episode_number",label:t("Episode Number"),visible:!1,sortable:!0,selectable:!0},{key:"actions",label:t("Actions"),sortable:!1,class:"shrink"}],c=A(()=>m.podcast.source=="manual"),d=N("$quota"),a=N("$dataTable"),{refresh:_}=Re(a),w=()=>{var h;(h=d.value)==null||h.update(),_()},U=N("$editEpisodeModal"),{doCreate:S,doEdit:g}=Be(U),{doDelete:k}=Fe(t("Delete Episode?"),()=>w()),V=be([]),I=h=>{V.value=h},B=N("$batchEditModal"),{show:y}=ae(B),P=()=>{y()};return(h,x)=>{const E=ve("router-link");return u(),f(q,null,[i(qe,null,he({header:p(()=>[s("div",pt,[s("div",_t,[s("div",ft,[s("div",bt,[i(te,{src:h.podcast.art},null,8,["src"])]),s("div",ht,[s("h2",vt,n(h.podcast.title),1),s("h4",gt,n(e(t)("Episodes")),1)])])]),s("div",$t,[i(De,{ref_key:"$quota",ref:d,"quota-url":e(l)},null,8,["quota-url"])])])]),actions:p(()=>[i(E,{class:"btn btn-secondary",to:{name:"stations:podcasts:index"}},{default:p(()=>[i(K,{icon:e(Ae)},null,8,["icon"]),F(" "+n(e(t)("All Podcasts")),1)]),_:1}),c.value?(u(),D(Ne,{key:0,text:e(t)("Add Episode"),onClick:e(S)},null,8,["text","onClick"])):H("",!0)]),default:p(()=>[i(dt,{"batch-url":h.podcast.links.batch,"selected-items":V.value,"podcast-is-manual":c.value,onRelist:w,onBatchEdit:P},null,8,["batch-url","selected-items","podcast-is-manual"]),i(de,{id:"station_podcast_episodes",ref_key:"$dataTable",ref:a,selectable:"",paginated:"","select-fields":"",fields:v,"api-url":h.podcast.links.episodes,onRowSelected:I},{"cell(art)":p(({item:r})=>[i(te,{src:r.art},null,8,["src"])]),"cell(title)":p(({item:r})=>[s("h5",yt,n(r.title),1),r.is_published?(u(),f("div",wt,[s("a",{href:r.links.public,target:"_blank"},n(e(t)("Public Page")),9,Et)])):(u(),f("div",xt,[s("span",Mt,n(e(t)("Unpublished")),1)]))]),"cell(media)":p(({item:r})=>[r.media?(u(),f(q,{key:0},[s("span",null,n(r.media.original_name),1),x[0]||(x[0]=s("br",null,null,-1)),s("small",null,n(r.media.length_text),1)],64)):r.playlist_media?(u(),f("span",Ut,n(r.playlist_media.text),1)):(u(),f(q,{key:2},[F("   ")],64))]),"cell(is_published)":p(({item:r})=>[r.is_published?(u(),f("span",Vt,n(e(t)("Yes")),1)):(u(),f("span",Ct,n(e(t)("No")),1))]),"cell(explicit)":p(({item:r})=>[r.explicit?(u(),f("span",St,n(e(t)("Explicit")),1)):(u(),f("span",It," "))]),"cell(actions)":p(({item:r})=>[s("div",Tt,[s("button",{type:"button",class:"btn btn-primary",onClick:$=>e(g)(r.links.self)},n(e(t)("Edit")),9,At),c.value?(u(),f("button",{key:0,type:"button",class:"btn btn-danger",onClick:$=>e(k)(r.links.self)},n(e(t)("Delete")),9,Dt)):H("",!0)])]),_:1},8,["api-url"])]),_:2},[c.value?void 0:{name:"info",fn:p(()=>[s("p",kt,n(e(t)("This podcast is automatically synchronized with a playlist. Episodes cannot be manually added or removed via this panel.")),1)]),key:"0"}]),1024),i(ot,{ref_key:"$editEpisodeModal",ref:U,podcast:h.podcast,"create-url":h.podcast.links.episodes,onRelist:w},null,8,["podcast","create-url"]),i(mt,{ref_key:"$batchEditModal",ref:B,"batch-url":h.podcast.links.batch,"selected-items":V.value,onRelist:w},null,8,["batch-url","selected-items"])],64)}}});export{Ms as default};
