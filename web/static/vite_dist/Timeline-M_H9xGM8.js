import{_,M as A,an as I,ao as V}from"./icons-Yf7pfv1X.js";import{_ as $}from"./DataTable-D872TXoQ.js";import{_ as z}from"./DateRangeDropdown-CV2VaEUZ.js";import{b as C,u as L}from"./usePlayerStore-BJXDzq-w.js";import{g as E}from"./router-wzMi1FLb.js";import{u as B}from"./useHasDatatable-DPFcIMM0.js";import{u as H}from"./useStationDateTimeFormatter-nKrxjiBK.js";import{u as J}from"./luxon-Cw61P3gq.js";import{d as M,r as O,c as k,j as q,y as F,b as o,e as l,g as p,t,u as n,w as f,o as r,F as c,i as m,x as N,q as j}from"./vue-B-dHMJBO.js";import"./lodash-Bdl6ys83.js";import"./lodash-BwctMegf.js";import"./FormMultiCheck-C8kU6V99.js";import"./FormCheckbox-CBrIHDuX.js";import"./useOptionalStorage-CjmLv0hJ.js";import"./index-Cwv7sFxi.js";import"./PanelLayout-BXXqPnEo.js";import"./bootstrap.esm-BZy605kZ.js";import"./datetime-BTmRqpun.js";const w={class:"card"},G={class:"card-header text-bg-primary"},K={class:"d-lg-flex align-items-center"},Q={class:"card-title flex-fill my-0"},W={class:"flex-shrink buttons mt-2 mt-lg-0"},X=["href"],Y={class:"flex-shrink buttons ms-lg-2 mt-2 mt-lg-0"},Z={class:"typography-subheading"},ee={key:0,class:"text-success"},te={key:1,class:"text-danger"},he=M({__name:"Timeline",setup(ae){const h=E("/history"),{timezone:v}=C(),{DateTime:d}=J(),{now:x,formatDateTimeAsDateTime:D,formatTimestampAsDateTime:S}=H(),b=x(),u=O({startDate:b.minus({days:13}).toJSDate(),endDate:b.toJSDate()}),{$gettext:a}=L(),U=[{key:"played_at",label:a("Date/Time (Browser)"),selectable:!0,sortable:!1,visible:!1,formatter:s=>D(d.fromSeconds(s,{zone:"system"}),d.DATETIME_SHORT)},{key:"played_at_station",label:a("Date/Time (Station)"),sortable:!1,selectable:!0,visible:!0,formatter:(s,i,e)=>S(e.played_at,d.DATETIME_SHORT)},{key:"listeners_start",label:a("Listeners"),selectable:!0,sortable:!1},{key:"delta",label:a("Change"),selectable:!0,sortable:!1},{key:"song",isRowHeader:!0,label:a("Song Title"),selectable:!0,sortable:!1},{key:"source",label:a("Source"),selectable:!0,sortable:!1}],y=k(()=>{const s=new URL(h.value,document.location.href),i=s.searchParams;return i.set("start",d.fromJSDate(u.value.startDate).toISO()),i.set("end",d.fromJSDate(u.value.endDate).toISO()),s.toString()}),P=k(()=>{const s=new URL(y.value,document.location.href);return s.searchParams.set("format","csv"),s.toString()}),g=s=>Math.abs(s),T=q("$dataTable"),{navigate:R}=B(T);return F(u,()=>void j(R)),(s,i)=>(r(),o("div",w,[l("div",G,[l("div",K,[l("h2",Q,t(n(a)("Song Playback Timeline")),1),l("div",W,[l("a",{id:"btn-export",class:"btn btn-dark",href:P.value,target:"_blank"},[p(_,{icon:n(A)},null,8,["icon"]),l("span",null,t(n(a)("Download CSV")),1)],8,X)]),l("div",Y,[p(z,{modelValue:u.value,"onUpdate:modelValue":i[0]||(i[0]=e=>u.value=e),options:{enableTimePicker:!0,timezone:n(v)},class:"btn-dark"},null,8,["modelValue","options"])])])]),p($,{ref_key:"$dataTable",ref:T,paginated:"","select-fields":"",fields:U,"api-url":y.value},{"cell(delta)":f(e=>[l("span",Z,[e.item.delta_total>0?(r(),o("span",ee,[p(_,{icon:n(I)},null,8,["icon"]),m(" "+t(g(e.item.delta_total)),1)])):e.item.delta_total<0?(r(),o("span",te,[p(_,{icon:n(V)},null,8,["icon"]),m(" "+t(g(e.item.delta_total)),1)])):(r(),o(c,{key:2},[m(" 0 ")],64))])]),"cell(song)":f(e=>[l("div",{class:N({"text-muted":!e.item.is_visible})},[e.item.song.title?(r(),o(c,{key:0},[l("b",null,t(e.item.song.title),1),i[1]||(i[1]=l("br",null,null,-1)),m(" "+t(e.item.song.artist),1)],64)):(r(),o(c,{key:1},[m(t(e.item.song.text),1)],64))],2)]),"cell(source)":f(e=>[e.item.is_request?(r(),o(c,{key:0},[m(t(n(a)("Listener Request")),1)],64)):e.item.playlist?(r(),o(c,{key:1},[m(t(n(a)("Playlist:"))+" "+t(e.item.playlist),1)],64)):e.item.streamer?(r(),o(c,{key:2},[m(t(n(a)("Live Streamer:"))+" "+t(e.item.streamer),1)],64)):(r(),o(c,{key:3},[m(" Â  ")],64))]),_:1},8,["api-url"])]))}});export{he as default};
