import{l as re,d as q,U as Te,c as X,r as z,s as ne,i as B,b as _,e,t as u,u as t,g as n,H as Q,F as T,y as te,m as ae,O as he,J as Be,o as a,j as Y,w as U,z as ge,q as we,h as K,f as ve}from"./vue-Cts3TEHg.js";import{_ as De}from"./DataTable-GBWT48IS.js";import{D as Ee}from"./bootstrap.esm-BZy605kZ.js";import{l as I}from"./lodash-Bdl6ys83.js";import{_ as L,P as Ne,Q as Ae,R as qe,S as ce,T as He,I as Ve,U as ze}from"./icons-Be1GHOkw.js";import{f as de,u as se,d as le}from"./usePlayerStore-BlBABSf7.js";import{u as Le}from"./useDialog-M9x0VuxT.js";import{_ as Qe}from"./FlowUpload-BzBEHYe9.js";import{r as ue}from"./index-Hn1RL1dT.js";import{_ as W}from"./index-_C8mTG1e.js";import{u as xe,a as je}from"./useVuelidateOnForm-9fRwUaqh.js";import{u as me,_ as pe}from"./useHasModal-BY4NP-pH.js";import{I as Ce}from"./InvisibleSubmitButton-EsMx6l8t.js";import{a as Oe}from"./index-DP9oPqoW.js";import{_ as Ge}from"./FormGroupMultiCheck-DbWZJYF1.js";import{_ as Je}from"./ModalForm-BXS73Tm6.js";import{_ as $e,a as We}from"./Tabs-qkGGOLea.js";import{u as Ke}from"./useBaseEditModal-8faJWUkS.js";import{m as ke}from"./mergeExisting-DGzkK79d.js";import{_ as Xe}from"./Quota-DVuHIoJa.js";import{_ as Ye}from"./PlayButton-D_xZh6QL.js";import{f as Ze}from"./formatFileSize--9DaIXge.js";import{g as J}from"./router-BM8d8xiL.js";import{b as et,u as tt}from"./router-CIKHY1kb.js";import{u as st}from"./useStationDateTimeFormatter-BhT1ixPB.js";import"./FormMultiCheck-BRaoZhWq.js";import"./FormCheckbox-VeRpO6PO.js";import"./useOptionalStorage-BdJu5QYI.js";import"./lodash-BwctMegf.js";import"./useFormField-Cbkq4UJg.js";import"./FormGroup-LCbWR38E.js";import"./Loading-vp9RNwAY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useSlotsExcept-By0Eq2ad.js";import"./luxon-DgfqPo3b.js";import"./datetime-BTmRqpun.js";function Me(){const{notifySuccess:v,notifyError:m}=de();return{handleBatchResponse:(i,g,p)=>{if(i.success){const s=[];I.forEach(i.dirs,l=>{s.push(re("div",{},l))}),I.forEach(i.files,l=>{s.push(re("div",{},l))}),v(s,{title:g})}else{const s=[];I.forEach(i.errors,l=>{s.push(re("div",{},l))}),m(s,{title:p})}}}}const lt={id:"app-toolbar",class:"d-flex pt-4"},ot={class:"flex-fill buttons d-flex align-items-center"},it={class:"btn-group btn-group-sm dropdown allow-focus"},rt={class:"dropdown"},at=["disabled"],nt={class:"dropdown-menu",style:{"min-width":"300px"}},ct={class:"custom-control custom-checkbox"},dt=["id","value"],ut=["for"],mt={class:"form-group mt-3 mb-4"},pt={class:"input-group custom-control custom-checkbox"},ft={class:"input-group-text"},yt=["placeholder"],_t={class:"buttons"},bt={class:"btn btn-primary",type:"submit"},ht=["disabled"],vt=["disabled"],$t={class:"flex-shrink-0"},kt=q({__name:"MediaToolbar",props:{currentDirectory:{},selectedItems:{},playlists:{},batchUrl:{},supportsImmediateQueue:{type:Boolean}},emits:["relist","add-playlist","move-files","create-directory"],setup(v,{emit:m}){const $=v,i=m,g=Te($,"selectedItems"),p=X(()=>g.value.all.length>0),s=z([]),l=z("");ne(g,h=>{const w=I.map(h.all,D=>{var x,R;const H=((x=D.dir)==null?void 0:x.playlists)??((R=D.media)==null?void 0:R.playlists)??[];return I.map(H,"id")});s.value=I.intersection(...w)}),ne(l,h=>{h!==""&&(s.value.includes("new")||s.value.push("new"))});const{$gettext:f}=se(),{axios:c}=le(),{handleBatchResponse:C}=Me(),{notifyError:A}=de(),F=()=>{A(f("No files selected."))},P=(h,w,D)=>{p.value?c.put($.batchUrl,{do:h,current_directory:$.currentDirectory,files:g.value.files,dirs:g.value.directories}).then(({data:H})=>{C(H,w,D),i("relist")}):F()},{confirmDelete:M}=Le(),N=()=>{const h=g.value.all.length,w=f("Delete %{num} media files?",{num:String(h)});M({title:w,confirmButtonText:f("Delete")}).then(D=>{D.value&&P("delete",f("Files removed:"),f("Error removing files:"))})},y=B("$playlistDropdown"),b=()=>{y.value&&Ee.getInstance(y.value).hide(),p.value?c.put($.batchUrl,{do:"playlist",playlists:s.value,new_playlist_name:l.value,currentDirectory:$.currentDirectory,files:g.value.files,dirs:g.value.directories}).then(({data:h})=>{C(h,s.value.length>0?f("Playlists updated for selected files:"):f("Playlists cleared for selected files:"),f("Error updating playlists:")),h.success&&(h.record&&i("add-playlist",h.record),s.value=[],l.value=""),i("relist")}):F()},S=()=>{s.value=[],l.value="",b()},k=()=>{i("move-files")},E=()=>{i("create-directory")};return(h,w)=>(a(),_("div",lt,[e("div",ot,[e("span",null,u(t(f)("With selected:")),1),e("div",it,[e("div",rt,[e("button",{ref_key:"$playlistDropdown",ref:y,class:"btn btn-sm btn-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","data-bs-auto-close":"outside","aria-expanded":"false",disabled:!p.value},[n(L,{icon:t(Ne)},null,8,["icon"]),e("span",null,u(t(f)("Playlists")),1),w[4]||(w[4]=e("span",{class:"caret"},null,-1))],8,at),e("div",nt,[e("form",{class:"px-4 py-3",onSubmit:Q(b,["prevent"])},[(a(!0),_(T,null,te(h.playlists,D=>(a(),_("div",{key:D.id,class:"form-group"},[e("div",ct,[ae(e("input",{id:"chk_playlist_"+D.id,"onUpdate:modelValue":w[0]||(w[0]=H=>s.value=H),type:"checkbox",class:"custom-control-input",name:"playlists[]",value:D.id},null,8,dt),[[he,s.value]]),e("label",{class:"custom-control-label",for:"chk_playlist_"+D.id},u(D.name),9,ut)])]))),128)),w[6]||(w[6]=e("hr",{class:"dropdown-divider"},null,-1)),e("div",mt,[e("div",pt,[e("div",ft,[ae(e("input",{id:"chk_playlist_new","onUpdate:modelValue":w[1]||(w[1]=D=>s.value=D),type:"checkbox",class:"custom-control-input",value:"new"},null,512),[[he,s.value]]),w[5]||(w[5]=e("label",{class:"custom-control-label",for:"chk_playlist_new"},null,-1))]),ae(e("input",{id:"new_playlist_name","onUpdate:modelValue":w[2]||(w[2]=D=>l.value=D),type:"text",class:"form-control p-2",name:"new_playlist_name",style:{"min-width":"150px"},placeholder:t(f)("New Playlist")},null,8,yt),[[Be,l.value]])])]),e("div",_t,[e("button",bt,u(t(f)("Save")),1),e("button",{class:"btn btn-warning",type:"button",onClick:w[3]||(w[3]=D=>S())},u(t(f)("Clear")),1)])],32)])])]),e("button",{type:"button",class:"btn btn-sm btn-primary",disabled:!p.value,onClick:k},[n(L,{icon:t(Ae)},null,8,["icon"]),e("span",null,u(t(f)("Move")),1)],8,ht),e("button",{type:"button",class:"btn btn-sm btn-danger",disabled:!p.value,onClick:N},[n(L,{icon:t(qe)},null,8,["icon"]),e("span",null,u(t(f)("Delete")),1)],8,vt)]),e("div",$t,[e("button",{type:"button",class:"btn btn-sm btn-primary",onClick:E},[n(L,{icon:t(ce)},null,8,["icon"]),e("span",null,u(t(f)("New Folder")),1)])])]))}}),gt={"aria-label":"breadcrumb"},wt={class:"breadcrumb"},Dt={class:"breadcrumb-item"},xt=["onClick"],Ct=q({__name:"Breadcrumb",props:{currentDirectory:{}},emits:["change-directory"],setup(v,{emit:m}){const $=v,i=m,g=X(()=>{const s=[];if($.currentDirectory==="")return s;let l="";return $.currentDirectory.split("/").forEach(c=>{l===""?l+=c:l+="/"+c,s.push({dir:l,display:c})}),s}),p=s=>{i("change-directory",s)};return(s,l)=>(a(),_(T,null,[e("nav",gt,[e("ol",wt,[e("li",Dt,[e("a",{href:"#",onClick:l[0]||(l[0]=Q(f=>p(""),["prevent"]))},u(s.$gettext("Home")),1)]),(a(!0),_(T,null,te(g.value,f=>(a(),_("li",{key:f.dir,class:"breadcrumb-item"},[e("a",{href:"#",onClick:Q(c=>p(f.dir),["prevent"])},u(f.display),9,xt)]))),128))])]),l[1]||(l[1]=e("h3",{id:"breadcrumb",class:"card-subtitle mt-0 mb-2"},null,-1))],64))}}),Mt=q({__name:"FileUpload",props:{uploadUrl:{},currentDirectory:{},searchPhrase:{},validMimeTypes:{default:()=>["audio/*"]}},emits:["relist"],setup(v,{emit:m}){const $=v,i=m,g=X(()=>{const s=new URL($.uploadUrl,document.location.href);return s.searchParams.set("currentDirectory",$.currentDirectory),s.searchParams.set("searchPhrase",$.searchPhrase),s.toString()}),p=()=>{i("relist")};return(s,l)=>(a(),Y(Qe,{"target-url":g.value,"valid-mime-types":s.validMimeTypes,"allow-multiple":"",onComplete:p,onError:p},null,8,["target-url","valid-mime-types"]))}}),Ft=q({__name:"NewDirectoryModal",props:{currentDirectory:{},mkdirUrl:{}},emits:["relist"],setup(v,{expose:m,emit:$}){const i=v,g=$,{form:p,v$:s,resetForm:l,ifValid:f}=xe({newDirectory:{required:ue}},{newDirectory:null}),c=B("$modal"),{hide:C,show:A}=me(c),F=()=>{l()},P=B("$field"),M=()=>{we(()=>{var k;(k=P.value)==null||k.focus()})},{notifySuccess:N}=de(),{axios:y}=le(),{$gettext:b}=se(),S=()=>{f(()=>{y.post(i.mkdirUrl,{currentDirectory:i.currentDirectory,name:p.value.newDirectory}).then(()=>{N(b("New directory created."))}).finally(()=>{g("relist"),C()})})};return m({open:A}),(k,E)=>(a(),Y(pe,{id:"create_directory",ref_key:"$modal",ref:c,centered:"",title:t(b)("New Directory"),onHidden:F,onShown:M},{"modal-footer":U(()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:E[0]||(E[0]=(...h)=>t(C)&&t(C)(...h))},u(t(b)("Close")),1),e("button",{type:"button",class:ge(["btn",t(s).$invalid?"btn-danger":"btn-primary"]),onClick:S},u(t(b)("Create Directory")),3)]),default:U(()=>[e("form",{onSubmit:Q(S,["prevent"])},[n(W,{id:"new_directory_name",ref_key:"$field",ref:P,field:t(s).newDirectory,label:t(b)("Directory Name")},null,8,["field","label"]),n(Ce)],32)]),_:1},8,["title"]))}}),St={class:"d-flex flex-column flex-md-row mb-3 align-items-center"},Ut={class:"flex-shrink m-2 m-md-0 me-md-3"},It=["disabled"],Pt={class:"flex-fill m-2 m-md-0 text-end"},Rt={class:"m-0"},Tt={class:"row"},Bt={class:"col-md-12"},Et={class:"is_dir d-flex align-items-center"},Nt={class:"file-icon me-2"},At=["onClick"],qt=["disabled"],Ht=q({__name:"MoveFilesModal",props:{selectedItems:{},currentDirectory:{},batchUrl:{},listDirectoriesUrl:{}},emits:["relist"],setup(v,{expose:m,emit:$}){const i=v,g=$,p=z(""),s=z([]),{$gettext:l}=se(),f=[{key:"name",label:l("Directory"),sortable:!0}],c=X(()=>l("Move %{num} File(s) to",{num:String(i.selectedItems.all.length)})),C=B("$modal"),{show:A,hide:F}=me(C),P=()=>{s.value=[],p.value=""},{axios:M}=le(),{handleBatchResponse:N}=Me(),{state:y,execute:b,isLoading:S}=Oe(()=>M.get(i.listDirectoriesUrl,{params:{currentDirectory:p.value}}).then(x=>x.data.rows),[],{immediate:!1}),k=()=>{M.put(i.batchUrl,{do:"move",currentDirectory:i.currentDirectory,directory:p.value,files:i.selectedItems.files,dirs:i.selectedItems.directories}).then(({data:x})=>{N(x,l("Files moved:"),l("Error moving files:"))}).finally(()=>{F(),g("relist")})},E=B("$dataTable"),h=()=>{b().finally(()=>{var x;(x=E.value)==null||x.refresh()})},w=x=>{s.value.push(x),p.value=x,h()},D=()=>{s.value.pop();let x=s.value.slice(-1)[0];(typeof x>"u"||x===null)&&(x=""),p.value=x,h()};return m({open:()=>{b(),A()}}),(x,R)=>(a(),Y(pe,{id:"move_file",ref_key:"$modal",ref:C,size:"xl",centered:"",title:c.value,onHidden:R[2]||(R[2]=j=>P())},{"modal-footer":U(()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:R[1]||(R[1]=(...j)=>t(F)&&t(F)(...j))},u(t(l)("Close")),1),e("button",{type:"button",class:"btn btn-primary",disabled:i.selectedItems.all.length===0,onClick:k},u(t(l)("Move to Directory")),9,qt)]),default:U(()=>[e("div",St,[e("div",Ut,[e("button",{type:"button",class:"btn btn-sm btn-primary",disabled:s.value.length===0,onClick:D},[n(L,{icon:t(He)},null,8,["icon"]),e("span",null,u(t(l)("Back")),1)],8,It)]),e("div",Pt,[e("h5",Rt,[e("small",null,u(t(l)("Selected directory:")),1),R[3]||(R[3]=e("br",null,null,-1)),p.value?(a(),_(T,{key:0},[K(u(p.value),1)],64)):(a(),_(T,{key:1},[K(u(t(l)("Base Directory")),1)],64))])])]),e("div",Tt,[e("div",Bt,[n(De,{id:"station_media",ref_key:"$dataTable",ref:E,"show-toolbar":"",paginated:"",fields:f,items:t(y),loading:t(S),"handle-client-side":"",onRefreshClicked:R[0]||(R[0]=j=>t(b)())},{"cell(name)":U(({item:j})=>[e("div",Et,[e("span",Nt,[n(L,{icon:t(ce)},null,8,["icon"])]),e("a",{href:"#",onClick:Q(oe=>w(j.path),["prevent"])},u(j.name),9,At)])]),_:1},8,["items","loading"])])])]),_:1},8,["title"]))}}),Vt=q({__name:"RenameModal",props:{renameUrl:{}},emits:["relist"],setup(v,{expose:m,emit:$}){const i=v,g=$,p=z(null),{form:s,v$:l,resetForm:f,ifValid:c}=xe({newPath:{required:ue}},{newPath:null}),C=B("$modal"),{show:A,hide:F}=me(C),P=k=>{p.value=k,s.value.newPath=k,A()},M=B("$field"),N=()=>{we(()=>{var k;(k=M.value)==null||k.focus()})},y=()=>{f(),p.value=null},{axios:b}=le(),S=()=>{c(()=>{b.put(i.renameUrl,{file:p.value,...s.value}).finally(()=>{F(),g("relist")})})};return m({open:P}),(k,E)=>(a(),Y(pe,{id:"rename_file",ref_key:"$modal",ref:C,centered:"",title:k.$gettext("Rename File/Directory"),onShown:N,onHidden:y},{"modal-footer":U(()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:E[0]||(E[0]=(...h)=>t(F)&&t(F)(...h))},u(k.$gettext("Close")),1),e("button",{type:"button",class:ge(["btn",t(l).$invalid?"btn-danger":"btn-primary"]),onClick:S},u(k.$gettext("Rename")),3)]),default:U(()=>[e("form",{onSubmit:Q(S,["prevent"])},[n(W,{id:"new_directory_name",ref_key:"$field",ref:M,field:t(l).newPath,label:k.$gettext("New File Name")},null,8,["field","label"]),n(Ce)],32)]),_:1},8,["title"]))}}),zt={class:"row g-3"},Lt=q({__name:"BasicInfo",props:{form:{}},setup(v){return(m,$)=>(a(),_("div",zt,[n(W,{id:"edit_form_path",class:"col-md-6",field:m.form.path,label:m.$gettext("File Name"),description:m.$gettext("The relative path of the file in the station's media directory.")},null,8,["field","label","description"]),n(W,{id:"edit_form_title",class:"col-md-6",field:m.form.title,label:m.$gettext("Song Title")},null,8,["field","label"]),n(W,{id:"edit_form_artist",class:"col-md-6",field:m.form.artist,label:m.$gettext("Song Artist")},null,8,["field","label"]),n(W,{id:"edit_form_genre",class:"col-md-6",field:m.form.genre,label:m.$gettext("Song Genre")},null,8,["field","label"]),n(W,{id:"edit_form_album",class:"col-md-6",field:m.form.album,label:m.$gettext("Song Album")},null,8,["field","label"])]))}}),Qt={class:"row"},jt=q({__name:"Playlists",props:{form:{},playlists:{}},setup(v){const m=v,$=X(()=>I.map(m.playlists,function(i){return{text:i.name,value:i.id}}));return(i,g)=>(a(),_("div",Qt,[n(Ge,{id:"edit_form_playlists",class:"col-md-12",field:i.form.playlists,options:$.value,stacked:"",label:i.$gettext("Playlists")},null,8,["field","options","label"])]))}}),Ot=q({__name:"EditModal",props:{customFields:{},playlists:{},createUrl:{}},emits:["relist"],setup(v,{expose:m,emit:$}){const i=v,g=$,{record:p,reset:s}=je({length:null,length_text:null,links:{art:null,waveform:null,waveform_cache:null,play:null}}),l=B("$modal"),{loading:f,error:c,v$:C,clearContents:A,edit:F,doSubmit:P}=Ke(i,g,l,()=>{const y={path:{required:ue},title:{},artist:{},album:{},genre:{},lyrics:{},isrc:{},art:{},custom_fields:{},extra_metadata:{amplify:{},cross_start_next:{},fade_in:{},fade_out:{},cue_in:{},cue_out:{}},playlists:{}};return I.forEach(i.customFields.slice(),b=>{b.short_name&&(y.custom_fields[b.short_name]={})}),y},()=>{const y={path:null,title:null,artist:null,album:null,genre:null,lyrics:null,isrc:null,custom_fields:{},extra_metadata:{amplify:null,cross_start_next:null,fade_in:null,fade_out:null,cue_in:null,cue_out:null},playlists:[]};return I.forEach(i.customFields.slice(),b=>{b.short_name&&(y.custom_fields[b.short_name]=null)}),y},{resetForm:y=>{y(),s()},populateForm:(y,b)=>{p.value=ke(p.value,y);const S=ke(b.value,y);S.playlists=I.map(y.playlists,"id"),S.custom_fields={},I.forEach(i.customFields.slice(),k=>{S.custom_fields[k.short_name]=I.defaultTo(y.custom_fields[k.short_name],null)}),b.value=S}}),M=y=>{F(y)},N=()=>{A()};return m({open:M}),(y,b)=>(a(),Y(Je,{ref_key:"$modal",ref:l,loading:t(f),title:y.$gettext("Edit Media"),error:t(c),"disable-save-button":t(C).$invalid,onSubmit:t(P),onHidden:N},{default:U(()=>[n(We,{"destroy-on-hide":""},{default:U(()=>[n($e,{label:y.$gettext("Basic Information")},{default:U(()=>[n(Lt,{form:t(C)},null,8,["form"])]),_:1},8,["label"]),n($e,{label:y.$gettext("Playlists")},{default:U(()=>[n(jt,{form:t(C),playlists:y.playlists},null,8,["form","playlists"])]),_:1},8,["label"])]),_:1})]),_:1},8,["loading","title","error","disable-save-button","onSubmit"]))}});var O=(v=>(v.Directory="directory",v.Media="media",v.CoverArt="cover_art",v.UnprocessableFile="unprocessable_file",v.Other="other",v))(O||{});const Gt={class:"card",role:"region","aria-labelledby":"hdr_music_files"},Jt={class:"card-header text-bg-primary"},Wt={class:"row align-items-center"},Kt={class:"col-md-7"},Xt={id:"hdr_music_files",class:"card-title"},Yt={class:"col-md-5 text-end"},Zt={class:"card-body"},es={class:"d-flex align-items-center"},ts={class:"flex-shrink-0 pe-2"},ss={key:0,class:"file-icon"},ls={key:1,class:"file-icon"},os={key:2,class:"file-icon"},is={class:"flex-fill"},rs=["title","onClick"],as=["href","title"],ns=["href","title"],cs={key:3},ds={key:4},us=["title","onClick"],ms={key:0},ps=["title","onClick"],fs={key:0},ys=["onClick"],_s=["onClick"],Zs=q({__name:"Media",props:{initialPlaylists:{default:()=>[]},customFields:{default:()=>[]},validMimeTypes:{default:()=>[]},showSftp:{type:Boolean,default:!0},supportsImmediateQueue:{type:Boolean,default:!0}},setup(v){const m=v,$=J("/files/list"),i=J("/files/batch"),g=J("/files/upload"),p=J("/files/directories"),s=J("/files/mkdir"),l=J("/files/rename"),f=J("/quota/station_media"),{$gettext:c}=se(),{formatTimestampAsDateTime:C}=st(),A=X(()=>{const o=[{key:"path",isRowHeader:!0,label:c("Name"),sortable:!0,sortFn:(d,r)=>d.path.localeCompare(r.path,void 0,{numeric:!0})},{key:"media.title",label:c("Title"),sortable:!0,selectable:!0,visible:!0},{key:"media.artist",label:c("Artist"),sortable:!0,selectable:!0,visible:!1},{key:"media.album",label:c("Album"),sortable:!0,selectable:!0,visible:!1},{key:"media.genre",label:c("Genre"),sortable:!0,selectable:!0,visible:!1},{key:"media.length",label:c("Length"),sortable:!0,selectable:!0,visible:!0}];return I.forEach({...m.customFields},d=>{o.push({key:"media.custom_fields["+d.short_name+"]",label:d.name,sortable:!0,selectable:!0,visible:!1})}),o.push({key:"size",label:c("Size"),sortable:!0,selectable:!0,visible:!0},{key:"timestamp",label:c("Modified"),sortable:!0,formatter:d=>C(d),selectable:!0,visible:!1},{key:"media.uploaded_at",label:c("Uploaded Time"),sortable:!0,formatter:d=>C(d),selectable:!0,visible:!1},{key:"playlists",label:c("Playlists"),sortable:!1,selectable:!0,visible:!0},{key:"commands",label:c("Actions"),sortable:!1,class:"shrink"}),o}),F=z(m.initialPlaylists),P=z({all:[],files:[],directories:[]}),M=z(""),N=z(""),y=o=>{const d=I.partition(o,r=>r.type===O.Directory);P.value={all:o,files:I.map(d[1],"path"),directories:I.map(d[0],"path")}},b=B("$dataTable"),S=()=>{var o;(o=b.value)==null||o.navigate()},k=o=>{var d;(d=b.value)==null||d.setFilter(o)},E=B("$quota"),h=()=>{var o,d;(o=E.value)==null||o.update(),(d=b.value)==null||d.relist()},w=o=>{F.value.push(o)},D=o=>{N.value=o},H=B("$renameModal"),x=o=>{var d;(d=H.value)==null||d.open(o)},R=B("$editModal"),j=o=>{var d;(d=R.value)==null||d.open(o)},oe=B("$newDirectoryModal"),Fe=()=>{var o;(o=oe.value)==null||o.open()},fe=B("$moveFilesModal"),Se=()=>{var o;(o=fe.value)==null||o.open()},Ue=o=>(o.params.currentDirectory=M.value,o),Ie=o=>o.substring(0,9)==="playlist:"||o.substring(0,8)==="special:",ye=et(),Pe=tt(),_e=o=>{ye.push({name:"stations:files:index",params:{path:o}})};return ne(()=>Pe.params,async o=>{let d=o.path??"";Array.isArray(d)&&(d=d.join("")),Ie(d)?(await ye.push({name:"stations:files:index"}),k(d)):(M.value=d,S())},{immediate:!0}),(o,d)=>(a(),_(T,null,[e("section",Gt,[e("div",Jt,[e("div",Wt,[e("div",Kt,[e("h2",Xt,u(t(c)("Music Files")),1)]),e("div",Yt,[n(Xe,{ref_key:"$quota",ref:E,"quota-url":t(f)},null,8,["quota-url"])])])]),e("div",Zt,[n(Ct,{"current-directory":M.value,onChangeDirectory:_e},null,8,["current-directory"]),n(Mt,{"upload-url":t(g),"search-phrase":N.value,"valid-mime-types":o.validMimeTypes,"current-directory":M.value,onRelist:h},null,8,["upload-url","search-phrase","valid-mime-types","current-directory"]),n(kt,{"batch-url":t(i),"selected-items":P.value,"current-directory":M.value,"supports-immediate-queue":o.supportsImmediateQueue,playlists:F.value,onAddPlaylist:w,onRelist:h,onCreateDirectory:Fe,onMoveFiles:Se},null,8,["batch-url","selected-items","current-directory","supports-immediate-queue","playlists"])]),n(De,{id:"station_media",ref_key:"$dataTable",ref:b,selectable:"",paginated:"","select-fields":"",fields:A.value,"api-url":t($),"request-config":Ue,onRowSelected:y,onFiltered:D},{"cell(path)":U(({item:r})=>[e("div",es,[e("div",ts,[r.type===t(O).Media?(a(),Y(Ye,{key:0,url:r.media.links.play,class:"btn-lg"},null,8,["url"])):(a(),_(T,{key:1},[r.type===t(O).Directory?(a(),_("span",ss,[n(L,{icon:t(ce)},null,8,["icon"])])):r.type===t(O).CoverArt?(a(),_("span",ls,[n(L,{icon:t(Ve)},null,8,["icon"])])):(a(),_("span",os,[n(L,{icon:t(ze)},null,8,["icon"])]))],64))]),e("div",is,[r.type===t(O).Directory?(a(),_("a",{key:0,class:"name",href:"#",title:r.text,onClick:Q(V=>_e(r.path),["prevent"])},u(r.path_short),9,rs)):r.type===t(O).Media?(a(),_("a",{key:1,class:"name",href:r.media.links.play,target:"_blank",title:r.text},u(r.text),9,as)):(a(),_("a",{key:2,class:"name",href:r.links.download,target:"_blank",title:r.text},u(r.path_short),9,ns)),d[0]||(d[0]=e("br",null,null,-1)),r.type===t(O).Media?(a(),_("small",cs,u(r.path_short),1)):(a(),_("small",ds,u(r.text),1))])])]),"cell(media.length)":U(({item:r})=>{var V;return[K(u((V=r.media)==null?void 0:V.length_text),1)]}),"cell(size)":U(({item:r})=>[r.size?(a(),_(T,{key:1},[K(u(t(Ze)(r.size)),1)],64)):(a(),_(T,{key:0},[K("   ")],64))]),"cell(playlists)":U(({item:r})=>{var V,Z,ee,be;return[((Z=(V=r.media)==null?void 0:V.playlists)==null?void 0:Z.length)>0?(a(!0),_(T,{key:0},te(r.media.playlists,(G,ie)=>(a(),_(T,{key:G.id},[e("a",{class:"btn-search",href:"#",title:t(c)("View tracks in playlist"),onClick:Q(Re=>k("playlist:"+G.short_name),["prevent"])},u(G.name),9,us),ie+1<r.media.playlists.length?(a(),_("span",ms,", ")):ve("",!0)],64))),128)):((be=(ee=r.dir)==null?void 0:ee.playlists)==null?void 0:be.length)>0?(a(!0),_(T,{key:1},te(r.dir.playlists,(G,ie)=>(a(),_(T,{key:G.id},[e("a",{class:"btn-search",href:"#",title:t(c)("View tracks in playlist"),onClick:Q(Re=>k("playlist:"+G.short_name),["prevent"])},u(G.name),9,ps),ie+1<r.dir.playlists.length?(a(),_("span",fs,", ")):ve("",!0)],64))),128)):(a(),_(T,{key:2},[K("   ")],64))]}),"cell(commands)":U(({item:r})=>{var V,Z;return[(Z=(V=r.media)==null?void 0:V.links)!=null&&Z.self?(a(),_("button",{key:0,type:"button",class:"btn btn-sm btn-primary",onClick:ee=>j(r.media.links.self)},u(t(c)("Edit")),9,ys)):(a(),_("button",{key:1,type:"button",class:"btn btn-sm btn-primary",onClick:ee=>x(r.path)},u(t(c)("Rename")),9,_s))]}),_:1},8,["fields","api-url"])]),n(Ft,{ref_key:"$newDirectoryModal",ref:oe,"current-directory":M.value,"mkdir-url":t(s),onRelist:h},null,8,["current-directory","mkdir-url"]),n(Ht,{ref_key:"$moveFilesModal",ref:fe,"selected-items":P.value,"current-directory":M.value,"batch-url":t(i),"list-directories-url":t(p),onRelist:h},null,8,["selected-items","current-directory","batch-url","list-directories-url"]),n(Vt,{ref_key:"$renameModal",ref:H,"rename-url":t(l),onRelist:h},null,8,["rename-url"]),n(Ot,{ref_key:"$editModal",ref:R,"custom-fields":o.customFields,playlists:F.value,onRelist:h},null,8,["custom-fields","playlists"])],64))}});export{Zs as default};
