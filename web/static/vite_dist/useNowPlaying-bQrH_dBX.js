import{g as P}from"./index-H7w3-DKz.js";import{a as d}from"./router-DV66O1Vz.js";import{r as x,d as E,c as U}from"./usePlayerStore-iWc_R0_O.js";import{f as S}from"./formatTime-DvDPwXf4.js";import{N as C,r as p,s as M,p as w,c as y}from"./vue-Cts3TEHg.js";const q={station:{id:1,name:"Station Name",shortcode:"station_name",description:"Station Description.",frontend:"icecast",backend:"liquidsoap",listen_url:"",url:"",playlist_pls_url:"",playlist_m3u_url:"",is_public:!0,mounts:[],remotes:[]},listeners:{current:0,unique:0,total:0},live:{is_live:!1,streamer_name:"",broadcast_start:null},now_playing:{elapsed:0,remaining:0,sh_id:0,played_at:0,duration:0,playlist:"default",streamer:"",is_request:!1,song:{id:"",text:"",artist:"",title:"",album:"",genre:"",lyrics:"",art:"",custom_fields:[]}},playing_next:{cued_at:0,duration:0,playlist:"default",is_request:!1,song:{id:"",text:"",artist:"",title:"",album:"",genre:"",lyrics:"",art:"",custom_fields:[]}},song_history:[]};function B(b){const m=x(()=>({useStatic:!1,useSse:!1,...b})),f=C(q),h=p(0),u=p(Math.floor(Date.now()/1e3)),s=p(0),c=p(0),v=e=>{var a,i,n;if(e.now_playing){if(f.value=e,h.value=Date.now(),s.value=e.now_playing.duration??0,"mediaSession"in navigator){navigator.mediaSession.metadata=new MediaMetadata({title:((a=e.now_playing.song)==null?void 0:a.title)??void 0,artist:((i=e.now_playing.song)==null?void 0:i.artist)??void 0,artwork:[{src:((n=e.now_playing.song)==null?void 0:n.art)??void 0}]});const l=(o,t)=>{t<=o&&navigator.mediaSession.setPositionState({duration:o,position:t})};l(e.now_playing.duration??0,e.now_playing.elapsed??0),navigator.mediaSession.setActionHandler("seekto",()=>{e.now_playing&&l(e.now_playing.duration??0,e.now_playing.elapsed??0)})}document.dispatchEvent(new CustomEvent("now-playing",{detail:e}))}};if(m.useSse){const e=d("/live/nowplaying/sse"),a=new URLSearchParams({cf_connect:JSON.stringify({subs:{[`station:${m.stationShortName}`]:{recover:!0}}})}),i=e.value+"?"+a.toString(),n=(o,t=!0)=>{const r=o.data;t&&r.current_time&&(u.value=r.current_time),h.value===0?v(r.np):setTimeout(()=>{v(r.np)},3e3)},{data:l}=P(i);M(l,o=>{if(!o)return;const t=JSON.parse(o);if("connect"in t){const r=t.connect;"time"in r&&(u.value=Math.floor(r.time/1e3));for(const k in r.subs){const g=r.subs[k];"publications"in g&&g.publications.length>0&&g.publications.forEach(D=>n(D,!1))}}else"pub"in t&&n(t.pub)})}else{const e=m.useStatic?d(`/nowplaying_static/${m.stationShortName}.json`):d(`/nowplaying/${m.stationShortName}`),a=d("/time"),{axiosSilent:i}=E(),n={headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}},l=()=>{i.get(e.value,n).then(t=>{v(t.data),setTimeout(l,document.hidden?3e4:15e3)}).catch(()=>{setTimeout(l,document.hidden?12e4:3e4)})},o=()=>{i.get(a.value,n).then(t=>{u.value=t.data.timestamp}).finally(()=>{setTimeout(o,document.hidden?6e5:3e5)})};w(()=>{o(),l()})}w(()=>{U(()=>{var i,n;const e=((n=(i=f.value)==null?void 0:i.now_playing)==null?void 0:n.played_at)??0;let a=u.value-e;a<0?a=0:a>=s.value&&(a=s.value),c.value=a,u.value=u.value+1},1e3)});const T=y(()=>s.value?c.value>s.value?100:c.value/s.value*100:0),_=y(()=>s.value?S(s.value):null),N=y(()=>s.value?c.value<=s.value?S(c.value):_.value:null);return{np:f,currentTime:u,currentTrackDuration:s,currentTrackElapsed:c,currentTrackPercent:T,currentTrackDurationDisplay:_,currentTrackElapsedDisplay:N}}export{q as n,B as u};
