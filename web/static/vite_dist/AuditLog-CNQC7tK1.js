import{u as A,a as I}from"./usePlayerStore-B-xb-_xl.js";import{_ as w}from"./DataTable-DGOprwq7.js";import{_ as V}from"./DateRangeDropdown-CNuQnd4R.js";import{_ as h,ao as L,ap as M,aq as N}from"./icons-BVVFRq1s.js";import{u as R}from"./useHasDatatable-DPFcIMM0.js";import{_ as H,u as O}from"./useHasModal-DsCiwLlO.js";import{d as D,j as y,r as T,h as B,o,w as f,e,t as l,b as r,F as g,y as J,c as z,s as E,g as p,f as F,u as n,i as k,q as P}from"./vue-DTJ-1uEH.js";import{_ as q}from"./CardPage-D-r1d3Gj.js";import{u as j}from"./luxon-DKiUQxiR.js";import{a as G}from"./router-CcCQPAao.js";import"./bootstrap.esm-BZy605kZ.js";import"./lodash-BwctMegf.js";import"./lodash-Bdl6ys83.js";import"./FormMultiCheck-CTsnYoEJ.js";import"./FormCheckbox-AsanX38Q.js";import"./useOptionalStorage-DbEMDEit.js";import"./index-n3LP3PHk.js";import"./PanelLayout-CLnqzVgj.js";import"./Loading-CxLO-rjm.js";import"./InfoCard-Db4untlq.js";import"./datetime-BTmRqpun.js";const K={class:"table table-bordered table-responsive"},Q={class:"changes"},W={class:"changes"},X=D({__name:"DetailsModal",setup(C,{expose:b}){const i=y("$modal"),{show:c}=O(i),t=T(null);return b({open:d=>{t.value=d,c()}}),(d,_)=>(o(),B(H,{id:"audit_log_details",ref_key:"$modal",ref:i,title:d.$gettext("Changes"),size:"xl"},{default:f(()=>[e("table",K,[_[0]||(_[0]=e("colgroup",null,[e("col",{width:"30%"}),e("col",{width:"35%"}),e("col",{width:"35%"})],-1)),e("thead",null,[e("tr",null,[e("th",null,l(d.$gettext("Field Name")),1),e("th",null,l(d.$gettext("Previous")),1),e("th",null,l(d.$gettext("Updated")),1)])]),e("tbody",null,[(o(!0),r(g,null,J(t.value,m=>(o(),r("tr",{key:m.field},[e("td",null,l(m.field),1),e("td",null,[e("pre",Q,l(m.from),1)]),e("td",null,[e("pre",W,l(m.to),1)])]))),128))])])]),_:1},8,["title"]))}}),Y={class:"d-flex align-items-center"},Z=["id"],ee={class:"flex-shrink"},te=["title"],ae=["title"],le=["title"],se=["onClick"],Ce=D({__name:"AuditLog",setup(C){const b=G("/admin/auditlog"),{DateTime:i}=j(),c=T({startDate:i.now().minus({days:13}).toJSDate(),endDate:i.now().toJSDate()}),{$gettext:t}=A(),{timeConfig:$}=I(),d=[{key:"timestamp",label:t("Date/Time"),sortable:!1,formatter:u=>i.fromISO(u).toLocaleString({...i.DATETIME_SHORT,...$})},{key:"user",label:t("User"),sortable:!1},{key:"operation",isRowHeader:!0,label:t("Operation"),sortable:!1},{key:"identifier",label:t("Identifier"),sortable:!1},{key:"target",label:t("Target"),sortable:!1},{key:"actions",label:t("Actions"),sortable:!1}],_=z(()=>{const u=new URL(b.value,document.location.href),s=u.searchParams;return s.set("start",i.fromJSDate(c.value.startDate).toISO()),s.set("end",i.fromJSDate(c.value.endDate).toISO()),u.toString()}),m=y("$dataTable"),{navigate:S}=R(m);E(c,()=>{P(()=>{S()})});const x=y("$detailsModal"),U=u=>{var s;(s=x.value)==null||s.open(u)};return(u,s)=>(o(),r(g,null,[p(q,{"header-id":"hdr_audit_log"},{header:f(({id:a})=>[e("div",Y,[e("h2",{id:a,class:"card-title flex-fill my-0"},l(n(t)("Audit Log")),9,Z),e("div",ee,[p(V,{modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=v=>c.value=v),class:"btn-dark"},null,8,["modelValue"])])])]),default:f(()=>[p(w,{ref_key:"$dataTable",ref:m,paginated:"",fields:d,"api-url":_.value},{"cell(operation)":f(a=>[a.item.operation_text==="insert"?(o(),r("span",{key:0,class:"text-success",title:n(t)("Insert")},[p(h,{class:"lg inline",icon:n(L)},null,8,["icon"])],8,te)):a.item.operation_text==="delete"?(o(),r("span",{key:1,class:"text-danger",title:n(t)("Delete")},[p(h,{class:"lg inline",icon:n(M)},null,8,["icon"])],8,ae)):(o(),r("span",{key:2,class:"text-primary",title:n(t)("Update")},[p(h,{class:"lg inline",icon:n(N)},null,8,["icon"])],8,le))]),"cell(identifier)":f(a=>[e("small",null,l(a.item.class),1),s[1]||(s[1]=e("br",null,null,-1)),k(" "+l(a.item.identifier),1)]),"cell(target)":f(a=>[a.item.target?(o(),r(g,{key:0},[e("small",null,l(a.item.target_class),1),s[2]||(s[2]=e("br",null,null,-1)),k(" "+l(a.item.target),1)],64)):(o(),r(g,{key:1},[k(l(n(t)("N/A")),1)],64))]),"cell(actions)":f(a=>[a.item.changes.length>0?(o(),r("button",{key:0,type:"button",class:"btn btn-sm btn-primary",onClick:v=>U(a.item.changes)},l(n(t)("Changes")),9,se)):F("",!0)]),_:1},8,["api-url"])]),_:1}),p(X,{ref_key:"$detailsModal",ref:x},null,512)],64))}});export{Ce as default};
