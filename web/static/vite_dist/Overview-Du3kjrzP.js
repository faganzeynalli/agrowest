import{_ as le}from"./DateRangeDropdown-CV2VaEUZ.js";import{d as T,j as J,b as v,o as r,D as V,h as $,f as x,U as O,r as G,c as Q,y as B,F as R,e,g as o,m as K,ae as j,t as s,u as l,w as c,s as P,i as h}from"./vue-B-dHMJBO.js";import{u as Y,a as Z,_ as se}from"./TimeSeriesChart-C-l5Q-jM.js";import{u as M,d as W,b as ne}from"./usePlayerStore-BJXDzq-w.js";import{a as F,h as z}from"./index-Cwv7sFxi.js";import{_ as H}from"./Loading-B4WK-6A0.js";import{u as q}from"./luxon-Cw61P3gq.js";import{_ as X,a8 as oe,a7 as re}from"./icons-Yf7pfv1X.js";import{_ as ee}from"./DataTable-D872TXoQ.js";import{f as ie}from"./formatTime-DvDPwXf4.js";import{u as te}from"./useHasDatatable-DPFcIMM0.js";import{g as D}from"./router-wzMi1FLb.js";import{a as de,_ as C}from"./Tab-BUAj4Txt.js";import{u as ue}from"./useStationDateTimeFormatter-nKrxjiBK.js";import"./PanelLayout-BXXqPnEo.js";import"./useOptionalStorage-CjmLv0hJ.js";import"./lodash-Bdl6ys83.js";import"./lodash-BwctMegf.js";import"./datetime-BTmRqpun.js";import"./bootstrap.esm-BZy605kZ.js";import"./FormMultiCheck-C8kU6V99.js";import"./FormCheckbox-CBrIHDuX.js";const ce=T({__name:"HourChart",props:{options:{},data:{},aspectRatio:{},alt:{},labels:{}},setup(b){const t=b,n=J("$canvas"),{$gettext:y}=M();return Y(t,n,{type:"bar",options:{scales:{x:{title:{display:!0,text:y("Hour")}},y:{title:{display:!0,text:y("Listeners")},min:0}}}}),(p,g)=>(r(),v("canvas",{ref_key:"$canvas",ref:n},[V(p.$slots,"default",{},()=>[p.alt.length>0?(r(),$(Z,{key:0,alt:p.alt},null,8,["alt"])):x("",!0)])],512))}}),I=T({__name:"PieChart",props:{options:{},data:{},aspectRatio:{},alt:{},labels:{}},setup(b){const t=b,n=J("$canvas");return Y(t,n,{type:"pie"}),(y,p)=>(r(),v("canvas",{ref_key:"$canvas",ref:n},[V(y.$slots,"default",{},()=>[y.alt.length>0?(r(),$(Z,{key:0,alt:y.alt},null,8,["alt"])):x("",!0)])],512))}}),pe={class:"buttons mb-3"},me={class:"btn btn-sm btn-outline-secondary",for:"result-type-average"},be={class:"btn btn-sm btn-outline-secondary",for:"result-type-unique"},ge={class:"row"},_e={class:"col-md-6 mb-4"},ye={class:"col-md-6 mb-4"},fe={class:"col-md-12 mb-4"},ve={class:"buttons mb-3"},$e=["id","value"],he=["for"],Te=T({__name:"ListenersByTimePeriodTab",props:{dateRange:{},apiUrl:{}},setup(b){const t=b,n=O(t,"dateRange"),{axios:y}=W(),{DateTime:p}=q(),g=G("average"),m={labels:[],metrics:[],alt:[]},{state:i,isLoading:k,execute:u}=F(()=>y.get(t.apiUrl,{params:{type:g.value,start:p.fromJSDate(n.value.startDate).toISO(),end:p.fromJSDate(n.value.endDate).toISO()}}).then(S=>S.data),{daily:{...m},day_of_week:{...m},hourly:{all:{...m},day0:{...m},day1:{...m},day2:{...m},day3:{...m},day4:{...m},day5:{...m},day6:{...m}}},{shallow:!0}),d=G("all"),{$gettext:a}=M(),_=Q(()=>({all:a("All Days"),day0:a("Monday"),day1:a("Tuesday"),day2:a("Wednesday"),day3:a("Thursday"),day4:a("Friday"),day5:a("Saturday"),day6:a("Sunday")})),f=Q(()=>{var S;return(S=i.value)==null?void 0:S.hourly[d.value]}),w=z();return B(n,()=>{w.value&&u()}),B(g,()=>{w.value&&u()}),(S,U)=>(r(),v(R,null,[e("div",pe,[K(e("input",{id:"result-type-average","onUpdate:modelValue":U[0]||(U[0]=L=>g.value=L),type:"radio",class:"btn-check",autocomplete:"off",value:"average"},null,512),[[j,g.value]]),e("label",me,s(l(a)("Average Listeners")),1),K(e("input",{id:"result-type-unique","onUpdate:modelValue":U[1]||(U[1]=L=>g.value=L),type:"radio",class:"btn-check",autocomplete:"off",value:"unique"},null,512),[[j,g.value]]),e("label",be,s(l(a)("Unique Listeners")),1)]),o(H,{loading:l(k),lazy:""},{default:c(()=>[e("div",ge,[e("div",_e,[e("fieldset",null,[e("legend",null,s(l(a)("Listeners by Day")),1),o(se,{style:{width:"100%"},data:l(i).daily.metrics,alt:l(i).daily.alt},null,8,["data","alt"])])]),e("div",ye,[e("fieldset",null,[e("legend",null,s(l(a)("Listeners by Day of Week")),1),o(I,{style:{width:"100%"},data:l(i).day_of_week.metrics,labels:l(i).day_of_week.labels,alt:l(i).day_of_week.alt},null,8,["data","labels","alt"])])]),e("div",fe,[e("fieldset",null,[e("legend",null,s(l(a)("Listeners by Hour")),1),e("div",ve,[(r(!0),v(R,null,P(_.value,(L,A)=>(r(),v(R,{key:A},[K(e("input",{id:`charts-hour-${A}`,"onUpdate:modelValue":U[2]||(U[2]=ae=>d.value=ae),type:"radio",class:"btn-check",autocomplete:"off",value:A},null,8,$e),[[j,d.value]]),e("label",{class:"btn btn-sm btn-outline-secondary",for:`charts-hour-${A}`},s(L),9,he)],64))),128))]),o(ce,{style:{width:"100%"},data:f.value.metrics,labels:f.value.labels,alt:f.value.alt,"aspect-ratio":3},null,8,["data","labels","alt"])])])])]),_:1},8,["loading"])],64))}}),we={key:0},ke={key:1},E=T({__name:"SongText",props:{song:{}},setup(b){return(t,n)=>t.song.title!==""?(r(),v("span",we,[e("b",null,s(t.song.title),1),n[0]||(n[0]=e("br",null,null,-1)),h(" "+s(t.song.artist),1)])):(r(),v("span",ke,s(t.song.text),1))}}),Se={class:"row"},De={class:"col-md-6 mb-4"},Ce={class:"table table-striped table-condensed table-nopadding"},Ue={class:"text-center text-success"},Re={class:"col-md-6 mb-4"},Le={class:"table table-striped table-condensed table-nopadding"},xe={class:"text-center text-danger"},Be={class:"col-md-12 mb-4"},Ae={class:"table table-striped table-condensed table-nopadding"},Pe={class:"text-center"},Ve=T({__name:"BestAndWorstTab",props:{dateRange:{},apiUrl:{}},setup(b){const t=b,n=O(t,"dateRange"),{axios:y}=W(),{DateTime:p}=q(),{state:g,isLoading:m,execute:i}=F(()=>y.get(t.apiUrl,{params:{start:p.fromJSDate(n.value.startDate).toISO(),end:p.fromJSDate(n.value.endDate).toISO()}}).then(u=>u.data),{bestAndWorst:{best:[],worst:[]},mostPlayed:[]}),k=z();return B(n,()=>{k.value&&i()}),(u,d)=>(r(),$(H,{loading:l(m),lazy:""},{default:c(()=>[e("div",Se,[e("div",De,[e("fieldset",null,[e("legend",null,s(u.$gettext("Best Performing Songs")),1),e("table",Ce,[d[1]||(d[1]=e("colgroup",null,[e("col",{width:"20%"}),e("col",{width:"80%"})],-1)),e("thead",null,[e("tr",null,[e("th",null,s(u.$gettext("Change")),1),e("th",null,s(u.$gettext("Song")),1)])]),e("tbody",null,[(r(!0),v(R,null,P(l(g).bestAndWorst.best,a=>(r(),v("tr",{key:a.song.id},[e("td",Ue,[o(X,{icon:l(oe)},null,8,["icon"]),h(" "+s(a.stat_delta)+" ",1),d[0]||(d[0]=e("br",null,null,-1)),e("small",null,s(a.stat_start)+" to "+s(a.stat_end),1)]),e("td",null,[o(E,{song:a.song},null,8,["song"])])]))),128))])])])]),e("div",Re,[e("fieldset",null,[e("legend",null,s(u.$gettext("Worst Performing Songs")),1),e("table",Le,[d[3]||(d[3]=e("colgroup",null,[e("col",{width:"20%"}),e("col",{width:"80%"})],-1)),e("thead",null,[e("tr",null,[e("th",null,s(u.$gettext("Change")),1),e("th",null,s(u.$gettext("Song")),1)])]),e("tbody",null,[(r(!0),v(R,null,P(l(g).bestAndWorst.worst,a=>(r(),v("tr",{key:a.song.id},[e("td",xe,[o(X,{icon:l(re)},null,8,["icon"]),h(" "+s(a.stat_delta)+" ",1),d[2]||(d[2]=e("br",null,null,-1)),e("small",null,s(a.stat_start)+" to "+s(a.stat_end),1)]),e("td",null,[o(E,{song:a.song},null,8,["song"])])]))),128))])])])]),e("div",Be,[e("fieldset",null,[e("legend",null,s(u.$gettext("Most Played Songs")),1),e("table",Ae,[d[4]||(d[4]=e("colgroup",null,[e("col",{width:"10%"}),e("col",{width:"90%"})],-1)),e("thead",null,[e("tr",null,[e("th",null,s(u.$gettext("Plays")),1),e("th",null,s(u.$gettext("Song")),1)])]),e("tbody",null,[(r(!0),v(R,null,P(l(g).mostPlayed,a=>(r(),v("tr",{key:a.song.id},[e("td",Pe,s(a.num_plays),1),e("td",null,[o(E,{song:a.song},null,8,["song"])])]))),128))])])])])])]),_:1},8,["loading"]))}}),Ie={class:"row"},Je={class:"col-md-6 mb-4"},Oe={class:"col-md-6 mb-4"},N=T({__name:"CommonMetricsView",props:{dateRange:{},apiUrl:{},fieldKey:{},fieldLabel:{}},setup(b){const t=b,{$gettext:n}=M(),y=[{key:t.fieldKey,label:t.fieldLabel,sortable:!0},{key:"listeners",label:n("Listeners"),sortable:!0},{key:"connected_seconds_calc",label:n("Time"),sortable:!1},{key:"connected_seconds",label:n("Time (sec)"),sortable:!0}],p=O(t,"dateRange"),{axios:g}=W(),{DateTime:m}=q(),{state:i,isLoading:k,execute:u}=F(()=>g.get(t.apiUrl,{params:{start:m.fromJSDate(p.value.startDate).toISO(),end:m.fromJSDate(p.value.endDate).toISO()}}).then(f=>f.data),{all:[],top_listeners:{labels:[],datasets:[],alt:[]},top_connected_time:{labels:[],datasets:[],alt:[]}}),d=J("$dataTable"),{navigate:a}=te(d),_=z();return B(p,async()=>{_.value&&(await u(),a())}),(f,w)=>(r(),$(H,{loading:l(k),lazy:""},{default:c(()=>[e("div",Ie,[e("div",Je,[e("fieldset",null,[e("legend",null,[V(f.$slots,"by_listeners_legend")]),o(I,{style:{width:"100%"},data:l(i).top_listeners.datasets,labels:l(i).top_listeners.labels,alt:l(i).top_listeners.alt},null,8,["data","labels","alt"])])]),e("div",Oe,[e("fieldset",null,[e("legend",null,[V(f.$slots,"by_connected_time_legend")]),o(I,{style:{width:"100%"},data:l(i).top_connected_time.datasets,labels:l(i).top_connected_time.labels,alt:l(i).top_connected_time.alt},null,8,["data","labels","alt"])])])]),o(ee,{id:f.fieldKey+"_table",ref_key:"$dataTable",ref:d,paginated:"","handle-client-side":"",fields:y,items:l(i).all,onRefreshClicked:w[0]||(w[0]=S=>l(u)())},{"cell(connected_seconds_calc)":c(S=>[h(s(l(ie)(S.item.connected_seconds)),1)]),_:1},8,["id","items"])]),_:3},8,["loading"]))}}),Me=T({__name:"BrowsersTab",props:{dateRange:{},apiUrl:{}},setup(b){return(t,n)=>(r(),$(N,{"date-range":t.dateRange,"api-url":t.apiUrl,"field-key":"browser","field-label":t.$gettext("Browser")},{by_listeners_legend:c(()=>[h(s(t.$gettext("Top Browsers by Listeners")),1)]),by_connected_time_legend:c(()=>[h(s(t.$gettext("Top Browsers by Connected Time")),1)]),_:1},8,["date-range","api-url","field-label"]))}}),We=T({__name:"CountriesTab",props:{dateRange:{},apiUrl:{}},setup(b){return(t,n)=>(r(),$(N,{"date-range":t.dateRange,"api-url":t.apiUrl,"field-key":"country","field-label":t.$gettext("Country")},{by_listeners_legend:c(()=>[h(s(t.$gettext("Top Countries by Listeners")),1)]),by_connected_time_legend:c(()=>[h(s(t.$gettext("Top Countries by Connected Time")),1)]),_:1},8,["date-range","api-url","field-label"]))}}),Fe=T({__name:"StreamsTab",props:{dateRange:{},apiUrl:{}},setup(b){return(t,n)=>(r(),$(N,{"date-range":t.dateRange,"api-url":t.apiUrl,"field-key":"stream","field-label":t.$gettext("Stream")},{by_listeners_legend:c(()=>[h(s(t.$gettext("Top Streams by Listeners")),1)]),by_connected_time_legend:c(()=>[h(s(t.$gettext("Top Streams by Connected Time")),1)]),_:1},8,["date-range","api-url","field-label"]))}}),ze=T({__name:"ClientsTab",props:{dateRange:{},apiUrl:{}},setup(b){return(t,n)=>(r(),$(N,{"date-range":t.dateRange,"api-url":t.apiUrl,"field-key":"client","field-label":t.$gettext("Client")},{by_listeners_legend:c(()=>[h(s(t.$gettext("Clients by Listeners")),1)]),by_connected_time_legend:c(()=>[h(s(t.$gettext("Clients by Connected Time")),1)]),_:1},8,["date-range","api-url","field-label"]))}}),He=T({__name:"ListeningTimeTab",props:{dateRange:{},apiUrl:{}},setup(b){const t=b,{$gettext:n}=M(),y=[{key:"label",label:n("Listening Time"),sortable:!1},{key:"value",label:n("Listeners"),sortable:!1}],p=O(t,"dateRange"),{axios:g}=W(),{DateTime:m}=q(),{state:i,isLoading:k,execute:u}=F(()=>g.get(t.apiUrl,{params:{start:m.fromJSDate(p.value.startDate).toISO(),end:m.fromJSDate(p.value.endDate).toISO()}}).then(f=>f.data),{all:[],chart:{labels:[],datasets:[],alt:[]}}),d=J("$dataTable"),{navigate:a}=te(d),_=z();return B(p,async()=>{_.value&&(await u(),a())}),(f,w)=>(r(),$(H,{loading:l(k)},{default:c(()=>[e("fieldset",null,[e("legend",null,s(l(n)("Listeners by Listening Time")),1),o(I,{style:{width:"100%"},data:l(i).chart.datasets,labels:l(i).chart.labels,alt:l(i).chart.alt,"aspect-ratio":4},null,8,["data","labels","alt"])]),o(ee,{id:"listening_time_table",ref_key:"$dataTable",ref:d,paginated:"","handle-client-side":"",fields:y,items:l(i).all,onRefreshClicked:w[0]||(w[0]=S=>l(u)())},null,8,["items"])]),_:1},8,["loading"]))}}),qe={class:"card mb-4",role:"region"},Ne={class:"card-header text-bg-primary"},Ke={class:"d-flex align-items-center"},je={class:"card-title flex-fill my-0"},Ee={class:"flex-shrink"},Ge={class:"card-body"},ft=T({__name:"Overview",props:{showFullAnalytics:{type:Boolean}},setup(b){const t=D("/reports/overview/charts"),n=D("/reports/overview/best-and-worst"),y=D("/reports/overview/by-stream"),p=D("/reports/overview/by-browser"),g=D("/reports/overview/by-country"),m=D("/reports/overview/by-client"),i=D("/reports/overview/by-listening-time"),{timezone:k}=ne(),{now:u}=ue(),d=u(),a=G({startDate:d.minus({days:13}).toJSDate(),endDate:d.toJSDate()});return(_,f)=>(r(),v("section",qe,[e("div",Ne,[e("div",Ke,[e("h2",je,s(_.$gettext("Station Statistics")),1),e("div",Ee,[o(le,{modelValue:a.value,"onUpdate:modelValue":f[0]||(f[0]=w=>a.value=w),options:{enableTimePicker:!0,timezone:l(k)},class:"btn-dark"},null,8,["modelValue","options"])])])]),e("div",Ge,[o(de,{"destroy-on-hide":""},{default:c(()=>[o(C,{label:_.$gettext("Best & Worst")},{default:c(()=>[o(Ve,{"api-url":l(n),"date-range":a.value},null,8,["api-url","date-range"])]),_:1},8,["label"]),o(C,{label:_.$gettext("Listeners By Time Period")},{default:c(()=>[o(Te,{"api-url":l(t),"date-range":a.value},null,8,["api-url","date-range"])]),_:1},8,["label"]),o(C,{label:_.$gettext("Listening Time")},{default:c(()=>[o(He,{"api-url":l(i),"date-range":a.value},null,8,["api-url","date-range"])]),_:1},8,["label"]),o(C,{label:_.$gettext("Streams")},{default:c(()=>[o(Fe,{"api-url":l(y),"date-range":a.value},null,8,["api-url","date-range"])]),_:1},8,["label"]),_.showFullAnalytics?(r(),$(C,{key:0,label:_.$gettext("Clients")},{default:c(()=>[o(ze,{"api-url":l(m),"date-range":a.value},null,8,["api-url","date-range"])]),_:1},8,["label"])):x("",!0),_.showFullAnalytics?(r(),$(C,{key:1,label:_.$gettext("Browsers")},{default:c(()=>[o(Me,{"api-url":l(p),"date-range":a.value},null,8,["api-url","date-range"])]),_:1},8,["label"])):x("",!0),_.showFullAnalytics?(r(),$(C,{key:2,label:_.$gettext("Countries")},{default:c(()=>[o(We,{"api-url":l(g),"date-range":a.value},null,8,["api-url","date-range"])]),_:1},8,["label"])):x("",!0)]),_:1})])]))}});export{ft as default};
